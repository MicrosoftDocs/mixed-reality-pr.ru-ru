---
title: Основная система
description: Система ввода, диспетчеры устройств и поставщики данных в МРТК
author: cDiaz-MS
ms.author: cadia
ms.date: 01/12/2021
keywords: Unity, HoloLens, HoloLens 2, Смешанная реальность, разработка, МРТК, события
ms.openlocfilehash: 79ebd3855cd991db168233f00058ab5d42f87d83
ms.sourcegitcommit: 8b4c2b1aac83bc8adf46acfd92b564f899ef7735
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/30/2021
ms.locfileid: "113121602"
---
# <a name="core-system"></a>Основная система

Основой входной системы является [инпутсистем](../features/input/overview.md), который отвечает за инициализацию и эксплуатацию всех функций ввода, связанных с мртк.

> [!NOTE]
> Предполагается, что читатели уже читают и имеют базовое представление о [терминологии](terminology.md) .

Эта служба отвечает за следующее:

- Чтение [входного системного профиля](../configuration/mixed-reality-configuration-guide.md#input-system-settings)
- Запуск настроенных [поставщиков данных](../features/input/input-providers.md) (например, `Windows Mixed Reality Device Manager` и `OpenVR Device Manager` ).
- Создание экземпляра [газепровидер](xref:Microsoft.MixedReality.Toolkit.Input.IMixedRealityGazeProvider), который является компонентом, отвечающим за предоставление сведений о головном стиле hololens (1 поколение) в дополнение к сведениям о взгляде на hololens в виде 2.
- Создание экземпляра [фокуспровидер](xref:Microsoft.MixedReality.Toolkit.Input.IMixedRealityFocusProvider), который является компонентом, отвечающим за определение объектов, имеющих фокус. Это подробно описано в разделе [указатели и фокус](controllers-pointers-and-focus.md#pointers-and-focus) в документации.
- Предоставление точек регистрации для всех событий ввода (в виде [глобальных прослушивателей](#global-listeners)).
- Предоставление возможностей диспетчеризации событий для этих событий ввода.

## <a name="input-events"></a>События ввода

События ввода обычно срабатывают на двух разных каналах:

### <a name="objects-in-focus"></a>Объекты в фокусе

События могут отправляться непосредственно в GameObject, имеющий фокус. Например, объект может иметь скрипт, реализующий интерфейс [`IMixedRealityTouchHandler`](xref:Microsoft.MixedReality.Toolkit.Input.IMixedRealityTouchHandler) .
Этот объект получит события касания, если он находится рядом с ним. Эти типы событий попадают в иерархию GameObject до тех пор, пока не найдет GameObject, способный обработать событие.

Это делается с помощью [ексекутехиерарчи](https://docs.unity3d.com/ScriptReference/EventSystems.ExecuteEvents.ExecuteHierarchy.html) из реализации системы ввода по умолчанию.

### <a name="global-listeners"></a>Глобальные прослушиватели

События могут отправляться в глобальные прослушиватели. Можно зарегистрировать для всех входных событий с помощью интерфейса системы ввода [`IMixedRealityEventSystem`](xref:Microsoft.MixedReality.Toolkit.IMixedRealityEventSystem) . Для регистрации глобальных событий рекомендуется использовать метод [регистерхандлер](xref:Microsoft.MixedReality.Toolkit.IMixedRealityEventSystem.RegisterHandler%2A) . Нерекомендуемая `Register` функция приведет к тому, что прослушиватели получат уведомление обо всех входных событиях, а не только на входных событиях определенного типа (где тип определяется интерфейсом событий).

Обратите внимание, что [резервные прослушиватели](xref:Microsoft.MixedReality.Toolkit.Input.MixedRealityInputSystem.PushFallbackInputHandler%2A) — это еще один тип глобальных прослушивателей, которые также не рекомендуются, так как они будут принимать каждое одно событие ввода, которое не было обработано в других местах сцены.

### <a name="order-of-event-dispatch"></a>Порядок отправки событий

Как правило, события отправляются прослушивателям следующим образом. Обратите внимание, что если любое из приведенных ниже действий помечает событие как [обработанное](https://docs.unity3d.com/ScriptReference/EventSystems.AbstractEventData-used.html), процесс диспетчеризации событий останавливается.

1. Событие отправляется в глобальные прослушиватели.
2. Событие отправляется в модальные диалоговые окна объекта с упором.
3. Событие отправляется в объект с сортировкой.
4. Событие отправляется в резервные прослушиватели.

## <a name="device-managers-and-data-providers"></a>Диспетчеры устройств и поставщики данных

Эти сущности отвечают за взаимодействие с интерфейсами API более низкого уровня (например, с API-интерфейсами Windows Mixed Reality или Опенвр API) и переводом данных из этих систем в объекты, соответствующие МРТКным абстракциям на более высоком уровне. Они отвечают за обнаружение, создание и управление временем существования [контроллеров](controllers-pointers-and-focus.md#controllers).

Основной поток диспетчера устройств включает в себя следующее:

1. Экземпляр диспетчера устройств создается во входной системной службе.
2. Диспетчер устройств регистрируется в своей базовой системе (например, диспетчер устройств Windows Mixed Reality будет зарегистрирован для [входа](../features/input/input-events.md) и событий [жестов](../features/input/gestures.md#gesture-events) .
3. Он создает контроллеры, которые он обнаруживает из базовой системы (например, поставщик может обнаружить наличие четко сформулированных рук).
4. В своем цикле Update () вызовите Упдатеконтроллер (), чтобы опросить новое состояние базовой системы и обновить его представление контроллера.
