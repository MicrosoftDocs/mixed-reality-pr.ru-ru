---
title: Контроллеры, указатели и фокус
description: Взаимодействие с контроллерами, указателями и фокусом.
author: cDiaz-MS
ms.author: cadia
ms.date: 01/12/2021
keywords: Unity, HoloLens, HoloLens 2, смешанная реальность, разработка, мртк, указатели, контроллеры
ms.openlocfilehash: 00bc0641182c566b045f959dfa361e1311b3cd224fc998f154010ad2996679ae
ms.sourcegitcommit: a1c086aa83d381129e62f9d8942f0fc889ffcab0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/05/2021
ms.locfileid: "115196294"
---
# <a name="controllers-pointers-and-focus"></a>Контроллеры, указатели и фокус

Контроллеры, указатели и фокус — это концепции более высокого уровня, основанные на фундаменте, установленном основной системой ввода. Вместе они предоставляют большую часть механизма для взаимодействия с объектами в сцене.

## <a name="controllers"></a>Контроллеры

Контроллеры представляют собой представления физического контроллера (6-градусы свободы, шарнирные руки и т. д.). Они создаются диспетчерами устройств и отвечают за взаимодействие с соответствующей базовой системой и перевод этих данных в МРТК данные и события в форме.

например, на Windows Mixed Realityной платформе [`WindowsMixedRealityArticulatedHand`](xref:Microsoft.MixedReality.Toolkit.WindowsMixedReality.Input.WindowsMixedRealityArticulatedHand) — это контроллер, который отвечает за взаимодействие с базовыми [api-интерфейсами отслеживания](/uwp/api/windows.ui.input.spatial.spatialinteractionsourcestate) Windows, чтобы получить сведения о соединениях, а также о соединениях и других свойствах руки. Он отвечает за преобразование этих данных в соответствующие события МРТК (например, путем вызова Раисепосеинпутчанжед или Раисеханджоинтсупдатед) и путем обновления собственного внутреннего состояния, чтобы запросы [`TryGetJointPose`](xref:Microsoft.MixedReality.Toolkit.Input.HandJointUtils.TryGetJointPose%2A) возвращали правильные данные.

Как правило, жизненный цикл контроллера будет содержать:

1. Контроллер создается диспетчером устройств при обнаружении нового источника (например, диспетчер устройств обнаруживает и начинает отслеживание руки).

2. В цикле Update () контроллера он вызывает свою базовую систему API.

3. В том же цикле обновления он создает изменения событий ввода, вызывая непосредственно в основную систему ввода (например, вызывая Хандмешупдатед или Ханджоинтсупдатед).

## <a name="pointers-and-focus"></a>Указатели и фокус

Указатели используются для взаимодействия с игровыми объектами. В этом разделе описывается, как создаются указатели, как они обновляются и как они определяют объекты, направляются в фокус. Кроме того, будут рассмотрены различные типы существующих указателей и сценарии, в которых они активны.

### <a name="pointer-categories"></a>Категории указателей

Обычно указатели делятся на одну из следующих категорий:

- **Дальнее указатели**

  Эти типы указателей используются для взаимодействия с объектами, далеко от пользователя (далеко не определяется как "не приближается"). Эти типы указателей обычно обходят строки, которые могут попасть в мир, и позволяют пользователю взаимодействовать с объектами, которые непосредственно не находятся рядом с ними, и управлять ими.

- **Близкие указатели**

  Эти типы указателей используются для взаимодействия с объектами, достаточно близкими для того, чтобы пользователь мог захватить, коснуться и манипулировать. Как правило, эти типы указателей взаимодействуют с объектами путем поиска объектов в соседних (путем выполнения райкастинг на небольших расстояниях, выполнения сферического приведения для поиска объектов в окружении или перечисления списков объектов, которые считаются перечисленными или сенсорными).

- **Указатели телепортируйтесь**

  Эти типы указателей подключаются к системе телетранспорта для управления перемещением пользователя в расположение, на которое указывает указатель.

## <a name="pointer-mediation"></a>Устранение указателя

Поскольку один контроллер может иметь несколько указателей (например, у руки может быть как близко, так и далеко), существует компонент, который отвечает за обрабатывают, какой указатель должен быть активным.

Например, когда рука пользователя приближается к нажатой кнопке, элемент [`ShellHandRayPointer`](xref:Microsoft.MixedReality.Toolkit.Input.ShellHandRayPointer) должен перестать отображаться, а также [`PokePointer`](xref:Microsoft.MixedReality.Toolkit.Input.PokePointer) должен быть вовлечен.

Это обрабатывается объектом [`DefaultPointerMediator`](xref:Microsoft.MixedReality.Toolkit.Input.DefaultPointerMediator) , который отвечает за определение активных указателей на основе состояния всех указателей. Одно из ключевых моментов заключается в отключении дальнего указателя, когда близкого указателя близко к объекту (см. раздел [`DefaultPointerMediator`](xref:Microsoft.MixedReality.Toolkit.Input.DefaultPointerMediator) ).

Можно предоставить альтернативную реализацию указателя медиатора, изменив [`PointerMediator`](xref:Microsoft.MixedReality.Toolkit.Input.MixedRealityPointerProfile.PointerMediator) свойство в профиле указателя.

### <a name="how-to-disable-pointers"></a>Как отключить указатели

Так как указатель медиатора запускает каждый кадр, он начинает управлять состоянием "активный" или "Неактивный" всех указателей. Таким образом, если задать свойство Исинтерактионенаблед указателя в коде, оно будет перезаписано указателем медиатора каждый кадр. Вместо этого можно указать, следует [`PointerBehavior`](xref:Microsoft.MixedReality.Toolkit.Input.PointerBehavior) ли включить или отключить указатели. Обратите внимание, что это будет работать только при использовании по умолчанию [`FocusProvider`](xref:Microsoft.MixedReality.Toolkit.Input.FocusProvider) и [`DefaultPointerMediator`](xref:Microsoft.MixedReality.Toolkit.Input.DefaultPointerMediator) в мртк.

#### <a name="example-disable-hand-rays-in-mrtk"></a>Пример. Отключение луча с рукой в МРТК

Следующий код отключит лучи руки в МРТК:

```c#
// Turn off all hand rays
PointerUtils.SetHandRayPointerBehavior(PointerBehavior.AlwaysOff);

// Turn off hand rays for the right hand only
PointerUtils.SetHandRayPointerBehavior(PointerBehavior.AlwaysOff, Handedness.Right);
```

Приведенный ниже код возвратит значения по умолчанию к их поведению в МРТК:

```c#
PointerUtils.SetHandRayPointerBehavior(PointerBehavior.Default);
```

Приведенный ниже код будет вынужден быть включенным, независимо от того, находится ли рядом с ним.

```c#
// Turn off all hand rays
PointerUtils.SetHandRayPointerBehavior(PointerBehavior.AlwaysOn);
```

[`PointerUtils`](xref:Microsoft.MixedReality.Toolkit.Input.PointerUtils) [`TurnPointersOnOff`](xref:Microsoft.MixedReality.Toolkit.Examples.Demos.DisablePointersExample) Дополнительные примеры см. в разделе и.

### <a name="focusprovider"></a>фокуспровидер

[`FocusProvider`](xref:Microsoft.MixedReality.Toolkit.Input.FocusProvider)— Это основных, отвечающий за итерацию по списку всех указателей и вычисление объекта, на который нацелен объект, для каждого указателя.

В каждом `Update()` вызове будет следующее:

1. Обновляет все указатели, райкастинг и выполняя обнаружение попаданий, настроенное самим указателем (например, указатель сферы может указывать Сфереоверлап Райкастмоде, поэтому Фокуспровидер выполнит конфликт на основе сферы).

2. Обновление объекта с фокусом на основе каждого указателя (т. е. Если объект получит фокус, он также запустит события для этого объекта, если объект потерял фокус, он вызовет потерю фокуса и т. д.).

### <a name="pointer-configuration-and-lifecycle"></a>Конфигурация указателя и жизненный цикл

[Указатели можно настраивать](../features/input/pointers.md) в разделе *указатели* входного системного профиля.

Как правило, время существования указателя является следующим:

1. Диспетчер устройств обнаружит наличие контроллера. Этот диспетчер устройств создаст набор указателей, связанных с контроллером, с помощью вызова [`RequestPointers`](xref:Microsoft.MixedReality.Toolkit.Input.BaseInputDeviceManager) .

2. Фокуспровидер в цикле Update () перебирает все допустимые указатели и выполняет связанную логику обнаружения райкаст или попадания. Используется для определения объекта, на который нацелен каждый конкретный указатель.

    - Так как может быть активировано несколько источников входных данных одновременно (например, две руки), можно также иметь несколько объектов, имеющих фокус одновременно.

3. Диспетчер устройств при обнаружении потери источника контроллера приведет к разрыву указателей, связанных с потерянным контроллером.