---
title: Стандартный шейдер MRTK
description: Документация по Мрткстандардшадер
author: CDiaz-MS
ms.author: cadia
ms.date: 01/12/2021
keywords: Unity, HoloLens, HoloLens 2, Смешанная реальность, разработка, МРТК, шейдер материалов
ms.openlocfilehash: 8b570ebb023305cecbeca16b32832417a3f57cce
ms.sourcegitcommit: c0ba7d7bb57bb5dda65ee9019229b68c2ee7c267
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2021
ms.locfileid: "110145118"
---
# <a name="mrtk-standard-shader"></a>Стандартный шейдер MRTK

![Примеры стандартных шейдеров](../images/mrtk-standard-shader/MRTK_StandardShader.jpg)

Стандартная система затенения МРТК использует один гибкий шейдер, который может обеспечить визуальные элементы, аналогичные стандартному шейдеру Unity, реализовывать основные принципы [разработки](https://www.microsoft.com/design/fluent/) , а также работать на устройствах смешанной реальности.

## <a name="example-scenes"></a>Примеры сцен

Примеры материалов шейдера можно найти в сцене **материалгаллери** в разделе `MRTK/Examples/Demos/StandardShader/Scenes/` . Все материалы в этой сцене используют шейдер МРТК/Standard.

![Коллекция материалов](../images/mrtk-standard-shader/MRTK_MaterialGallery.jpg)

Можно найти сцену сравнения, чтобы сравнить и протестировать МРТК/Стандартный шейдер с примером шейдера Unity/Standard в сцене **стандардматериалкомпарисон** в разделе `MRTK/Examples/Demos/StandardShader/Scenes/` .

![Сравнение материалов](../images/mrtk-standard-shader/MRTK_StandardMaterialComparison.gif)

## <a name="architecture"></a>Архитектура

Система заливки МРТК/Standard — это «Uber шейдер», который использует [функцию «вариант программы шейдера Unity](https://docs.unity3d.com/Manual/SL-MultipleProgramVariants.html) » для автоматического создания оптимального кода шейдера на основе свойств материала. Когда пользователь выбирает свойства материала в инспекторе материалов, он повлечет за собой только затраты на производительность для включенных функций.

## <a name="material-inspector"></a>Инспектор материалов

Пользовательский инспектор материалов существует для вызываемого шейдера МРТК/Standard [`MixedRealityStandardShaderGUI.cs`](xref:Microsoft.MixedReality.Toolkit.Editor.MixedRealityStandardShaderGUI) . Инспектор автоматически включает или отключает функции шейдера на основе выбора пользователя и АИДЕС при настройке состояния визуализации. Дополнительные сведения о каждом компоненте **см. в подсказке для каждого свойства в редакторе Unity.**

![Инспектор материалов](../images/mrtk-standard-shader/MRTK_MaterialInspector.jpg)

Первая часть инспектора управляет состоянием рендеринга материала. *Режим рендеринга* определяет, когда и как будет подготавливаться материал. Целью шейдера МРТК/Standard является отражение [режимов рендеринга, находящихся в шейдере Unity/Standard](https://docs.unity3d.com/Manual/StandardShaderMaterialParameterRenderingMode.html). Шейдер МРТК/Standard также включает режим подготовки к просмотру и *Пользовательский* *режим отрисовки* для полного пользовательского элемента управления.

| Режим рендеринга |         Описание:                                                       |
|----------------|---------------------------------------------------------------------------|
| Непрозрачный         | Параметры Подходит для нормальных сплошных объектов без прозрачных областей.    |
| Отверстий         | Позволяет создавать прозрачные эффекты с жесткими краями между прозрачными и прозрачными областями. В этом режиме не существует полупрозрачных областей, текстура имеет значение 100% непрозрачность или невидимо. Это полезно при использовании прозрачности для создания формы материалов, например растительности. |
| Исчезание           | Позволяет значениям прозрачности полностью ослабить объект, включая любые отраженные блики или отражения, которые он может иметь. Этот режим удобен, если нужно анимировать объект в режиме затухания. Он не подходит для отрисовки реалистичных прозрачных материалов, таких как четкий пластик или эффект стекла, так как отражения и выделения также будут удалены. |
| Прозрачный    | Подходит для визуализации реалистичных прозрачных материалов, таких как четкие пластика или стекло. В этом режиме материал будет принимать значения прозрачности (на основе альфа-канала текстуры и альфа-составляющей цвета оттенка). Однако отражения и выделения освещения остаются видимыми в полной мере, как в случае с реальными прозрачными материалами. |
| Аддитивный       | Включает режим смешения, который суммирует предыдущий цвет пикселя с текущим цветом пикселя. Это предпочтительный режим прозрачности, позволяющий избежать проблем с сортировкой по прозрачности.     |
| Другой         | Позволяет управлять каждым аспектом режима рендеринга вручную. Только для расширенного использования.   |

![Режимы подготовки к просмотру](../images/mrtk-standard-shader/MRTK_RenderingModes.jpg)

| Режим отбора |             Описание:                                                                                                                                                                       |
|-----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Выключено       | Отключает отбор лиц. Для отбора следует установить значение OFF, только если требуется двусторонняя сетка.                                                                                        |
| Front     | Включение внешнего отбора лицевой стороны.                                                                                                                                                        |
| Назад      | Параметры Включает [отбор лицевой стороны](https://en.wikipedia.org/wiki/Back-face_culling). Для повышения производительности отрисовки должно быть включено истечение для обратной стороны. |

## <a name="performance"></a>Производительность

Одним из основных преимуществ использования стандартного шейдера МРТК для стандартного шейдера Unity является производительность. Стандартный шейдер МРТК является расширяемым и использует только включенные функции. Однако также был написан Стандартный шейдер МРТК для предоставления сравнимых результатов Aesthetic в качестве шейдера стандарта Unity, но с меньшими затратами. Простой способ сравнить производительность шейдера заключается в количестве операций, которые необходимо выполнить с помощью GPU. Конечно, величина вычислений может отклонения от включенных функций и других конфигураций подготовки к просмотру. Но в целом стандартный шейдер МРТК выполняет значительно меньше вычислений, чем стандартный шейдер Unity.

Пример статистики для стандартного шейдера Unity

![Статистика стандартных шейдеров Unity](../images/performance/UnityStandardShader-Stats.PNG)

Пример статистики стандартного шейдера МРТК

![Статистика стандартного шейдера МРТК](../images/performance/MRTKStandardShader-Stats.PNG)

> [!NOTE]
> Эти результаты можно создать, выбрав и просмотрев [ресурс шейдера](https://docs.unity3d.com/Manual/class-Shader.html) в инспекторе Unity, а затем нажав кнопку *компилировать и показывать код* .

## <a name="lighting"></a>Освещение

МРТК/Standard использует простую аппроксимацию для освещения. Поскольку этот шейдер не вычисляется для физической корректности и экономии энергии, он быстро и эффективно готовится к просмотру. Blinn-Phong является основным приемом освещения, который смешивается с Френелю и освещением на основе изображений и отражается как физическое освещение. Шейдер поддерживает следующие приемы освещения:

### <a name="directional-light"></a>Направленное освещение

Шейдер будет учитывать направление, цвет и интенсивность первого векторного освещения Unity в сцене (если она включена). Динамические источники света, световые индикаторы или любой другой источник Unity не будут рассматриваться в режиме освещения в реальном времени.

### <a name="spherical-harmonics"></a>Сферические гармонические колебания

Шейдер будет использовать легкие зонды для приблизительного освещения сцены с помощью [сферических гармоний](https://docs.unity3d.com/Manual/LightProbes-TechnicalInformation.html), если они включены. Расчеты сферических гармоний выполняются на вершину, чтобы сократить затраты на вычисления.

### <a name="lightmapping"></a>лигхтмаппинг

Для статического освещения шейдер будет учитывать лигхтмапс, построенные [системой Лигхтмаппинг](https://docs.unity3d.com/Manual/Lightmapping.html)Unity. Просто пометьте модуль подготовки отчетов как статический (или лигхтмап статический), чтобы использовать лигхтмапс.

### <a name="hover-light"></a>Светлое наведение

* См. [освещение наведения](hover-light.md)

### <a name="proximity-light"></a>Неблизкое освещение

* См. [освещение](proximity-light.md)

## <a name="lightweight-scriptable-render-pipeline-support"></a>Поддержка упрощенного скрипта рендеринга

МРТК содержит путь обновления, позволяющий разработчикам использовать упрощенный скрипт рендеринга (ЛВРП) Unity с помощью шейдеров МРТК. Проверено в Unity 2019.1.1 F1 и пакет 5.7.2. Lightweight RP. инструкции по началу работы с ЛВРП см. на [этой странице](https://docs.unity3d.com/Packages/com.unity.render-pipelines.lightweight@5.10/manual/getting-started-with-lwrp.html).

Чтобы выполнить обновление МРТК, выберите пункт " **набор средств для смешанной реальности — > служебные программы-> обновить Стандартный ШЕЙДЕР мртк для упрощенного конвейера визуализации** ".

![Обновление лврп](../images/mrtk-standard-shader/MRTK_LWRPUpgrade.jpg)

После обновления будет изменен шейдер МРТК/Standard и все его пурпурные (ошибки шейдера), которые должны быть исправлены. Чтобы убедиться, что обновление выполнено успешно, проверьте наличие обновлений в консоли для: **обновленные активы/микседреалититулкит/стандардассетс/shaders/микседреалитистандард. шейдер для использования с упрощенным конвейером отрисовки.**

## <a name="ugui-support"></a>Поддержка УГУИ

Стандартная система заливки МРТК работает с встроенной [системой пользовательского интерфейса](https://docs.unity3d.com/Manual/UISystem.html)Unity. В компонентах пользовательского интерфейса Unity матрица unity_ObjectToWorld не является матрицей преобразования локального преобразования, в которой находится графический компонент, но на его родительском холсте. Многие эффекты МРТК/Standard шейдера должны быть известны по шкале объектов. Чтобы решить эту проблему, параметр [`ScaleMeshEffect.cs`](xref:Microsoft.MixedReality.Toolkit.Input.Utilities.ScaleMeshEffect) будет хранить сведения о масштабировании в атрибутах каналов UV во время создания сетки пользовательского интерфейса.

Обратите внимание, что при использовании компонента образа Unity рекомендуется указать для исходного изображения "нет (спрайт)", чтобы пользовательский интерфейс Unity не создавал дополнительные вершины.

Холст в МРТК запрашивает добавление объекта, [`ScaleMeshEffect.cs`](xref:Microsoft.MixedReality.Toolkit.Input.Utilities.ScaleMeshEffect) когда он необходим:

![масштабирование сетки](../images/mrtk-standard-shader/MRTK_ScaleMeshEffect.jpg)

## <a name="texture-combiner"></a>Средство объединения текстур

Чтобы повысить четность с помощью стандартного шейдера Unity на пиксельной панели, значения гладкости, эмиссионный и перекрытия, все это можно контролировать с помощью [упаковки канала](http://wiki.polycount.com/wiki/ChannelPacking). Пример:

![Пример схемы канала](../images/mrtk-standard-shader/MRTK_ChannelMap.gif)

При использовании упаковки канала необходимо только выбрать и загрузить одну текстуру в память, а не четыре отдельные единицы. При написании текстурных карт в программе, такой как веществ или Photoshop, вы можете упаковать их следующим образом:

| Channel | Свойство             |
|---------|----------------------|
| Красный     | Краска             |
| Зеленый   | Загораживание            |
| Синий    | Эмиссия (оттенки серого) |
| Коэффициент альфа   | Гладкости           |

Также можно использовать инструмент для МРТК текстуры. Чтобы открыть средство, выберите элемент **набор средств для смешанной реальности — > служебные программы — > средство объединения текстур** , которое откроет следующее окно:

![Пример средства для объединения текстур](../images/mrtk-standard-shader/MRTK_TextureCombiner.jpg)

Это окно можно автоматически заполнить, выбрав Стандартный шейдер Unity и щелкнув "Автозаполнение из стандартного материала". Можно также вручную указать текстуру (или постоянное значение) на красный, зеленый, синий или альфа-канал. Сочетание текстуры — это ускорение GPU и не требует, чтобы текстура ввода была доступной для ЦП.

## <a name="additional-feature-documentation"></a>Документация по дополнительным функциям

Ниже приведены дополнительные сведения о некоторых функциях, доступных в шейдере МРТК/Standard.

### <a name="primitive-clipping"></a>Вырезка примитива

![вырезка примитива](../images/mrtk-standard-shader/MRTK_PrimitiveClipping.gif)

* См. [отсеченный примитив](clipping-primitive.md)

### <a name="mesh-outlines"></a>Контуры сетки

Многие приемы структуры сетки выполняются с помощью метода [завершающей обработки](https://docs.unity3d.com/Manual/PostProcessingOverview.html) . После обработки обеспечивается качественная обработка, но она может быть чрезмерно дорогостоящей на многих устройствах смешанной реальности. Вы можете найти сцену, которая демонстрирует использование контуров сетки в сцене  **аутлиниксамплес** в разделе `MRTK/Examples/Demos/StandardShader/Scenes/` .

<img src="../images/mrtk-standard-shader/MRTK_MeshOutline.jpg" width="900" alt="Mesh Outline">

[`MeshOutline.cs`](xref:Microsoft.MixedReality.Toolkit.Utilities.MeshOutline) и [`MeshOutlineHierarchy.cs`](xref:Microsoft.MixedReality.Toolkit.Utilities.MeshOutlineHierarchy) могут использоваться для отрисовки контура вокруг модуля подготовки сетки. При включении этого компонента вводится дополнительный проход визуализации объекта, который выводится на экран, но он предназначен для запуска перформантли на устройствах с мобильными устройствами смешанной реальности и не использует процессы POST. Ограничения этого воздействия: он не работает с объектами, которые не ватертигхт (или должны быть на двух сторонах), и проблемы с глубиной сортировки могут возникать в перекрывающихся объектах.

Поведение структуры предназначено для использования в сочетании с шейдером МРТК/Standard. Структурные материалы обычно являются сплошным унлит цветом, но могут быть настроены для достижения широкого спектра эффектов. Настройка по умолчанию для материала в виде структуры выглядит следующим образом:

<img src="../images/mrtk-standard-shader/MRTK_OutlineMaterial.jpg" width="450" alt="Mesh Outline Material">

1. Запись глубины — необходимо отключить для структурных материалов, чтобы убедиться, что структура не мешает отрисовке других объектов.
2. Для отрисовки структуры необходимо включить на уровне вершин.
3. Используйте плавные нормали. Этот параметр является необязательным для некоторых сеток. Объемы изменяются путем перемещения вершины в нормальном расположении, в некоторых сетках, выходящих по умолчанию, будут вычислены ненепрерывности в структуре. Чтобы устранить эти неудобства, можно установить этот флажок, чтобы использовать другой набор сглаженных нормалей, созданных [`MeshSmoother.cs`](xref:Microsoft.MixedReality.Toolkit.Utilities.MeshSmoother)

[`MeshSmoother.cs`](xref:Microsoft.MixedReality.Toolkit.Utilities.MeshSmoother) — это компонент, который можно использовать для автоматического создания гладких нормалей в сети. Этот метод группирует вершины в сетке, которая совместно используют одно и то же расположение в пространстве, а затем усредняет нормали этих вершин. Этот процесс создает копию базовой сетки и должен использоваться только при необходимости.

<img src="../images/mrtk-standard-shader/MRTK_SmoothNormals.jpg" width="450" alt="Smooth Normals Outline">

1. Плавные нормали, созданные с помощью [`MeshSmoother.cs`](xref:Microsoft.MixedReality.Toolkit.Utilities.MeshSmoother) .
2. Используются нормали по умолчанию, обратите внимание на артефакты вокруг углов Куба.

### <a name="stencil-testing"></a>Тестирование набора элементов

Встроенная поддержка тестирования трафаретов для достижения широкого спектра эффектов. Например порталы:

![тест набора элементов](../images/mrtk-standard-shader/MRTK_StencilTest.gif)

### <a name="instanced-color-support"></a>Поддержка экземплярного цвета

Поддержка экземпляров с экземплярами, позволяющая тысячам экземпляров GPU заменять уникальные свойства материала:

![свойства экземпляра](../images/mrtk-standard-shader/MRTK_InstancedProperties.gif)

### <a name="triplanar-mapping"></a>Сопоставление трипланар

Сопоставление трипланар — это методика программной текстуры для сетки. Часто используется в ландшафта, в сетках без UVs или сложностях распаковки фигур. Эта реализация поддерживает проекцию в мировом или локальном пространстве, спецификацию сглаживания смешения и стандартную поддержку карт. Обратите внимание, что каждая используемая текстура требует 3 образца текстуры, поэтому следует использовать их в критически важных для производительности ситуациях.

![трипланар](../images/mrtk-standard-shader/MRTK_TriplanarMapping.gif)

### <a name="vertex-extrusion"></a>Объемная вершина

Объемная вершина в мировом пространстве. Используется для визуализации вытянутых ограничивающих томов или переходов между и выходными сетками.

![Обычная шкала карт 1](../images/mrtk-standard-shader/MRTK_VertexExtrusion.gif)

### <a name="miscellaneous"></a>Разное

Флажок для управления оптимизациями албедо. Албедо операции оптимизации отключены, если текстура албедо не указана. Это полезно для управления [загрузкой удаленной текстуры](http://dotnetbyexample.blogspot.com/2018/10/workaround-remote-texture-loading-does.html).

Просто установите этот флажок:

![Назначение албедо](../images/mrtk-standard-shader/MRTK_AlbedoAssignment.jpg)

Для каждого пиксела вырезки текстуры, сглаживание на основе местного периметра и нормальное масштабирование карт поддерживаются.

![нормальное масштабирование карт 2](../images/mrtk-standard-shader/MRTK_NormalMapScale.gif)

## <a name="see-also"></a>См. также

* [Интерактивный объект](../ux-building-blocks/interactable.md)
* [HoverLight](hover-light.md)
* [ProximityLight](proximity-light.md)
* [ClippingPrimitive](clipping-primitive.md)
