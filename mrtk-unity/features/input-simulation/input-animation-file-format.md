---
title: Формат файла анимации входных данных
description: Документация по спецификации формата двоичных файлов анимации ввода в МРТК
author: CDiaz-MS
ms.author: cadia
ms.date: 01/12/2021
keywords: Unity, HoloLens, HoloLens 2, смешанная реальность, разработка, MRTK
ms.openlocfilehash: ba232818c0a49d803ca6fae0b5adbc64e6deefa8
ms.sourcegitcommit: c0ba7d7bb57bb5dda65ee9019229b68c2ee7c267
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2021
ms.locfileid: "110145120"
---
# <a name="input-animation-binary-file-format-specification"></a>Спецификация формата двоичного файла анимации ввода

## <a name="overall-structure"></a>Общая структура

Двоичный файл входной анимации начинается с 64-разрядного целочисленного магического числа. Значение этого числа в шестнадцатеричной нотации — `0x6a8faf6e0f9e42c6` и может использоваться для обозначения допустимых входных файлов анимации.

Следующие восемь байт — это два значения Int32, объявляющие основной и дополнительный номера версии файла.

Остальная часть файла берется из данных анимации, что может меняться между номерами версий.

| Section | Тип |
|---------|------|
| Магическое число | Int64 |
| Основной номер версии | Int32 |
| Дополнительный номер версии | Int32 |
| Данные анимации | _см. раздел версии_ |

## <a name="version-11"></a>Версия 1.1

Входные данные анимации состоят из трех логических значений, которые указывают, содержит ли анимация данные о камере, руки и глаза, а затем последовательность кривых анимации. Представленные кривые определяются значениями этих логических значений. Каждая кривая может иметь разное количество опорных кадров.

| Section | Тип | Примечания |
|---------|------|------|
| Содержит камеру | Логическое | |
| Содержит данные о наличии | Логическое | |
| Взгляд глаз| Логическое | |
| Камера | [Выставить кривые](#pose-curves) | Только если имеет значение true для камеры |
| С левой стороны | [Логическая кривая](#boolean-curve) | Только если есть данные о наличии, имеющие значение true |
| С правой стороны | [Логическая кривая](#boolean-curve) | Только если есть данные о наличии, имеющие значение true |
| Сжатие вручную, слева | [Логическая кривая](#boolean-curve) | Только если есть данные о наличии, имеющие значение true |
| Правильное сжатие вручную | [Логическая кривая](#boolean-curve) | Только если есть данные о наличии, имеющие значение true |
| Осталось соединений с руки | [Стыковые кривые](#joint-pose-curves) | Только если есть данные о наличии, имеющие значение true |
| Справа от руки | [Стыковые кривые](#joint-pose-curves) | Только если есть данные о наличии, имеющие значение true |
| Взгляд глаз | [Кривые лучей](#ray-curves)] | Только если для глаза установлено значение true |

## <a name="version-10"></a>Версия 1.0

Входные данные анимации состоят из последовательности кривых анимации. Число и значение кривых анимации фиксированы, но каждая кривая может иметь разное количество опорных кадров.

| Section | Тип |
|---------|------|
| Камера | [Выставить кривые](#pose-curves) |
| С левой стороны | [Логическая кривая](#boolean-curve) |
| С правой стороны | [Логическая кривая](#boolean-curve) |
| Сжатие вручную, слева | [Логическая кривая](#boolean-curve) |
| Правильное сжатие вручную | [Логическая кривая](#boolean-curve) |
| Осталось соединений с руки | [Стыковые кривые](#joint-pose-curves) |
| Справа от руки | [Стыковые кривые](#joint-pose-curves) |

### <a name="joint-pose-curves"></a>Стыковые кривые

Для каждой руки сохраняется последовательность кривых Объединенных анимаций. Число соединений фиксировано, и для каждого соединения сохраняется набор кривых.

| Section | Тип |
|---------|------|
| None | [Выставить кривые](#pose-curves) |
| Кисти | [Выставить кривые](#pose-curves) |
| Palm | [Выставить кривые](#pose-curves) |
| сумбметакарпалжоинт | [Выставить кривые](#pose-curves) |
| сумбпроксималжоинт | [Выставить кривые](#pose-curves) |
| сумбдисталжоинт | [Выставить кривые](#pose-curves) |
| сумбтип | [Выставить кривые](#pose-curves) |
| индексметакарпал | [Выставить кривые](#pose-curves) |
| индекскнуккле | [Выставить кривые](#pose-curves) |
| индексмиддлежоинт | [Выставить кривые](#pose-curves) |
| индексдисталжоинт | [Выставить кривые](#pose-curves) |
| индекстип | [Выставить кривые](#pose-curves) |
| миддлеметакарпал | [Выставить кривые](#pose-curves) |
| миддлекнуккле | [Выставить кривые](#pose-curves) |
| миддлемиддлежоинт | [Выставить кривые](#pose-curves) |
| миддледисталжоинт | [Выставить кривые](#pose-curves) |
| миддлетип | [Выставить кривые](#pose-curves) |
| рингметакарпал | [Выставить кривые](#pose-curves) |
| рингкнуккле | [Выставить кривые](#pose-curves) |
| рингмиддлежоинт | [Выставить кривые](#pose-curves) |
| рингдисталжоинт | [Выставить кривые](#pose-curves) |
| рингтип | [Выставить кривые](#pose-curves) |
| пинкиметакарпал | [Выставить кривые](#pose-curves) |
| пинкикнуккле | [Выставить кривые](#pose-curves) |
| пинкимиддлежоинт | [Выставить кривые](#pose-curves) |
| пинкидисталжоинт | [Выставить кривые](#pose-curves) |
| пинкитип | [Выставить кривые](#pose-curves) |

### <a name="pose-curves"></a>Выставить кривые

Кривые a — это последовательность из трех кривых анимации для вектора расположения, за которой следуют 4 кривой анимации для кватерниона поворота.

| Section | Тип |
|---------|------|
| Расположение X | [Кривая с плавающей запятой](#float-curve) |
| Расположение по оси Y | [Кривая с плавающей запятой](#float-curve) |
| Расположение Z | [Кривая с плавающей запятой](#float-curve) |
| Поворот по X | [Кривая с плавающей запятой](#float-curve) |
| Поворот по оси Y | [Кривая с плавающей запятой](#float-curve) |
| Поворот по оси Z | [Кривая с плавающей запятой](#float-curve) |
| Поворот на | [Кривая с плавающей запятой](#float-curve) |

### <a name="ray-curves"></a>Кривые лучей

Кривые лучей — это последовательность из трех кривых анимации для исходного вектора, за которыми следуют три кривые анимации для вектора направления.

| Section | Тип |
|---------|------|
| Источник X | [Кривая с плавающей запятой](#float-curve) |
| Начало координат Y | [Кривая с плавающей запятой](#float-curve) |
| Начало координат Z | [Кривая с плавающей запятой](#float-curve) |
| Направление X | [Кривая с плавающей запятой](#float-curve) |
| Направление Y | [Кривая с плавающей запятой](#float-curve) |
| Направление Z | [Кривая с плавающей запятой](#float-curve) |

### <a name="float-curve"></a>Кривая с плавающей запятой

Кривые с плавающей запятой полностью порабатывают кривые Безье с переменным числом опорных кадров. В каждом опорном кадре хранится время и значение кривой, а также касательные и весовые коэффициенты в левой и правой части каждого опорного кадра.

| Section | Тип |
|---------|------|
| Режим предварительного переноса | Int32, [режим переноса](#wrap-mode) |
| Режим после переноса | Int32, [режим переноса](#wrap-mode) |
| Число опорных кадров | Int32 |
| Опорные кадры | [Опорный кадр с плавающей точкой](#float-keyframe) |

### <a name="float-keyframe"></a>Опорный кадр с плавающей точкой

В опорном кадре float значения тангенса и веса хранятся рядом с базовым временем и значением.

| Section | Тип |
|---------|------|
| Time | Float32 |
| Значение | Float32 |
| Нетангенс | Float32 |
| Тангенс | Float32 |
| Невес | Float32 |
| Масса | Float32 |
| веигхтедмоде | Int32, [взвешенный режим](#weighted-mode) |

### <a name="boolean-curve"></a>Логическая кривая

Логические кривые — это простые последовательности значений on/off. На каждом опорном кадре значение кривой переворачивается немедленно.

| Section | Тип |
|---------|------|
| Режим предварительного переноса | Int32, [режим переноса](#wrap-mode) |
| Режим после переноса | Int32, [режим переноса](#wrap-mode) |
| Число опорных кадров | Int32 |
| Опорные кадры | [Логический опорный кадр](#boolean-keyframe) |

### <a name="boolean-keyframe"></a>Логический опорный кадр

Логический ключевой кадр хранит только время и значение.

| Section | Тип |
|---------|------|
| Time | Float32 |
| Значение | Float32 |

### <a name="wrap-mode"></a>Режим переноса

Семантика режимов до и после переноса соответствует определению [Врапмоде Unity](https://docs.unity3d.com/ScriptReference/WrapMode.html) . Они представляют собой сочетание следующих битов:

| Значение | Значение |
|-------|---------|
| 0 | По умолчанию: считывает режим повтора по умолчанию, установленный выше. |
| 1 | Один раз: когда время достигает конца анимированного фрагмента анимации, клип автоматически прекращает воспроизведение, а время сбрасывается до начала клипа. |
| 2 | Цикл: Если время достигает конца анимированного фрагмента анимации, то время продолжится в начале. |
| 4 | Пингпонг: когда время достигает конца анимированного фрагмента анимации, время пройдет проверку связи между началом и концом. |
| 8 | Клампфоревер: воспроизводит анимацию назад. По достижении конца он продолжает играть в последнюю рамку и никогда не останавливает воспроизведение. |

### <a name="weighted-mode"></a>Взвешенный режим

Семантика взвешенного режима соответствует определению [Веигхтедмоде Unity](https://docs.unity3d.com/ScriptReference/WeightedMode.html) .

| Значение | Значение |
|-------|---------|
| 0 | Нет: при вычислении сегментов кривой исключается как невесовой, так и неплотный. |
| 1 | В: включение невесовых значений при вычислении предыдущего сегмента кривой. |
| 2 | Out: включение веса при вычислении следующего сегмента кривой. |
| 3 | Оба: включают невесовые значения и вес при вычислении сегментов кривой. |
