---
title: Основные сведения о сцене
description: Описание принципов работы с сценами в МРТК
author: MaxWang-MS
ms.author: wangmax
ms.date: 05/27/2021
keywords: Unity, HoloLens, HoloLens 2, Смешанная реальность, разработка, МРТК, основные сведения о сцене
ms.openlocfilehash: 67a8b99a281b6deecd621edb5600578806812d8a
ms.sourcegitcommit: 86fafb3a7ac6a5f60340ae5041619e488223f4f0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/22/2021
ms.locfileid: "112449753"
---
# <a name="scene-understanding"></a>Основные сведения о сцене

[Понятие "сцена](/windows/mixed-reality/scene-understanding) " возвращает семантическое представление сущностей сцены, а также их геометрические формы в __HoloLens 2__ (не поддерживается Hololens 1-го поколения).

Ниже перечислены некоторые ожидаемые варианты использования этой технологии.
* Размещение объектов на ближайшей поверхности определенного вида (например, стены и этажа)
* Создание панели навигации — сетки для игр в стиле платформы
* Предоставление понятных геометрических объектов с четырьмя подсистемами
* Ускорение разработки за счет предотвращения необходимости написания аналогичных алгоритмов

Основные сведения о сцене представлены в виде __экспериментальной__ функции в мртк 2,6. Он интегрируется в МРТК как [пространственный наблюдатель](spatial-awareness-getting-started.md#register-observers) с именем [`WindowsSceneUnderstandingObserver`](xref:Microsoft.MixedReality.Toolkit.WindowsSceneUnderstanding.Experimental.WindowsSceneUnderstandingObserver) . Понятие "сцены" работает как с устаревшим конвейером XR, так и с конвейером пакета SDK XR (Опенкср (начиная с МРТК 2,7) и подключаемым модулем Windows XR). В обоих случаях `WindowsSceneUnderstandingObserver` используется.

> [!NOTE] 
> Использование сцены в удаленном взаимодействии не поддерживается.

## <a name="observer-overview"></a>Общие сведения об наблюдателе

При запросе [`WindowsSceneUnderstandingObserver`](xref:Microsoft.MixedReality.Toolkit.WindowsSceneUnderstanding.Experimental.WindowsSceneUnderstandingObserver) будет возвращено [спатиалаваренесссценеобжект](xref:Microsoft.MixedReality.Toolkit.Experimental.SpatialAwareness.SpatialAwarenessSceneObject) с атрибутами, полезными для приложения, чтобы понять его окружение. Частота наблюдения, возвращаемый тип объекта (например, стена, Floor) и другие поведения наблюдателя, зависит от конфигурации наблюдателя с помощью профиля. Например, если требуется маска перекрытия, наблюдатель должен быть настроен для формирования четырех чисел. Наблюдаемая сцена может быть сохранена в виде сериализованного файла, который впоследствии можно загрузить, чтобы воссоздать сцену в редакторе в режиме воспроизведения.

## <a name="setup"></a>Настройка

> [!IMPORTANT]
> Понимание сцены поддерживается только в HoloLens 2 и Unity 2019,4 и более поздних версиях.

1. Убедитесь, что платформа имеет значение UWP в параметрах сборки.
1. Получите представление о пакете с помощью [средства "функция смешанной реальности](https://aka.ms/MRFeatureTool)".

## <a name="using-scene-understanding"></a>Основные сведения об использовании сцены

Самый быстрый способ приступить к пониманию сцены — извлечь пример сцены.

### <a name="scene-understanding-sample-scene"></a>Пример сцены "сцена"

В Unity используйте обозреватель проектов, чтобы открыть файл сцены в `Examples/Experimental/SceneUnderstanding/Scenes/SceneUnderstandingExample.unity` , и нажмите кнопку Воспроизвести.

::: moniker range="< mrtkunity-2021-05"
> [!IMPORTANT]
> Применяется только к МРТК 2.6.0 — при использовании средства "функция Mixed Reality" или при импорте через УПМ. Импортируйте пример "демонстрационные версии-Спатиалаваренесс" перед импортом примера "экспериментальный-Сценеундерстандинг" из-за проблемы с зависимостью. Дополнительные сведения см. в [этой ошибке GitHub](https://github.com/microsoft/MixedRealityToolkit-Unity/issues/9431) .

::: moniker-end
Сцена демонстрирует следующее:

* Визуализация наблюдаемых объектов сцены в пользовательском интерфейсе приложения для настройки наблюдателя
* Пример `DemoSceneUnderstandingController` скрипта, демонстрирующий изменение параметров наблюдателя и прослушивание соответствующих событий
* Сохранение данных сцены на устройстве для автономной разработки
* Загрузка ранее сохраненных данных сцены (байт-файлов) для поддержки рабочего процесса разработки в редакторе

> [!IMPORTANT]
> По умолчанию `ShouldLoadFromFile` свойство наблюдателя имеет значение false. Чтобы увидеть визуализацию сериализованного примера комнаты, ознакомьтесь с разделом [Настройка службы наблюдателя](#configuring-the-observer-service) ниже и задайте для свойства значение true в редакторе.
::: moniker range="< mrtkunity-2021-05"

> [!NOTE] 
> Пример сцены основан на устаревшем конвейере XR. При использовании конвейера пакета SDK для XR необходимо соответствующим образом изменить профили. Указанная сцена, посвященная системному профилю пространственной информации ( `DemoSceneUnderstandingSystemProfile` ) и сцене, посвященной профилям наблюдателя ( `DefaultSceneUnderstandingObserverProfile` и `DemoSceneUnderstandingObserverProfile` ), работает для обоих конвейеров.
::: moniker-end
::: moniker range="= mrtkunity-2021-05"

> [!NOTE] 
> Пример сцены регистрирует `There is no active AsyncCoroutineRunner when an action is posted.` предупреждение при определенных обстоятельствах из-за инициализации или порядка выполнения потока. Если вы можете подтвердить, что `AsyncCoroutineRunner` компонент подключен к "демонстрационному контроллеру" GameObject, а компонент или GameObject остается включенным/активным в сцене (вариант по умолчанию), это предупреждение можно спокойно проигнорировать. **Однако при создании сцены с пониманием сцены необходимо создать пустую GameObject в корне и присоединить `AsyncCoroutineRunner` к ней скрипт, иначе понимание сцены может работать неправильно.**
::: moniker-end

#### <a name="configuring-the-observer-service"></a>Настройка службы наблюдателя

Выберите объект игры "Микседреалититулкит" и проверьте инспектор.

![Сцена, в которой понимается расположение в иерархии](../images/spatial-awareness/MRTKHierarchy.png)

![Расположение МРТК в инспекторе](../images/spatial-awareness/MRTKLocation.png)

Эти параметры позволяют настроить `WindowsSceneUnderstandingObserver` .

### <a name="example-script"></a>Пример сценария

В примере сценария _демосценеундерстандингконтроллер. CS_ демонстрируются основные понятия, связанные с работой со службой "сцена".

* Подписка на сцену основные сведения о событиях
* Обработка событий сцены
* Настройка `WindowsSceneUnderstandingObserver` среды выполнения

Переключатели на панели сцены изменяют поведение сцены в представлении "наблюдатель", вызывая открытые функции этого примера скрипта.

При включении *создания экземпляра Prefabs* будет продемонстрировано создание объектов, размер которых должен соответствовать всем [спатиалаваренесссценеобжект](xref:Microsoft.MixedReality.Toolkit.Experimental.SpatialAwareness.SpatialAwarenessSceneObject), собираются в соответствии с родительским объектом.

![Параметры демонстрационного контроллера](../images/spatial-awareness/Controller.png)

### <a name="built-app-notes"></a>Заметки о построении приложения

Создавайте и развертывайте в HoloLens стандартным способом. После запуска для воспроизведения этих функций должно отобразиться несколько кнопок.

Обратите внимание, что некоторые отчасти отправляют запросы наблюдателю. Неверная настройка результата запроса выборки в полезных данных события, не содержащих ожидаемые данные. Например, если один из них не запрашивает четыре числа, текстуры маски перекрытия не будут отображаться. Как и в разумных случаях, универсальные сети не отображаются, если наблюдатель не настроен на запрос сеток. Сценарий позаботится `DemoSceneUnderstandingController` о некоторых из этих зависимостей, но не на всех.

Доступ к сохраненным файлам сцены можно получить на [портале устройств](/windows/mixed-reality/using-the-windows-device-portal) по адресу `User Folders/LocalAppData/[APP_NAME]/LocalState/PREFIX_yyyyMMdd_hhmmss.bytes` . Эти файлы сцены можно использовать в редакторе, указывая их в профиле наблюдателя, который находится в инспекторе.

![Расположение файла (байт) на портале устройства](../images/spatial-awareness/BytesInDevicePortal.png)

![Байты сериализованной сцены в наблюдателе](../images/spatial-awareness/BytesLocationInObserver.png)

## <a name="see-also"></a>См. также

* [Общие сведения о сцене](/windows/mixed-reality/scene-understanding)
* [Общие сведения о пакете SDK для сцены](/windows/mixed-reality/scene-understanding-sdk)