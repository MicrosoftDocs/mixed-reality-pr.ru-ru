---
title: Размещение касанием
description: Документация по MRTK TapToPlace
author: CDiaz-MS
ms.author: cadia
ms.date: 01/12/2021
ms.localizationpriority: high
keywords: Unity, HoloLens, HoloLens 2, смешанная реальность, разработка, MRTK, размещение касанием, Tap to Place,
ms.openlocfilehash: 1664509a08c2d589d22b71df580328f3f3655c61
ms.sourcegitcommit: f338b1f121a10577bcce08a174e462cdc86d5874
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/01/2021
ms.locfileid: "113176405"
---
# <a name="tap-to-place"></a>Размещение касанием

![TapToPlace](../../images/solver/tap-to-place/TapToPlaceIntroGif.gif)

Размещение касанием — это компонент дальнего взаимодействия, который используется для размещения игрового объекта на поверхности. Он полезен для размещения объектов на виртуальной сетке. Для размещения объекта с помощью этого компонента требуется сочетание двух щелчков мыши и движение головой. Щелкните, чтобы начать размещение, сделайте движение головой, чтобы управлять положением объекта, и щелкните, чтобы поместить объект на сцене.

## <a name="using-tap-to-place"></a>Использование размещения касанием

1. Настройка сцены
    - Создание сцены Unity
    - Добавьте MRTK в сцену, перейдя к **Mixed Reality Toolkit** (Набор средств смешанной реальности)  >  **Add to Scene and Configure** (Добавить в сцену и настроить).
    > [!NOTE]
    > Размещение касанием использует щелчки, которые управляются системой ввода MRTK, но им также можно управлять без щелчков. Чтобы узнать, как, см. раздел "Настройка кода для размещения касанием" ниже.
    - Добавьте куб в сцену и измените масштаб на 0,2, а расположение — на (0; 0; 0,7).
1. Присоедините [размещение касанием](xref:Microsoft.MixedReality.Toolkit.Utilities.Solvers.TapToPlace) к игровому объекту с помощью коллайдера.

    ![TapToPlaceInspector](../../images/solver/tap-to-place/TapToPlaceInspector2.png)

    - При добавлении компонента размещения касанием будет также присоединен обработчик решателя. Размещение касанием происходит от класса [Solver](solver.md), для которого требуется обработчик решателя. Расположение объекта размещения касанием вычисляется относительно элемента `TrackedTargetType` в обработчике решателя. По умолчанию заголовком является `TrackedTargetType`, т. е. при движении головой объект следует за ней, если он выбран.  `TrackedTargetType` также можно задать значение луча контроллера, в котором объект следует за контроллером. Первой группой свойств в инспекторе размещения касанием являются [общие свойства решателя](solver.md#common-solver-properties).  
    > [!IMPORTANT]
    > Размещение касанием — это автономный решатель, который невозможно поставить в цепочку с другими решателями. Он не может быть помещен в цепочку, так как SolverHandler.UpdateSolvers используется для обновления расположения объекта во время его размещения.
    - Свойства размещения касанием:
        - `Auto Start`: если задано значение True, решатель размещения касанием начнет управлять положением игрового объекта для размещения. Объект немедленно начнется следовать за TrackedTargetType (головой или лучом контроллера). Это значение должно быть изменено перед вызовом Start() для выполнения любого действия.
        - `Default Placement Distance`: расстояние по умолчанию (в метрах), на которое будет помещен объект по отношению к TrackedTargetType вперед в SolverHandler. Игровой объект будет размещен на расстоянии по умолчанию, если поверхность не достигнута лучом.
        - `Max Raycast Distance`: максимальное расстояние (в метрах) для луча, основанное на источнике TrackedTargetType. Этот луч ищет поверхность для размещения выбранного объекта.
        - `UseDefaultSurfaceNormalOffset`: это свойство имеет значение True по умолчанию, что гарантирует, что размещаемый объект будет располагаться на поверхности. Если это свойство имеет значение True, то вместо любого значения, указанного для свойства `SurfaceNormalOffset`, будет применено стандартное смещение нормали поверхности по умолчанию. Если задано значение False, будет применено значение для `SurfaceNormalOffset`. Смещение нормали поверхности по умолчанию — это экстент коллайдера вдоль оси Z.
        - `Surface Normal Offset`: расстояние между центром игрового объекта, который нужно разместить, и нормали поверхности, если луч достигает поверхности. Это свойство применяется к объекту только в том случае, если `UseDefaultSurfaceNormalOffset` имеет значение False.
        - `Keep Orientation Vertical`: если значение равно True, игровой объект будет находиться вертикально и на одной линии с Vector3.up.
        - `Rotate According to Surface`: если значение равно False, то размещаемый игровой объект не будет изменять свой поворот в зависимости от удара по поверхности.  Объект будет оставаться повернутым к камере, пока IsBeingPlaced имеет значение True.
        - `Magnetic Surfaces`: массив объектов LayerMasks для выполнения от высшего до самого низкого приоритета. Маска первого слоя, обеспечивающая попадание луча, будет использоваться для расчетов положения.
        - `Debug Enabled`: если значение равно True и в редакторе Unity, нормаль попадания луча будет нарисована желтым цветом. Включенная отладка полезна, если `RotateAccordingToSurface` имеет значение True, так как она рисует нормаль к поверхности, что визуально объясняет, почему объект установлен в текущей ориентации.
        - `On Placing Started`: это событие активируется один раз при выборе игрового объекта, который нужно разместить.
        - `On Placing Stopped`: это событие активируется один раз при отмене выбора размещенного игрового объекта.

1. Тестирование поведения размещения касанием в редакторе
    - Нажмите кнопку воспроизведения и удерживайте пробел, чтобы отобразить руку имитации ввода.
    - Двигайте рукой до тех пор, пока куб не станет активным, и имитируйте щелчок с помощью руки, щелкнув левой кнопкой мыши.
        - Если в сцене отсутствуют коллайдеры, объект будет следовать за объектом `TrackedTargetType` на определенном расстоянии `Default Placement Distance`.
    - Объект будет следовать за перемещением `TrackedTargetType` после выбора. Чтобы имитировать движение головой в редакторе, нажимайте клавиши WASD. Измените поворот головы, щелкнув и удерживая правую кнопку мыши.
    - Чтобы остановить размещение объекта, щелкните еще раз.  Объект не обязательно должен находиться в фокусе при нажатии для завершения размещения. Фокус необходим только для начального щелчка, запускающего процесс размещения.

    `TrackedTargetType`: голова (по умолчанию) |  `TrackedTargetType`: луч контроллера
    :-------------------------:|:-------------------------:
    ![Луч контроля головой для имитации ввода при размещении касанием](../../images/solver/tap-to-place/TapToPlaceInputSimulationHead.gif)  |  ![Луч контролера для имитации ввода при размещении касанием 2](../../images/solver/tap-to-place/TapToPlaceInputSimulationControllerRay.gif)

## <a name="tap-to-place-code-configurability"></a>Настройка кода для размещения касанием

Временем выбора объекта для размещения касанием также можно управлять с помощью `StartPlacement()` и `StopPlacement()` вместо того, чтобы требовать событие щелчка. Эта возможность полезна для написания тестов и предоставляет альтернативный способ размещения объекта в редакторе без использования системы ввода MRTK.

1. Создайте пустой игровой объект.
1. Создайте и присоедините следующий пример скрипта к пустому игровому объекту.

    ```c#
    using UnityEngine;
    using Microsoft.MixedReality.Toolkit.Utilities.Solvers;

    public class TapToPlaceInputExample : MonoBehaviour
    {
        private GameObject cube;
        private TapToPlace tapToPlace;

        void Start()
        {
            cube = GameObject.CreatePrimitive(PrimitiveType.Cube);
            cube.transform.localScale = Vector3.one * 0.2f;
            cube.transform.position = Vector3.forward * 0.7f;

            tapToPlace = cube.AddComponent<TapToPlace>();
        }

        void Update()
        {
            if (Input.GetKeyDown(KeyCode.U))
            {
                tapToPlace.StartPlacement();
            }
            if (Input.GetKeyDown(KeyCode.I))
            {
                tapToPlace.StopPlacement();
            }
        }
    }
    ```

1. В режиме воспроизведения нажмите клавишу *U*, чтобы начать размещение куба.
1. Нажмите клавишу *I*, чтобы прервать размещение.

## <a name="tap-to-place-example-scene"></a>Пример сцены с размещением касанием

Пример сцены с размещением касанием состоит из четырех размещенных объектов, каждый из которых имеет разную конфигурацию. Пример сцены содержит стены, которые показывают поведение размещения поверхности, отключенное по умолчанию в иерархии. Пример сцены можно найти в пакете Unity Microsoft.MixedReality.Toolkit.Unity.Examples на [странице выпуска](https://github.com/Microsoft/MixedRealityToolkit-Unity/releases). Расположение сцены: *MRTK.Examples/Demos/Solvers/Scenes/TapToPlaceExample.unity*

![Пример размещения касанием](../../images/solver/tap-to-place/TapToPlaceExampleScene.gif)

## <a name="see-also"></a>См. также

- [Решатели](solver.md)
- [Отслеживание пространственного положения](../../spatial-awareness/spatial-awareness-getting-started.md)
- [Имитация ввода](../../input-simulation/input-simulation-service.md)
- [Отслеживание рук](../../input/hand-tracking.md)
- [Взгляд](../../input/gaze.md)
