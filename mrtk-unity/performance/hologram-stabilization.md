---
title: Голограмма стабилизации
description: Производительность голограмм в разных условиях и частоте кадров.
author: keveleigh
ms.author: kurtie
ms.date: 01/12/2021
keywords: Unity, HoloLens, HoloLens 2, смешанная реальность, разработка, мртк, отслеживание среды, TMP,
ms.openlocfilehash: 7aab167f2d850a4bca88a2cc40aae4f3cc50fb4b
ms.sourcegitcommit: f338b1f121a10577bcce08a174e462cdc86d5874
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/01/2021
ms.locfileid: "113176479"
---
# <a name="hologram-stabilization"></a>Голограмма стабилизации

## <a name="performance"></a>Производительность

Чтобы базовая платформа и устройство смешанной реальности могли добиться наилучших результатов, важно достичь частоты кадров. Целевая частота кадров (например, 60 кадров/с/90 кадров/с) различается для разных платформ и устройств. Однако у приложений смешанной реальности частота кадров будет стабильной, а также эффективным отслеживанием головок, отслеживанием и многое другое.  

## <a name="environment-tracking"></a>Отслеживание окружения

Стабильная Визуализация с интенсивной обработкой в значительной степени полагается на устройство & платформы. Unity выполнит визуализацию сцены каждый кадр из фотоаппарата, выдаваемый базовой платформой. Если отслеживание не соответствует фактическому перемещению головного, то голограммы будут отображаться визуально неточно. это особенно очевидно и важно для устройств AR, таких как HoloLens, где пользователи могут связывать виртуальные голограммы с реальным миром. Производительность важна для надежного отслеживания головок, но также могут существовать и [другие важные функции](/windows/mixed-reality/environment-considerations-for-hololens). Типы элементов среды, влияющие на взаимодействие с пользователем, зависят от конкретной платформы.

## <a name="windows-mixed-reality"></a>Windows Mixed Reality

платформа Windows Mixed Reality содержит некоторые [справочные материалы](/windows/mixed-reality/hologram-stability) по голограммам стабилизации на платформе. Существует несколько ключевых средств, которые разработчики могут использовать для улучшения визуальной визуализации пользователей.

### <a name="depth-buffer-sharing"></a>Общий доступ к буферу глубины

Разработчики Unity имеют возможность совместно использовать буфер глубины приложения с платформой. Это предоставляет сведения, в которых существует голограмма для текущего кадра, которую платформа может использовать для стабилизации голограмм с помощью процесса аппаратной поддержки, известного как Late-Stage переработка.

#### <a name="late-stage-reprojection"></a>Перепроецирование с поздним этапом

по завершении отрисовки кадра Windows Mixed Realityная платформа принимает цветовые & целевые объекты рендеринга глубины, созданные приложением, и преобразует окончательный вывод на экран, чтобы учитывать любое небольшое перемещение по головному плану с момента последнего прогнозирования. Для выполнения цикла игры приложения требуется время. Например, в 60/с, это означает, что приложение занимает ~ 16.667 MS для отрисовки кадра. Несмотря на то, что это может показаться считанные мгновениям временем, положение и ориентация пользователя в голову изменятся в результате создания матрицы проекции для камеры в процессе подготовки к просмотру. Переработка с поздним этапом переводит пикселы в окончательном изображении, чтобы учитывать эту новую перспективу.

#### <a name="per-pixel-vs-stabilization-plane-lsr"></a>Стабилизации плоскость на уровне пикселов и ЛСР

в зависимости от конечной точки устройства и версии ос, работающей на Windows Mixed Reality устройстве, алгоритм репроекции Late-Stage будет выполняться на пиксель или с помощью [плоскости стабилизации](/windows/mixed-reality/hologram-stability#stabilization-plane).

##### <a name="per-pixel-depth-based"></a>На основе глубины на пиксель

Изменение на основе глубины на уровне пикселя предполагает использование буфера глубины для изменения выходных данных изображения на пиксель и, таким образом, приводит к стабилизации голограмм на различных расстояниях. Например, сфера 1м может находиться перед основополагающей стороной, 10 миллионов. Пиксели, представляющие сферу, будут иметь другое преобразование, чем далеко пикселы, представляющие основополагающий аспект, если пользователь немного наклонен его заголовок. При перепроецировании на каждый пиксель будет учитывать это различие расстояния на каждом пикселе для более точной реорганизации.

##### <a name="stabilization-plane"></a>Плоскость стабилизации

Если невозможно создать точный буфер глубины для совместного использования с платформой, в другой форме ЛСР используется плоскость стабилизации. Все голограммы в сцене получат некоторые стабилизации, но самые отдаленные области будут иметь максимальный стабилизации оборудования. Точка и нормальный уровень плоскости можно предоставить платформе через API *холографиксеттингс. сетфокуспоинтфорфраме* [, предоставляемый Unity](/windows/mixed-reality/focus-point-in-unity).

#### <a name="depth-buffer-format"></a>Формат буфера глубины

если нацеливание на HoloLens для разработки, настоятельно рекомендуется использовать формат буфера 16-разрядной глубины по сравнению с 24-битным. Это может сэкономить невероятно на производительности, хотя значения глубины будут иметь меньшую точность. Чтобы компенсировать меньшую точность и избежать [борьбы с z](https://en.wikipedia.org/wiki/Z-fighting), рекомендуется уменьшить [далеко плоскость отсечения](https://docs.unity3d.com/Manual/class-Camera.html) от 1000m значения по умолчанию, установленного Unity.

> [!NOTE]
> Если используется *16-разрядный формат глубины*, требуемые эффекты для буфера набора элементов не будут работать, так как [Unity не создает буфер шаблона](https://docs.unity3d.com/ScriptReference/RenderTexture-depth.html) в этом параметре. Если выбрать *24-разрядный формат глубины* , то, как правило, будет создавать [8-разрядный буфер трафаретов](https://docs.unity3d.com/Manual/SL-Stencil.html), если это применимо на графической платформе конечной платформы.

#### <a name="depth-buffer-sharing-in-unity"></a>Совместное использование буфера глубины в Unity

Для использования ЛСР на основе глубины необходимо выполнить два важных действия, которые требуются разработчикам.

1. в разделе **изменение**  >  **Project Параметры**  >  **проигрыватель**  >  **XR Параметры**  >  **пакеты sdk для Virtual Reality** > включить **общий доступ к буферу глубины**
    1. если нацеливание на HoloLens, рекомендуется также выбрать **16-разрядный формат глубины** .
1. При отрисовке цвета на экране также отображается глубина изображения.

[Непрозрачные объекты gameobject](https://docs.unity3d.com/Manual/StandardShaderMaterialParameterRenderingMode.html) в Unity обычно автоматически записываются в глубину. Однако прозрачные & текстовые объекты, как правило, не записываются в глубину по умолчанию. если использовать Pro стандартный шейдер или сетку текста мртк, это может быть легко исправленоо.

> [!NOTE]
> чтобы быстро определить, какие объекты в сцене не записываются в буфер глубины визуально, можно использовать [служебную программу *буфера глубины визуализации*](../configuration/mixed-reality-configuration-guide.md#editor-utilities) в *редакторе Параметры* в профиле конфигурации мртк.

##### <a name="transparent-mrtk-standard-shader"></a>Прозрачный МРТК Стандартный шейдер

Для прозрачных материалов, использующих [стандартный шейдер мртк](../features/rendering/MRTK-standard-shader.md), выберите материал для просмотра в окне *инспектора* . Затем нажмите кнопку *исправить сейчас* , чтобы преобразовать материал для записи в глубину (т. е. Z-Write On).

До

![Буфер глубины перед исправлением стандартного шейдера МРТК](../features/images/performance/DepthBufferFixNow_Before.PNG)

После

![Фиксированный буфер глубины fixed МРТК Стандартный шейдер](../features/images/performance/DepthBufferFixNow_After.PNG)

##### <a name="text-mesh-pro"></a>Сетка текста Pro

для текстового сетки Pro объекты выберите GameObject TMP, чтобы просмотреть их в инспекторе. В разделе «материал» переключите шейдер для назначенного материала, чтобы использовать шейдер МРТК Текстмешпро.

![сетевая сетка Pro исправление буфера глубины](../features/images/performance/TextMeshPro-DepthBuffer-Fix.PNG)

##### <a name="custom-shader"></a>Пользовательский шейдер

При написании пользовательского шейдера добавьте [флаг зврите](https://docs.unity3d.com/Manual/SL-CullAndDepth.html) в начало определения блока *Pass* , чтобы настроить шейдер для записи в буфер глубины.

```
Shader "Custom/MyShader"
{
    SubShader
    {
        Pass
        {
            ...
            ZWrite On
            ...
        }
    }
}
```

##### <a name="opaque-backings"></a>Непрозрачные резервные копии

Если указанные выше методы не работают в данном сценарии (т. е. с помощью пользовательского интерфейса Unity можно записать другой объект в буфер глубины. Распространенным примером является использование текста пользовательского интерфейса Unity на плавающей панели в сцене. Сделав панель непрозрачной или по крайней мере запись глубиной, текст & панели будет стабилизироваться платформой, так как их значения z близки друг к другу.

### <a name="worldanchors-hololens"></a>Ворлданчорс (HoloLens)

Наряду с соблюдением правильных конфигураций для обеспечения стабильности визуальной системы важно обеспечить стабильность работы голограмм на правильных физических местоположениях. Чтобы сообщить платформе о важных расположениях в физическом пространстве, разработчики могут использовать [ворлданчорс](https://docs.unity3d.com/ScriptReference/XR.WSA.WorldAnchor.html) на объекты gameobject, которые должны остаться в одном месте. [Ворлданчор](https://docs.unity3d.com/ScriptReference/XR.WSA.WorldAnchor.html) — это компонент, добавленный в GameObject, который получает абсолютный контроль над преобразованием этого объекта.

такие устройства, как HoloLens, постоянно проводят проверку и изучение среды. таким образом, так как HoloLens отслеживает перемещение & положение в пространстве, его оценки будут обновлены, а [система координат Unity будет скорректирована](/windows/mixed-reality/coordinate-systems-in-unity). например, если GameObject помещается в 1 мб с камеры при запуске, так как HoloLens отслеживает окружение, это может считать физическую точку, где расположен GameObject, на самом деле 1,1. Это приведет к смещению голограммы. Применение Ворлданчор к GameObject включит привязку для управления преобразованием объекта, чтобы объект оставался в правильном физическом расположении (т. е. Обновление до версии 1.1 вместо 1м в среде выполнения. Чтобы сохранить [ворлданчорс](https://docs.unity3d.com/ScriptReference/XR.WSA.WorldAnchor.html) в сеансах приложений, разработчики могут использовать [ворлданчорсторе](https://docs.unity3d.com/ScriptReference/XR.WSA.Persistence.WorldAnchorStore.html) для [сохранения и загрузки ворлданчорс](/windows/mixed-reality/persistence-in-unity).

> [!NOTE]
> После добавления компонента Ворлданчор в GameObject невозможно изменить преобразование GameObject (т. е. Transform. Disposition = x). Разработчик должен удалить Ворлданчор, чтобы изменить преобразование.

```c#
WorldAnchor m_anchor;

public void AddAnchor()
{
    this.m_anchor = this.gameObject.AddComponent<WorldAnchor>();
}

public void RemoveAnchor()
{
    DestroyImmediate(m_anchor);
}
```

Если требуется альтернатива ручной работе с привязками, ознакомьтесь со средствами Microsoft World Lock Tools. 

> [!div class="nextstepaction"]
> [Установка с помощью средства «MR»](https://microsoft.github.io/MixedReality-WorldLockingTools-Unity/DocGen/Documentation/HowTos/WLTviaMRFeatureTool.html)

## <a name="see-also"></a>См. также статью

- [Производительность](../performance/perf-getting-started.md)
- [Рекомендации по среде для HoloLens](/windows/mixed-reality/environment-considerations-for-hololens)
- [Голограмма, стабильность Windows Mixed Reality](/windows/mixed-reality/hologram-stability)
- [Точка фокусировки в Unity](/windows/mixed-reality/focus-point-in-unity)
- [Системы координат в Unity](/windows/mixed-reality/coordinate-systems-in-unity)
- [Сохраняемость в Unity](/windows/mixed-reality/persistence-in-unity)
- [Основные сведения о производительности смешанной реальности](/windows/mixed-reality/understanding-performance-for-mixed-reality)
- [Рекомендации по производительности для Unity](/windows/mixed-reality/performance-recommendations-for-unity)
