---
title: Пример использования. Создание Galaxy в смешанной реальности
description: Узнайте о приложении "Обозреватель Galaxy" и о том, как оно было создано для Microsft HoloLens и в течение 24-часового опроса Twitter разработчиками сообщества.
author: karimluccin
ms.author: kaluccin
ms.date: 03/21/2018
ms.topic: article
keywords: Galaxy Explorer, HoloLens, Windows Mixed Reality, поделиться своей идеей, пример внедрения
ms.openlocfilehash: 0226c38e9fa21407a7a6529693a2adb3c5da7659
ms.sourcegitcommit: 2329db5a76dfe1b844e21291dbc8ee3888ed1b81
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "98009784"
---
# <a name="case-study---creating-a-galaxy-in-mixed-reality"></a>Пример использования. Создание Galaxy в смешанной реальности

Прежде чем приступить к работе с Microsoft HoloLens, мы спросили наше сообщество разработчиков, какого рода приложение хотели бы видеть для нового устройства опытную внутреннюю сборку. Было предоставлено более 5000 идей, и после опроса Twitter за 24 часа победителем является идея [Galaxy Explorer](../develop/unity/galaxy-explorer.md).

Энди Зибитс, ведущий сотрудник по проекту и Карим ЛукЦин, графический инженер команды, расскажу о совместной работе между искусством и проектированием, которые привели к созданию точного интерактивного представления Млечный путь Galaxy в Galaxy Explorer.

## <a name="the-tech"></a>Технический

[Наша группа](../develop/unity/galaxy-explorer.md#meet-the-team) состоит из двух конструкторов, трех разработчиков, четырех исполнителей, производителя и одного инженера-тестировщика, для создания полнофункционального приложения, которое позволило бы людям изучать и исследовать огромное и привлекательность нашего Млечный путьного Galaxy.

Мы хотели воспользоваться всеми преимуществами использования HoloLens для отрисовки трехмерных объектов непосредственно в своем собственном пространстве, поэтому мы решили создать реалистичный взгляд на Galaxy, где люди смогут увеличить и увидеть отдельные звезды, каждый на их собственном траекторий.

В течение первой недели разработки мы получили несколько целей для нашего представления Млечный путьного способа Galaxy: он нуждается в глубине, перемещении и объемные — заполнении звезд, которые помогут создать форму Galaxy.

Проблема с созданием анимированного Galaxy, которому были выделены миллиарды звезд, заключается в том, что количество отдельных элементов, нуждающихся в обновлении, будет слишком большим для каждого кадра, чтобы объект HoloLens мог анимировать с помощью ЦП. Наше решение потребовало сложного сочетания искусства и науки.

## <a name="behind-the-scenes"></a>Сопутствующие ресурсы

Чтобы позволить людям исследовать отдельные звезды, наш первый шаг — выяснить, сколько частиц можно было визуализировать одновременно.

### <a name="rendering-particles"></a>Отрисовка частиц

Текущие ЦП отлично подходят для обработки последовательных задач и до нескольких параллельных задач одновременно (в зависимости от количества ядер), но графические процессоры гораздо более эффективны при обработке тысяч операций параллельно. Однако, поскольку они обычно не используют общую память для ЦП, Обмен данными между ЦП<>GPU может быстро стать узким местом. Наше решение состояло в том, чтобы сделать Galaxy на GPU, и он должен полностью прожить на GPU.

Мы начали стрессовые тесты с тысячами точек в различных шаблонах. Это позволило нам получить Galaxy на HoloLens, чтобы узнать, что вы работали и чего не сделали.

### <a name="creating-the-position-of-the-stars"></a>Создание расположения звезд

Один из наших участников команды уже написал код C#, который мог бы создать звезды на их начальной позиции. Звезды располагаются на эллипсе, и их положения могут быть описаны (**курвеоффсет**, **еллипсесизе**, **повышение прав**), где **курвеоффсет** — угол звезды на эллипсе, **Еллипсесизе** — это измерение эллипса вдоль X и Z, а также повышенная высота звездочки в Galaxy. Таким образом, можно создать буфер ([Компутебуффер Unity](https://docs.unity3d.com/ScriptReference/ComputeBuffer.html)), который будет инициализирован с каждым атрибутом звезды, и отправить его на GPU, где он будет использоваться для оставшейся работы. Чтобы нарисовать этот буфер, мы используем [Дравпроцедурал Unity](https://docs.unity3d.com/ScriptReference/Graphics.DrawProcedural.html) , который позволяет запускать шейдер (код на GPU) в произвольном наборе точек без фактической сетки, представляющей Galaxy:

**ЗАГРУЗКИ**




```
GraphicsDrawProcedural(MeshTopology.Points, starCount, 1);
```

**СОВМЕЩЕН**




```
v2g vert (uint index : SV_VertexID)
{

 // _Stars is the buffer we created that contains the initial state of the system
 StarDescriptor star = _Stars[index];
 …

}
```

Мы начали с необработанными циклическими шаблонами с тысячами частиц. Это позволило нам проверить, что нам нужно было бы управлять многими частицами и запускать их с помощью производительных скоростей, но мы не удовлетворены общей формой Galaxy. Чтобы улучшить форму, мы попытались попытаться выполнить различные закономерности и системы частиц с поворотом. Это было первоначальное расчетное обусловлено тем, что число частиц и неизменности производительности согласовывается, но фигура раскрывается в центре, а звезды выводятся в направлении, что не было реалистичным. Мы потребовали эмиссию, которая позволила бы нам управлять временем, а частицы — реалистично передвигаться ближе к центру Galaxy.

![Мы попытались поворачивать различные закономерности и системы частей, которые поворачиваются, подобно этим.](images/galaxy-patterns-500px.png)

Мы попытались поворачивать различные закономерности и системы частей, которые поворачиваются, подобно этим.

Наша группа выполнила некоторые исследования о способе ГАЛАКСИЕС функции и предоставила пользовательскую систему частиц, специально предназначенную для Galaxy, чтобы мы могли перемещать частицы на эллипсы на основе «[теории» плотности](https://en.wikipedia.org/wiki/Density_wave_theory), которые сеоризес, что руки Galaxy являются областями с более высокой плотностью, но в постоянный Flux, как Застревание трафика. Он выглядит стабильным и сплошным, но звезды фактически перемещаются и выходят с руки по мере их перемещения по соответствующим эллипсам. В нашей системе частицы никогда не существовали на ЦП — мы создаем карты и расходим их всем на GPU, так что вся система – это просто начальное состояние и время. Он выполняется следующим образом:

![Ход выполнения системы частиц с отрисовкой GPU](images/spiral-galaxy-arms-500px.jpg)

Ход выполнения системы частиц с отрисовкой GPU


Когда добавляются достаточное многоточия и для них устанавливается значение повернуть, ГАЛАКСИЕС начался в виде «подлокотников», где сходится движение звезд. Для расстояния звезд на каждом эллиптическом пути было определено случайное значение, и каждая звездочка получит немного места. Это создало гораздо более естественное распределение «перемещения звезд» и «фигура ARM». Наконец, мы добавили возможность делать цвета на основе расстояния от центра.

### <a name="creating-the-motion-of-the-stars"></a>Создание движения звезд

Чтобы анимировать общее движение звезды, нам требовалось добавить постоянный угол для каждого кадра и получить звезды, перемещающиеся вдоль эллипсов, на постоянной скорости радиального круга. Это основная причина использования **курвеоффсет**. Это не так хорошо, как звезды будут быстро перемещаться по длинным сторонам эллипса, но в целом это далеко не так.

![Звезды перемещаются быстрее на длинную дугу, медленнее по краям.](images/ellipse-movement.jpg)

Звезды перемещаются быстрее на длинную дугу, медленнее по краям.


При этом каждая звезда полностью описывается (**курвеоффсет**, **еллипсесизе**, **повышение прав**, **возраст**), где **Age** — это совокупность общего времени, которое прошло с момента загрузки сцены.




```
float3 ComputeStarPosition(StarDescriptor star)
{

  float curveOffset = star.curveOffset + Age;
  
  // this will be coded as a “sincos” on the hardware which will compute both sides
  float x = cos(curveOffset) * star.xRadii;
  float z = sin(curveOffset) * star.zRadii;
   
  return float3(x, star.elevation, z);
  
}
```

Это позволило нам создавать десятки тысяч звезд один раз в начале приложения, а затем анимировать один набор звезд вдоль установленных кривых. Так как все работает на GPU, система может анимировать все звезды в параллельном режиме, не изменяя ЦП.

![Вот как это выглядит при рисовании белых чисел.](images/drawing-white-quads-300px.jpg)

Вот как это выглядит при рисовании белых чисел.



Чтобы сделать каждую двухмерную камеру, мы использовали шейдер Geometry для преобразования каждой из позиций звезды в плоский прямоугольник на экране, который будет содержать нашу текстуру звезды.

![Ромбы вместо четырех.](images/drawing-white-quads-300px.jpg)

Ромбы вместо четырех.


Так как мы хотели ограничить перерисовку (количество попыток обработки пикселя), мы поменяли наши четыре, чтобы они были менее перекрываться.

### <a name="adding-clouds"></a>Добавление облаков

Существует множество способов получить объемныеное чувство с частицами — от луча марта в рамках тома до отрисовки максимально возможного количества частиц для имитации облака. В режиме реального времени луч в марте был бы слишком дорогостоящим и трудным для создания, поэтому мы сначала попытались создать фальшивый систему с помощью метода для визуализации лесов в играх — с большим количеством двумерных изображений с деревьями, направленными на камеру. Когда мы делаем это в игре, можно получить текстуры деревьев, отображаемых с камеры, которая поворачивает, сохранить все эти изображения и во время выполнения для каждой карточки объявления выбрать изображение, соответствующее направлению представления. Это не подходит, если изображения являются голограммами. Различие между левым глазом и верным глазом делает его таким образом, чтобы нам было необходимо более высокое разрешение, или же оно просто выглядит плоским, псевдонимом или повторяющимся.

При второй попытке мы попытались иметь как можно больше частиц. Лучшие визуальные элементы были достигнуты, когда мы добавили частицы и размытые, прежде чем добавлять их в сцену. Типичные проблемы, связанные с этим подходом, связаны с тем, сколько частиц можно было рисовать в одно время, а также о том, какая область экрана она охватывает, сохраняя 60fps. Размытие полученного изображения для получения этого облака обычно является очень дорогостоящей операцией.

![Без текстуры это будут выглядеть облака с непрозрачностью 2%.](images/clouds-without-texture-300px.jpg)

Без текстуры это будут выглядеть облака с непрозрачностью 2%.



Аддитивное и наличие большого количества таких элементов означает, что у нас будет несколько четырех поверх друг друга, которые будут многократно закрасить один и тот же пиксель. В центре Galaxy один и тот же пиксель имеет сотни тысяч поверх друг друга, и это имело огромное значение при заполнении во весь экран.

При выполнении полноэкранных облаков и попытке размытия они были бы плохой идеей, поэтому мы решили позволить оборудованию выполнять работу за нас.

### <a name="a-bit-of-context-first"></a>Первый контекст

При использовании текстур в игре размер текстуры редко будет совпадать с областью, в которой мы хотим использовать ее, но можно использовать различные виды фильтрации текстур, чтобы получить графическую карту для интерполяции нужного цвета от пикселя текстуры ([Фильтрация текстур](https://msdn.microsoft.com/library/dn642451.aspx)). Фильтрация, интересующая нас, — это [билинейнойная фильтрация](https://msdn.microsoft.com/library/windows/desktop/bb172357.aspx) , которая вычислит значение любого пикселя с помощью четырех ближайших соседей.

![Оригинал перед фильтрацией](images/texture-1.png)

![Результат после фильтрации](images/texture-2.png)

Используя это свойство, мы видим, что каждый раз, когда мы пытаемся рисовать текстуру в области дважды, она размыта в результате.

Вместо подготовки к просмотру в полноэкранном режиме и потери ценных миллисекунд мы можем поработать с другими, выполняя визуализацию в маленькую версию экрана. Затем, скопировав эту текстуру и растягивая ее на 2 раза несколько раз, мы вернемся к полноэкранному экрану при размытии содержимого в процессе.

![X3 воспроизводится до полного разрешения.](images/galaxy-resolutions-300px.png)

X3 воспроизводится до полного разрешения.



Это позволило нам получить облачную часть только с долей первоначальных затрат. Вместо того чтобы добавлять облака при полном разрешении, мы рисуем только 1/64th пикселя и просто растяните текстуру до полного разрешения.

![Left, с масштабированием от 1 до 8 до полного разрешения; и Right, с 3 возможностями масштабирования с использованием степени 2.](images/stars-upscaled-300px.jpg)

Left, с масштабированием от 1 до 8 до полного разрешения; и Right, с 3 возможностями масштабирования с использованием степени 2.


Обратите внимание, что попытка перейти от 1/64th размера к полному размеру в одном пути будет выглядеть совершенно иначе, так как графическая карта по-прежнему будет использовать 4 пикселя в нашей программе установки для затенения большего размера области и артефактов.

Затем, если мы добавим звезду с полным разрешением с меньшими картами, мы получаем полное Galaxy:

![Ближайший окончательный результат отрисовки Galaxy с использованием полного числа звезд](images/full-galaxy-500px.png)

После того, как мы находились в правильном расположении с фигурой, мы добавили слой облаков, расвлеки временные точки с теми, которые были окрашены в Photoshop, и добавили дополнительный цвет. Результат был Млечный путьным способом Galaxy наших художественных и инженерных команд, и он отвечает нашим целям, которые имеют глубину, громкость и движение — все это без массового потребления ресурсов ЦП.

![Наш окончательный Млечный путь способ Galaxy трехмерный.](images/final-galaxy-500px.jpg)

Наш окончательный Млечный путь способ Galaxy трехмерный.


### <a name="more-to-explore"></a>Дополнительные сведения

Мы открыли код для приложения Galaxy Explorer и сделали его доступным на сайте [GitHub](https://github.com/Microsoft/GalaxyExplorer) для разработки.

Хотите узнать больше о процессе разработки для Galaxy Explorer? Ознакомьтесь со всеми прошлыми обновлениями проекта в [канале Microsoft HoloLens YouTube](https://www.youtube.com/playlist?list=PLZCHH_4VqpRj0Nl46J0LNRkMyBNU4knbL).

## <a name="about-the-authors"></a>Об авторах

<table style="border:0">
<tr>
<td style="border:0" width="60px"> <img alt="Picture of Karim Luccin at his desk" width="60" height="60" src="images/karim-thumb.jpg" /></td>
<td style="border:0"><b>Карим лукЦин</b> — это инженер по программному обеспечению и визуальные визуализации. Он был инженером графики для Galaxy Explorer.</td>
</tr>
<tr>
<td style="border:0" width="60px"> <img alt="Photo of art lead Andy Zibits" width="60" height="60" src="images/andy-avatar.png" /></td>
<td style="border:0"><b>Энди зибитс</b> является ведущим руководителем и сферой, которая управляет группой трехмерного моделирования для Galaxy Explorer и фаугхт для еще большего числа частиц.</td>
</tr>
</table>


## <a name="see-also"></a>См. также раздел
* [Обозреватель Galaxy на GitHub](https://github.com/Microsoft/GalaxyExplorer)
* [Обновления проектов обозревателя Galaxy на YouTube](https://www.youtube.com/playlist?list=PLZCHH_4VqpRj0Nl46J0LNRkMyBNU4knbL)
