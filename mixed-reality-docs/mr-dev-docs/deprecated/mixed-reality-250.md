---
title: MR-и впечатляющие головные телефоны с высокой доступностью 250
description: Выполните приведенное ниже пошаговое руководство по программированию с помощью Unity, Visual Studio, HoloLens и головных телефонов Windows Mixed Reality, чтобы получить сведения об общем доступе к голограммам между устройствами смешанной реальности.
author: keveleigh
ms.author: kurtie
ms.date: 10/22/2019
ms.topic: article
keywords: холотулкит, микседреалититулкит, микседреалититулкит-Unity, иммерсивное, контроллер движения, совместное использование, контроллер Xbox, сеть, перекрестное устройство
ms.openlocfilehash: a980441ee73cd8f45afff446d9315eaf08549575
ms.sourcegitcommit: 09599b4034be825e4536eeb9566968afd021d5f3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/03/2020
ms.locfileid: "91692225"
---
# <a name="mr-sharing-250-hololens-and-immersive-headsets"></a><span data-ttu-id="d9dd9-104">250. Общий доступ в смешанной реальности: HoloLens и иммерсивные гарнитуры</span><span class="sxs-lookup"><span data-stu-id="d9dd9-104">MR Sharing 250: HoloLens and immersive headsets</span></span>

>[!NOTE]
><span data-ttu-id="d9dd9-105">Руководства Mixed Reality Academy были разработаны для иммерсивных гарнитур HoloLens (1-го поколения) и иммерсивных гарнитур Mixed Reality.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-105">The Mixed Reality Academy tutorials were designed with HoloLens (1st gen) and Mixed Reality Immersive Headsets in mind.</span></span>  <span data-ttu-id="d9dd9-106">Поэтому мы считаем, что важно оставить эти руководства для разработчиков, которые ищут рекомендации по разработке для этих устройств.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-106">As such, we feel it is important to leave these tutorials in place for developers who are still looking for guidance in developing for those devices.</span></span>  <span data-ttu-id="d9dd9-107">Данные руководства **_не_** будут обновляться с учетом последних наборов инструментов или возможностей взаимодействия для HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-107">These tutorials will **_not_** be updated with the latest toolsets or interactions being used for HoloLens 2.</span></span>  <span data-ttu-id="d9dd9-108">Они будут сохранены для работы на поддерживаемых устройствах.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-108">They will be maintained to continue working on the supported devices.</span></span> <span data-ttu-id="d9dd9-109">Опубликован [новый цикл руководств](../mr-learning-base-01.md) для HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-109">[A new series of tutorials](../mr-learning-base-01.md) has been posted for HoloLens 2.</span></span>

<span data-ttu-id="d9dd9-110">Благодаря гибкости универсальная платформа Windows (UWP) легко создать приложение, охватывающее несколько устройств.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-110">With the flexibility of Universal Windows Platform (UWP), it is easy to create an application that spans multiple devices.</span></span> <span data-ttu-id="d9dd9-111">Благодаря этой гибкости мы можем создавать возможности, использующие сильные стороны каждого устройства.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-111">With this flexibility, we can create experiences that leverage the strengths of each device.</span></span> <span data-ttu-id="d9dd9-112">В этом учебнике рассматривается базовый общий интерфейс, который работает на впечатляющих головных и HoloLens и Windows Mixed Reality.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-112">This tutorial will cover a basic shared experience that runs on both HoloLens and Windows Mixed Reality immersive headsets.</span></span> <span data-ttu-id="d9dd9-113">Это содержимое изначально было доставлено на конференцию Microsoft Build 2017 в Сиэтле, штат Вашингтон.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-113">This content was originally delivered at the Microsoft Build 2017 conference in Seattle, WA.</span></span>

<span data-ttu-id="d9dd9-114">**В этом учебнике мы выполним следующее:**</span><span class="sxs-lookup"><span data-stu-id="d9dd9-114">**In this tutorial, we will:**</span></span>

* <span data-ttu-id="d9dd9-115">Настройка сети с помощью УНЕТ.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-115">Setup a network using UNET.</span></span>
* <span data-ttu-id="d9dd9-116">Делитесь голограммами на устройствах смешанной реальности.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-116">Share holograms across mixed reality devices.</span></span>
* <span data-ttu-id="d9dd9-117">Установите другое представление приложения в зависимости от того, какое устройство смешанной реальности используется.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-117">Establish a different view of the application depending on which mixed reality device is being used.</span></span>
* <span data-ttu-id="d9dd9-118">Создавайте общие возможности, когда пользователи HoloLens изменяют впечатляющие гарнитуры с помощью простых головоломок.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-118">Create a shared experience where HoloLens users guide immersive headsets users through some simple puzzles.</span></span>

## <a name="device-support"></a><span data-ttu-id="d9dd9-119">Поддержка устройств</span><span class="sxs-lookup"><span data-stu-id="d9dd9-119">Device support</span></span>

<table>
<tr>
<th><span data-ttu-id="d9dd9-120">Курс</span><span class="sxs-lookup"><span data-stu-id="d9dd9-120">Course</span></span></th><th style="width:150px"> <span data-ttu-id="d9dd9-121"><a href="../hololens-hardware-details.md">HoloLens</a></span><span class="sxs-lookup"><span data-stu-id="d9dd9-121"><a href="../hololens-hardware-details.md">HoloLens</a></span></span></th><th style="width:150px"> <span data-ttu-id="d9dd9-122"><a href="../discover/immersive-headset-hardware-details.md">Иммерсивные гарнитуры</a></span><span class="sxs-lookup"><span data-stu-id="d9dd9-122"><a href="../discover/immersive-headset-hardware-details.md">Immersive headsets</a></span></span></th>
</tr><tr>
<td><span data-ttu-id="d9dd9-123">250. Общий доступ в смешанной реальности: HoloLens и иммерсивные гарнитуры</span><span class="sxs-lookup"><span data-stu-id="d9dd9-123">MR Sharing 250: HoloLens and immersive headsets</span></span></td><td style="text-align: center;"> <span data-ttu-id="d9dd9-124">✔️</span><span class="sxs-lookup"><span data-stu-id="d9dd9-124">✔️</span></span></td><td style="text-align: center;"> <span data-ttu-id="d9dd9-125">✔️</span><span class="sxs-lookup"><span data-stu-id="d9dd9-125">✔️</span></span></td>
</tr>
</table>

## <a name="before-you-start"></a><span data-ttu-id="d9dd9-126">Перед началом работы</span><span class="sxs-lookup"><span data-stu-id="d9dd9-126">Before you start</span></span>

### <a name="prerequisites"></a><span data-ttu-id="d9dd9-127">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="d9dd9-127">Prerequisites</span></span>

* <span data-ttu-id="d9dd9-128">КОМПЬЮТЕР под управлением Windows 10 с [необходимыми средствами разработки](../develop/install-the-tools.md) и [настроенным для поддержки впечатляющих головных телефонов Windows Mixed Reality](https://docs.microsoft.com/windows/mixed-reality/enthusiast-guide/windows-mixed-reality-minimum-pc-hardware-compatibility-guidelines).</span><span class="sxs-lookup"><span data-stu-id="d9dd9-128">A Windows 10 PC with the [necessary development tools](../develop/install-the-tools.md) and [configured to support a Windows Mixed Reality immersive headset](https://docs.microsoft.com/windows/mixed-reality/enthusiast-guide/windows-mixed-reality-minimum-pc-hardware-compatibility-guidelines).</span></span>
* <span data-ttu-id="d9dd9-129">Контроллер Xbox, работающий с вашим ПК.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-129">An Xbox controller that works with your PC.</span></span>
* <span data-ttu-id="d9dd9-130">По крайней мере одно устройство HoloLens и одна иммерсивное гарнитура.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-130">At least one HoloLens device and one immersive headset.</span></span>
* <span data-ttu-id="d9dd9-131">Сеть, допускающая широковещательную передачу по протоколу UDP для обнаружения.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-131">A network which allows UDP Broadcast for discovery.</span></span>

### <a name="project-files"></a><span data-ttu-id="d9dd9-132">Файлы проекта</span><span class="sxs-lookup"><span data-stu-id="d9dd9-132">Project files</span></span>

* <span data-ttu-id="d9dd9-133">Скачайте [файлы](https://github.com/Microsoft/MixedReality250/archive/master.zip) , необходимые для проекта.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-133">Download the [files](https://github.com/Microsoft/MixedReality250/archive/master.zip) required by the project.</span></span> <span data-ttu-id="d9dd9-134">Извлеките файлы в легко запоминающееся место.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-134">Extract the files to an easy to remember location.</span></span>
* <span data-ttu-id="d9dd9-135">Для этого проекта требуется [рекомендуемая версия Unity с поддержкой Windows Mixed Reality](../develop/install-the-tools.md).</span><span class="sxs-lookup"><span data-stu-id="d9dd9-135">This project requires the [a recommended version of Unity with Windows Mixed Reality support](../develop/install-the-tools.md).</span></span>

>[!NOTE]
><span data-ttu-id="d9dd9-136">Если вы хотите просмотреть исходный код перед загрузкой, он [доступен на сайте GitHub](https://github.com/Microsoft/MixedReality250).</span><span class="sxs-lookup"><span data-stu-id="d9dd9-136">If you want to look through the source code before downloading, it's [available on GitHub](https://github.com/Microsoft/MixedReality250).</span></span>

## <a name="chapter-1---holo-world"></a><span data-ttu-id="d9dd9-137">Глава 1 — Холо World</span><span class="sxs-lookup"><span data-stu-id="d9dd9-137">Chapter 1 - Holo World</span></span>

>[!VIDEO https://www.youtube.com/embed/IC0rp6rLiEc]

### <a name="objectives"></a><span data-ttu-id="d9dd9-138">Цели</span><span class="sxs-lookup"><span data-stu-id="d9dd9-138">Objectives</span></span>

<span data-ttu-id="d9dd9-139">Убедитесь, что среда разработки готова к работе с простым проектом.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-139">Make sure the development environment is ready to go with a simple project.</span></span>

### <a name="what-we-will-build"></a><span data-ttu-id="d9dd9-140">Что будет построено</span><span class="sxs-lookup"><span data-stu-id="d9dd9-140">What we will build</span></span>

<span data-ttu-id="d9dd9-141">Приложение, которое показывает голограмму на HoloLens или на иммерсивное гарнитуру Windows Mixed Reality.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-141">An application that shows a hologram on either HoloLens or a Windows Mixed Reality immersive headset.</span></span>

### <a name="steps"></a><span data-ttu-id="d9dd9-142">Шаги</span><span class="sxs-lookup"><span data-stu-id="d9dd9-142">Steps</span></span>

* <span data-ttu-id="d9dd9-143">Откройте Unity.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-143">Open Unity.</span></span>
    * <span data-ttu-id="d9dd9-144">Выберите **Открыть** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-144">Select **Open** .</span></span>
    * <span data-ttu-id="d9dd9-145">Перейдите к папке, в которую вы извлекли файлы проекта.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-145">Navigate to where you extracted the project files.</span></span>
    * <span data-ttu-id="d9dd9-146">Щелкните элемент **Выбор папки** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-146">Click **Select Folder** .</span></span>
    * <span data-ttu-id="d9dd9-147">*В то время как Unity будет в первый раз обрабатывать проект, это займет немного времени.*</span><span class="sxs-lookup"><span data-stu-id="d9dd9-147">*It will take a little while for Unity to process the project the first time.*</span></span>
* <span data-ttu-id="d9dd9-148">Убедитесь, что Смешанная реальность включена в Unity.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-148">Check that Mixed Reality is enabled in Unity.</span></span>
    * <span data-ttu-id="d9dd9-149">Откройте диалоговое окно "параметры сборки" ( **Control + Shift + B** или **файл > параметры сборки...** ).</span><span class="sxs-lookup"><span data-stu-id="d9dd9-149">Open the build settings dialog ( **Control+Shift+B** or **File > Build Settings...** ).</span></span>
    * <span data-ttu-id="d9dd9-150">Выберите **универсальная платформа Windows** а затем выберите **параметр платформа** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-150">Select **Universal Windows Platform** then click **Switch Platform** .</span></span>
    * <span data-ttu-id="d9dd9-151">Выберите **изменить>параметры проигрывателя** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-151">Select **Edit>Player Settings** .</span></span>
    * <span data-ttu-id="d9dd9-152">На панели **инспектора** с правой стороны разверните узел **Параметры XR** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-152">In the **Inspector** panel on the right hand side, expand **XR Settings** .</span></span>
    * <span data-ttu-id="d9dd9-153">Установите флажок **поддерживается виртуальная реальность** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-153">Check the **Virtual Reality Supported** box.</span></span>
    * <span data-ttu-id="d9dd9-154">*Windows Mixed Reality должна быть пакетом SDK виртуальной реальности.*</span><span class="sxs-lookup"><span data-stu-id="d9dd9-154">*Windows Mixed Reality should be the Virtual Reality SDK.*</span></span>
* <span data-ttu-id="d9dd9-155">Создайте сцену.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-155">Create a scene.</span></span>
    * <span data-ttu-id="d9dd9-156">В **иерархии** щелкните правой кнопкой мыши **Главная камера** и выберите **Удалить** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-156">In the **Hierarchy** right click **Main Camera** select **Delete** .</span></span>
    * <span data-ttu-id="d9dd9-157">Из **холотулкит > входные > Prefabs** перетащите **микседреалитикамерапарент** в **иерархию** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-157">From **HoloToolkit > Input > Prefabs** drag **MixedRealityCameraParent** to the **Hierarchy** .</span></span>
* <span data-ttu-id="d9dd9-158">Добавление голограмм в сцену</span><span class="sxs-lookup"><span data-stu-id="d9dd9-158">Add Holograms to the scene</span></span>
    * <span data-ttu-id="d9dd9-159">Из **апппрефабс** перетащите **Скибокс** в **представление сцены** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-159">From **AppPrefabs** drag **Skybox** to the **Scene View** .</span></span>
    * <span data-ttu-id="d9dd9-160">Из **апппрефабс** перетащите **Диспетчеры** в **иерархию** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-160">From **AppPrefabs** drag **Managers** to the **Hierarchy** .</span></span>
    * <span data-ttu-id="d9dd9-161">Из **AppPrefabs** области апппрефабс **перетащите область** в **иерархию** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-161">From **AppPrefabs** drag **Island** to the **Hierarchy** .</span></span>
* <span data-ttu-id="d9dd9-162">Сохранить и собрать</span><span class="sxs-lookup"><span data-stu-id="d9dd9-162">Save And build</span></span>
    * <span data-ttu-id="d9dd9-163">Сохраните (либо **Control + S** , либо **Файловая > сохранить сцену** )</span><span class="sxs-lookup"><span data-stu-id="d9dd9-163">Save (either **Control+S** or **File > Save Scene** )</span></span>
    * <span data-ttu-id="d9dd9-164">Так как это новая сцена, ее необходимо присвоить имя.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-164">Since this is a new scene, you'll need to name it.</span></span> <span data-ttu-id="d9dd9-165">Имя не имеет значения, но мы используем Шаредмикседреалити.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-165">Name doesn't matter, but we use SharedMixedReality.</span></span>
* <span data-ttu-id="d9dd9-166">Экспорт в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="d9dd9-166">Export To Visual Studio</span></span>
    * <span data-ttu-id="d9dd9-167">Откройте меню Сборка ( **Control + Shift + B** или **файл > параметры сборки** ).</span><span class="sxs-lookup"><span data-stu-id="d9dd9-167">Open the build menu ( **Control+Shift+B** or **File > Build Settings** )</span></span>
    * <span data-ttu-id="d9dd9-168">Нажмите кнопку **Добавить открытые сцены.**</span><span class="sxs-lookup"><span data-stu-id="d9dd9-168">Click **Add Open Scenes.**</span></span>
    * <span data-ttu-id="d9dd9-169">Проверка **проектов C# для Unity**</span><span class="sxs-lookup"><span data-stu-id="d9dd9-169">Check **Unity C# Projects**</span></span>
    * <span data-ttu-id="d9dd9-170">Щелкните **Построить** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-170">Click **Build** .</span></span>
    * <span data-ttu-id="d9dd9-171">В открывшемся окне проводника создайте новую папку с именем **app** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-171">In the file explorer window that appears, create a New Folder named **App** .</span></span>
    * <span data-ttu-id="d9dd9-172">Щелкните папку **приложения** одним щелчком мыши.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-172">Single click the **App** folder.</span></span>
    * <span data-ttu-id="d9dd9-173">Нажмите кнопку **выбрать папку.**</span><span class="sxs-lookup"><span data-stu-id="d9dd9-173">Press **Select Folder.**</span></span>
    * <span data-ttu-id="d9dd9-174">**Дождитесь завершения сборки**</span><span class="sxs-lookup"><span data-stu-id="d9dd9-174">**Wait for the build to complete**</span></span>
    * <span data-ttu-id="d9dd9-175">В открывшемся окне проводника перейдите в папку **приложения** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-175">In the file explorer window that appears, navigate into the **App** folder.</span></span>
    * <span data-ttu-id="d9dd9-176">Дважды щелкните **шаредмикседреалити. sln** , чтобы запустить Visual Studio</span><span class="sxs-lookup"><span data-stu-id="d9dd9-176">Double-click **SharedMixedReality.sln** to launch Visual Studio</span></span>
* <span data-ttu-id="d9dd9-177">Сборка из Visual Studio</span><span class="sxs-lookup"><span data-stu-id="d9dd9-177">Build From Visual Studio</span></span>
    * <span data-ttu-id="d9dd9-178">Использование верхней панели инструментов изменяет целевой объект на **выпуск** и **x86** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-178">Using the top toolbar change target to **Release** and **x86** .</span></span>
    * <span data-ttu-id="d9dd9-179">Щелкните стрелку рядом с пунктом **локальный компьютер** и выберите **устройство** для развертывания в HoloLens.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-179">Click the arrow next to **Local Machine** and select **Device** to deploy to HoloLens</span></span>
    * <span data-ttu-id="d9dd9-180">Щелкните стрелку рядом с полем **устройство** и выберите **локальный компьютер** для развертывания на гарнитуре Mixed Reality.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-180">Click the arrow next to **Device** and select **Local Machine** to deploy for the mixed reality headset.</span></span>
    * <span data-ttu-id="d9dd9-181">Щелкните **Отладка->начать без отладки** или **Control + F5** , чтобы запустить приложение.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-181">Click **Debug->Start Without Debugging** or **Control+F5** to start the application.</span></span>

### <a name="digging-into-the-code"></a><span data-ttu-id="d9dd9-182">Продвигаясь вглубь в код</span><span class="sxs-lookup"><span data-stu-id="d9dd9-182">Digging into the code</span></span>

<span data-ttu-id="d9dd9-183">На панели проект перейдите к **ассетс\холотулкит\инпут\скриптс\утилитиес** и дважды щелкните **MixedRealityCameraManager.CS** , чтобы открыть его.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-183">In the project panel, navigate to **Assets\HoloToolkit\Input\Scripts\Utilities** and double click **MixedRealityCameraManager.cs** to open it.</span></span>

<span data-ttu-id="d9dd9-184">**Обзор:** MixedRealityCameraManager.cs — это простой сценарий, который корректирует уровень качества и параметры фона на основе устройства.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-184">**Overview:** MixedRealityCameraManager.cs is a simple script that adjusts quality level and background settings based on the device.</span></span> <span data-ttu-id="d9dd9-185">Здесь следует ключевое поле Холографиксеттингс. Исдисплайопакуе, которое позволяет сценарию определить, является ли устройство HoloLens (Исдисплайопакуе возвращает false) или иммерсивное гарнитура (Исдисплайопакуе возвращает true).</span><span class="sxs-lookup"><span data-stu-id="d9dd9-185">Key here is HolographicSettings.IsDisplayOpaque, which allows a script to detect if the device is a HoloLens (IsDisplayOpaque returns false) or an immersive headset (IsDisplayOpaque returns true).</span></span>

### <a name="enjoy-your-progress"></a><span data-ttu-id="d9dd9-186">Наслаждайтесь ходом выполнения</span><span class="sxs-lookup"><span data-stu-id="d9dd9-186">Enjoy your progress</span></span>

<span data-ttu-id="d9dd9-187">На этом этапе приложение будет просто визуализировать голограмму.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-187">At this point the application will just render a hologram.</span></span> <span data-ttu-id="d9dd9-188">Позже мы добавим взаимодействие к голограмме.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-188">We will add interaction to the hologram later.</span></span> <span data-ttu-id="d9dd9-189">Оба устройства будут отображать голограмму одинаково.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-189">Both devices will render the hologram the same.</span></span> <span data-ttu-id="d9dd9-190">На иммерсивное головной телефон также будет отображаться фон синего и облака.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-190">The immersive headset will also render a blue sky and clouds background.</span></span>

## <a name="chapter-2---interaction"></a><span data-ttu-id="d9dd9-191">Глава 2 — взаимодействие</span><span class="sxs-lookup"><span data-stu-id="d9dd9-191">Chapter 2 - Interaction</span></span>

>[!VIDEO https://www.youtube.com/embed/Lrb1y4sQRvI]

### <a name="objectives"></a><span data-ttu-id="d9dd9-192">Цели</span><span class="sxs-lookup"><span data-stu-id="d9dd9-192">Objectives</span></span>

<span data-ttu-id="d9dd9-193">Показывает, как обрабатывать входные данные для приложения Windows Mixed Reality.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-193">Show how to handle input for a Windows Mixed Reality application.</span></span>

### <a name="what-we-will-build"></a><span data-ttu-id="d9dd9-194">Что будет построено</span><span class="sxs-lookup"><span data-stu-id="d9dd9-194">What we will build</span></span>

<span data-ttu-id="d9dd9-195">Основываясь на приложении из раздела 1, мы добавим функции, позволяющие пользователю выбрать голограмму и разместить ее на реальной поверхности в HoloLens или в виртуальной таблице на современном гарнитуре.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-195">Building on the application from chapter 1, we will add functionality to allow the user to pick up the hologram and place it on a real world surface in HoloLens or on a virtual table in an immersive headset.</span></span>

<span data-ttu-id="d9dd9-196">**Обновитель ввода:** В HoloLens жест выбора — это **касание воздуха** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-196">**Input Refresher:** On HoloLens the select gesture is the **air tap** .</span></span> <span data-ttu-id="d9dd9-197">На впечатляющих гарнитурах мы будем **использовать кнопку на** контроллере Xbox.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-197">On immersive headsets, we will use the **A** button on the Xbox controller.</span></span> <span data-ttu-id="d9dd9-198">Дополнительные сведения см. в [обзоре модели взаимодействия](../design/interaction-fundamentals.md).</span><span class="sxs-lookup"><span data-stu-id="d9dd9-198">For more information check out the [interaction model overview](../design/interaction-fundamentals.md).</span></span>

### <a name="steps"></a><span data-ttu-id="d9dd9-199">Шаги</span><span class="sxs-lookup"><span data-stu-id="d9dd9-199">Steps</span></span>

* <span data-ttu-id="d9dd9-200">Добавление диспетчера ввода</span><span class="sxs-lookup"><span data-stu-id="d9dd9-200">Add Input manager</span></span>
    * <span data-ttu-id="d9dd9-201">Из **холотулкит > входные > Prefabs** перетащите **InputManager** в **иерархию** как дочерний элемент **руководителей** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-201">From **HoloToolkit > Input > Prefabs** drag **InputManager** to **Hierarchy** as a child of **Managers** .</span></span>
    * <span data-ttu-id="d9dd9-202">Из **холотулкит > входные > Prefabs > курсор** перетащите **курсор** в **иерархию** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-202">From **HoloToolkit > Input > Prefabs > Cursor** drag **Cursor** to **Hierarchy** .</span></span>
* <span data-ttu-id="d9dd9-203">Добавить пространственное сопоставление</span><span class="sxs-lookup"><span data-stu-id="d9dd9-203">Add Spatial Mapping</span></span>
    * <span data-ttu-id="d9dd9-204">Из **холотулкит > спатиалмаппинг > Prefabs** перетащите **спатиалмаппинг** в **иерархию** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-204">From **HoloToolkit > SpatialMapping > Prefabs** drag **SpatialMapping** to **Hierarchy** .</span></span>
* <span data-ttu-id="d9dd9-205">Добавить виртуальный Плайспаце</span><span class="sxs-lookup"><span data-stu-id="d9dd9-205">Add Virtual Playspace</span></span>
    * <span data-ttu-id="d9dd9-206">В **иерархии** разверните узел **микседреалитикамерапарент** SELECT **граница**</span><span class="sxs-lookup"><span data-stu-id="d9dd9-206">In **Hierarchy** expand **MixedRealityCameraParent** select **Boundary**</span></span>
    * <span data-ttu-id="d9dd9-207">На панели **инспектора** установите флажок, чтобы включить **границу** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-207">In **Inspector** panel check the box to enable **Boundary**</span></span>
    * <span data-ttu-id="d9dd9-208">Из **апппрефабс** перетащите **вррум** в **иерархию** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-208">From **AppPrefabs** drag **VRRoom** to **Hierarchy** .</span></span>
* <span data-ttu-id="d9dd9-209">Добавить Ворлданчорманажер</span><span class="sxs-lookup"><span data-stu-id="d9dd9-209">Add WorldAnchorManager</span></span>
    * <span data-ttu-id="d9dd9-210">В **иерархии** выберите **Диспетчеры** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-210">In **Hierarchy** , Select **Managers** .</span></span>
    * <span data-ttu-id="d9dd9-211">В **инспекторе** щелкните **Добавить компонент** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-211">In **Inspector** , click **Add Component** .</span></span>
    * <span data-ttu-id="d9dd9-212">Введите **Диспетчер привязок мира** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-212">Type **World Anchor Manager** .</span></span>
    * <span data-ttu-id="d9dd9-213">Выберите **Диспетчер универсальных опорных точек** , чтобы добавить его.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-213">Select **World Anchor Manager** to add it.</span></span>
* <span data-ttu-id="d9dd9-214">Добавление Таптоплаце к острову</span><span class="sxs-lookup"><span data-stu-id="d9dd9-214">Add TapToPlace to the Island</span></span>
    * <span data-ttu-id="d9dd9-215">В **иерархии** разверните узел **остров** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-215">In **Hierarchy** , expand **Island** .</span></span>
    * <span data-ttu-id="d9dd9-216">Выберите **микседреалитиланд** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-216">Select **MixedRealityLand** .</span></span>
    * <span data-ttu-id="d9dd9-217">В **инспекторе** щелкните **Добавить компонент** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-217">In **Inspector** , click **Add Component** .</span></span>
    * <span data-ttu-id="d9dd9-218">Введите **коснитесь, чтобы поместить** и выбрать его.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-218">Type **Tap To Place** and select it.</span></span>
    * <span data-ttu-id="d9dd9-219">Установите флажок " **родительский элемент" для TAP** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-219">Check **Place Parent On Tap** .</span></span>
    * <span data-ttu-id="d9dd9-220">Задайте для **смещения размещения** значение **(0, 0,1, 0)** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-220">Set **Placement Offset** to **(0, 0.1, 0)** .</span></span>
* <span data-ttu-id="d9dd9-221">Сохранить и построить как прежде</span><span class="sxs-lookup"><span data-stu-id="d9dd9-221">Save and Build as before</span></span>

### <a name="digging-into-the-code"></a><span data-ttu-id="d9dd9-222">Продвигаясь вглубь в код</span><span class="sxs-lookup"><span data-stu-id="d9dd9-222">Digging into the code</span></span>

<span data-ttu-id="d9dd9-223">**Сценарий 1 — GamepadInput.cs**</span><span class="sxs-lookup"><span data-stu-id="d9dd9-223">**Script 1 - GamepadInput.cs**</span></span>

<span data-ttu-id="d9dd9-224">На панели проект перейдите к **ассетс\холотулкит\инпут\скриптс\инпутсаурцес** и дважды щелкните **GamepadInput.CS** , чтобы открыть его.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-224">In the project panel navigate to **Assets\HoloToolkit\Input\Scripts\InputSources** and double click **GamepadInput.cs** to open it.</span></span> <span data-ttu-id="d9dd9-225">В том же пути на панели проекта также дважды щелкните **InteractionSourceInputSource.CS** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-225">From the same path in the project panel, also double click **InteractionSourceInputSource.cs** .</span></span>

<span data-ttu-id="d9dd9-226">Обратите внимание, что оба скрипта имеют общий базовый класс Басеинпутсаурце.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-226">Note that both scripts have a common base class, BaseInputSource.</span></span>

<span data-ttu-id="d9dd9-227">Басеинпутсаурце хранит ссылку на InputManager, что позволяет сценарию запускать события.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-227">BaseInputSource keeps a reference to an InputManager, which allows a script to trigger events.</span></span> <span data-ttu-id="d9dd9-228">В этом случае событие Инпуткликкед является существенным.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-228">In this case, the InputClicked event is relevant.</span></span> <span data-ttu-id="d9dd9-229">Это важно помнить при получении сценария 2, Таптоплаце.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-229">This will be important to remember when we get to script 2, TapToPlace.</span></span> <span data-ttu-id="d9dd9-230">В случае с Гамепадинпут мы будем опрашивать кнопку на контроллере, который нужно нажать, а затем вызовут событие Инпуткликкед.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-230">In the case of GamePadInput, we poll for the A button on the controller to be pressed, then we raise the InputClicked event.</span></span> <span data-ttu-id="d9dd9-231">В случае с Интерактионсаурцеинпутсаурце мы создаем событие Инпуткликкед в ответ на Таппедевент.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-231">In the case of InteractionSourceInputSource, we raise the InputClicked event in response to the TappedEvent.</span></span>

<span data-ttu-id="d9dd9-232">**Сценарий 2 — TapToPlace.cs**</span><span class="sxs-lookup"><span data-stu-id="d9dd9-232">**Script 2 - TapToPlace.cs**</span></span>

<span data-ttu-id="d9dd9-233">На панели проект перейдите к **ассетс\холотулкит\спатиалмаппинг\скриптс** и дважды щелкните **TapToPlace.CS** , чтобы открыть его.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-233">In the project panel navigate to **Assets\HoloToolkit\SpatialMapping\Scripts** and double click **TapToPlace.cs** to open it.</span></span>

<span data-ttu-id="d9dd9-234">Первое, что многие разработчики хотят реализовать при создании приложения holographic, — это перемещение голограмм с вводом жестов.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-234">The first thing many developers want to implement when creating a Holographic application is moving Holograms with gesture input.</span></span> <span data-ttu-id="d9dd9-235">Таким образом, мы предоставили тщательное комментирование этого сценария.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-235">As such, we've endeavored to thoroughly comment this script.</span></span> <span data-ttu-id="d9dd9-236">Для этого руководства стоит выделить несколько моментов.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-236">A few things are worth highlighting for this tutorial.</span></span>

<span data-ttu-id="d9dd9-237">Во первых, обратите внимание, что Таптоплаце реализует Иинпуткликкхандлер.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-237">First, note that TapToPlace implements IInputClickHandler.</span></span> <span data-ttu-id="d9dd9-238">Иинпуткликкхандлер предоставляет функции, обрабатывающие событие Инпуткликкед, вызванное GamePadInput.cs или InteractionSourceInputSource.cs.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-238">IInputClickHandler exposes the functions that handle the InputClicked event raised by GamePadInput.cs or InteractionSourceInputSource.cs.</span></span> <span data-ttu-id="d9dd9-239">Онинпуткликкед вызывается, когда Басеинпутсаурце обнаруживает щелчок, пока объект с Таптоплаце находится в фокусе.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-239">OnInputClicked is called when a BaseInputSource detects a click while the object with TapToPlace is in focus.</span></span> <span data-ttu-id="d9dd9-240">Аиртаппинг в HoloLens или нажатии кнопки на контроллере Xbox вызовет событие.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-240">Either airtapping on HoloLens or pressing the A button on the Xbox controller will trigger the event.</span></span>

<span data-ttu-id="d9dd9-241">Во-вторых, код выполняется в обновлении, чтобы определить, выполняется ли поиск по поверхности, чтобы можно было поместить игровой объект на поверхность, например таблицу.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-241">Second is the code be executed in update to see if a surface is being looked at so we can place the game object on a surface, like a table.</span></span> <span data-ttu-id="d9dd9-242">У увлекательной гарнитуры нет концепции реальных поверхностей, поэтому объект, представляющий верхнюю таблицу (Врум > Таблесинги > Кубу), был помечен с помощью Спатиалмаппинг физика, поэтому приведение лучей в Update будет конфликтовать с виртуальной таблицей сверху.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-242">The immersive headset doesn't have a concept of real surfaces, so the object that represents the table top (Vroom > TableThingy > Cube) has been marked with the SpatialMapping physics layer, so the ray cast in Update will collide with the virtual table top.</span></span>

### <a name="enjoy-your-progress"></a><span data-ttu-id="d9dd9-243">Наслаждайтесь ходом выполнения</span><span class="sxs-lookup"><span data-stu-id="d9dd9-243">Enjoy your progress</span></span>

<span data-ttu-id="d9dd9-244">На этот раз можно выбрать остров, чтобы переместить его.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-244">This time you can select the island to move it.</span></span> <span data-ttu-id="d9dd9-245">В HoloLens можно переместить остров в реальную поверхность.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-245">On HoloLens you can move the island to a real surface.</span></span> <span data-ttu-id="d9dd9-246">В поувлекательной гарнитуре можно переместить остров в виртуальную таблицу, которую мы добавили.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-246">In the immersive headset you can move the island to the virtual table we added.</span></span>

## <a name="chapter-3---sharing"></a><span data-ttu-id="d9dd9-247">Глава 3. Совместное использование</span><span class="sxs-lookup"><span data-stu-id="d9dd9-247">Chapter 3 - Sharing</span></span>

>[!VIDEO https://www.youtube.com/embed/1diycJvxfDc]

### <a name="objectives"></a><span data-ttu-id="d9dd9-248">Цели</span><span class="sxs-lookup"><span data-stu-id="d9dd9-248">Objectives</span></span>

<span data-ttu-id="d9dd9-249">Убедитесь, что сеть настроена правильно и подробные сведения о том, как пространственные привязки являются общими для устройств.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-249">Ensure that the network is correctly configured and detail how spatial anchors are shared between devices.</span></span>

### <a name="what-we-will-build"></a><span data-ttu-id="d9dd9-250">Что будет построено</span><span class="sxs-lookup"><span data-stu-id="d9dd9-250">What we will build</span></span>

<span data-ttu-id="d9dd9-251">Наш проект будет преобразован в проект с несколькими проектами.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-251">We will convert our project to a multiplayer project.</span></span> <span data-ttu-id="d9dd9-252">Мы добавим пользовательский интерфейс и логику для размещения сеансов или подключения к ним.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-252">We will add UI and logic to host or join sessions.</span></span> <span data-ttu-id="d9dd9-253">Пользователи HoloLens будут видеть друг друга в сеансе с облаками в своих головах, а у впечатляющих головных пользователей есть облака, расположенные рядом с точкой привязки.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-253">HoloLens users will see each other in the session with clouds over their heads, and immersive headset users have clouds near to where the anchor is.</span></span> <span data-ttu-id="d9dd9-254">Пользователи в иммерсивное гарнитуры увидят пользователей HoloLens по отношению к источнику сцены.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-254">Users in the immersive headsets will see the HoloLens users relative to the origin of the scene.</span></span> <span data-ttu-id="d9dd9-255">Пользователи HoloLens будут видеть голограмму острова в том же месте.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-255">HoloLens users will all see the hologram of the island in the same place.</span></span> <span data-ttu-id="d9dd9-256">Ключевое замечание заключается в том, что пользователи в впечатляющих головных гарнитурах не будут включены в эту главу, но будут вести себя точно так же, как HoloLens, с птицм глазным представлением острова.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-256">It is key to note that the users in the immersive headsets will not be on the island during this chapter, but will behave very similarly to HoloLens, with a birds eye view of the island.</span></span>

### <a name="steps"></a><span data-ttu-id="d9dd9-257">Шаги</span><span class="sxs-lookup"><span data-stu-id="d9dd9-257">Steps</span></span>

* <span data-ttu-id="d9dd9-258">Удаление островка и Вррум</span><span class="sxs-lookup"><span data-stu-id="d9dd9-258">Remove Island and VRRoom</span></span>
    * <span data-ttu-id="d9dd9-259">В **иерархии** щелкните элемент **остров** правой кнопкой мыши, выберите пункт **Удалить** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-259">In **Hierarchy** right-click **Island** select **Delete**</span></span>
    * <span data-ttu-id="d9dd9-260">В **иерархии** щелкните правой кнопкой мыши **вррум** выбрать **Удалить** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-260">In **Hierarchy** right-click **VRRoom** select **Delete**</span></span>
* <span data-ttu-id="d9dd9-261">Добавить Усланд</span><span class="sxs-lookup"><span data-stu-id="d9dd9-261">Add Usland</span></span>
    * <span data-ttu-id="d9dd9-262">Из **апппрефабс** перетащите **усланд** в **иерархию** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-262">From **AppPrefabs** drag **Usland** to **Hierarchy** .</span></span>
* <span data-ttu-id="d9dd9-263">Из **апппрефабс** перетащите каждую из следующих элементов в **иерархию** :</span><span class="sxs-lookup"><span data-stu-id="d9dd9-263">From **AppPrefabs** drag each of the following to **Hierarchy** :</span></span>
    * <span data-ttu-id="d9dd9-264">**унетшарингстаже**</span><span class="sxs-lookup"><span data-stu-id="d9dd9-264">**UNETSharingStage**</span></span>
    * <span data-ttu-id="d9dd9-265">**унетанчоррут**</span><span class="sxs-lookup"><span data-stu-id="d9dd9-265">**UNetAnchorRoot**</span></span>
    * <span data-ttu-id="d9dd9-266">**уиконтаинер**</span><span class="sxs-lookup"><span data-stu-id="d9dd9-266">**UIContainer**</span></span>
    * <span data-ttu-id="d9dd9-267">**дебугпанелбуттон**</span><span class="sxs-lookup"><span data-stu-id="d9dd9-267">**DebugPanelButton**</span></span>
* <span data-ttu-id="d9dd9-268">Сохранить и построить как прежде</span><span class="sxs-lookup"><span data-stu-id="d9dd9-268">Save and Build as before</span></span>

### <a name="digging-into-the-code"></a><span data-ttu-id="d9dd9-269">Продвигаясь вглубь в код</span><span class="sxs-lookup"><span data-stu-id="d9dd9-269">Digging into the code</span></span>

<span data-ttu-id="d9dd9-270">На панели проект перейдите к **ассетс\апппрефабс\суппорт\шарингвисунет\скриптс** и дважды щелкните **UnetAnchorManager.CS** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-270">In the project panel, navigate to **Assets\AppPrefabs\Support\SharingWithUnet\Scripts** and double-click on **UnetAnchorManager.cs** .</span></span> <span data-ttu-id="d9dd9-271">Способность одного HoloLens обмениваться данными отслеживания с другим HoloLens, таким, что оба устройства могут совместно использовать одно и то же пространство, приближается к Magical.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-271">The ability for one HoloLens to share tracking information with another HoloLens such that both devices can share the same space is near magical.</span></span> <span data-ttu-id="d9dd9-272">Мощь смешанной реальности вступает в активность, когда два или более пользователей могут совместно работать с одними и теми же цифровыми данными.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-272">The power of mixed reality comes alive when two or more people can collaborate using the same digital data.</span></span>

<span data-ttu-id="d9dd9-273">Вот несколько моментов, которые необходимо указать в этом сценарии:</span><span class="sxs-lookup"><span data-stu-id="d9dd9-273">A few things to point out in this script:</span></span>

<span data-ttu-id="d9dd9-274">В функции start Обратите внимание на проверку **исдисплайопакуе** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-274">In the start function, notice the check for **IsDisplayOpaque** .</span></span> <span data-ttu-id="d9dd9-275">В этом случае предполагается, что привязка установлена.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-275">In this case, we pretend that the Anchor is established.</span></span> <span data-ttu-id="d9dd9-276">Это обусловлено тем, что в впечатляющих головных гарнитурах не предоставляется способ импорта или экспорта привязок.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-276">This is because the immersive headsets do not expose a way to import or export anchors.</span></span> <span data-ttu-id="d9dd9-277">Однако если мы выполняем на HoloLens, этот скрипт реализует совместное использование привязок между устройствами.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-277">If we are running on a HoloLens, however, this script implements sharing anchors between the devices.</span></span> <span data-ttu-id="d9dd9-278">Устройство, запускающее сеанс, создаст привязку для экспорта.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-278">The device that starts the session will create an anchor for exporting.</span></span> <span data-ttu-id="d9dd9-279">Устройство, которое присоединяется к сеансу, запрашивает привязку с устройства, запустившего сеанс.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-279">The device that joins a session will request the anchor from the device that started the session.</span></span>

<span data-ttu-id="d9dd9-280">**Идет**</span><span class="sxs-lookup"><span data-stu-id="d9dd9-280">**Exporting:**</span></span>

<span data-ttu-id="d9dd9-281">Когда пользователь создает сеанс, Нетворкдисковеривисанчорс будет вызывать функцию Унетанчорманажерс Креатеанчор.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-281">When a user creates a session, NetworkDiscoveryWithAnchors will call UNETAnchorManagers CreateAnchor function.</span></span> <span data-ttu-id="d9dd9-282">Рассмотрим Креатеанчор Flow.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-282">Let's follow CreateAnchor flow.</span></span>

<span data-ttu-id="d9dd9-283">Начнем с определенного обслуживания, удалив все данные, которые могли быть собраны для предыдущих привязок.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-283">We start by doing some housekeeping, clearing out any data we may have collected for previous anchors.</span></span> <span data-ttu-id="d9dd9-284">Затем проверяется наличие кэшированной привязки для загрузки.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-284">Then we check if there is a cached anchor to load.</span></span> <span data-ttu-id="d9dd9-285">Данные привязки имеют значение от 5 до 20 МБ, поэтому повторное использование кэшированных привязок может сэкономить на объеме данных, необходимых для передачи по сети.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-285">The anchor data tends to be between 5 and 20 MB, so reusing cached anchors can save on the amount of data we need to transfer over the network.</span></span> <span data-ttu-id="d9dd9-286">Мы посмотрим, как это работает чуть позже.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-286">We'll see how this works a bit later.</span></span> <span data-ttu-id="d9dd9-287">Даже если мы повторно используем привязку, необходимо подготовить данные привязки в случае, если новое соединение с клиентом не имеет привязки.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-287">Even if we are reusing the anchor, we need to get the anchor data ready in case a new client joins that doesn't have the anchor.</span></span>

<span data-ttu-id="d9dd9-288">Говоря о готовности данных привязки, класс Ворлданчортрансфербатч предоставляет функциональные возможности для подготовки данных привязки для отправки на другое устройство или приложение, а также функции для импорта данных привязки.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-288">Speaking of getting the anchor data ready, the WorldAnchorTransferBatch class exposes the functionality to prepare anchor data for sending to another device or application and the functionality to import the anchor data.</span></span> <span data-ttu-id="d9dd9-289">Так как мы используем путь экспорта, мы добавим привязку к Ворлданчортрансфербатч и вызываю функцию Експортасинк.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-289">Since we're on the export path, we will add our anchor to the WorldAnchorTransferBatch and call the ExportAsync function.</span></span> <span data-ttu-id="d9dd9-290">Затем Експортасинк вызывает обратный вызов Вритебуффер при формировании данных для экспорта.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-290">ExportAsync will then call the WriteBuffer callback as it generates data for export.</span></span> <span data-ttu-id="d9dd9-291">Когда все данные экспортированы, Експорткомплете будут вызываться.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-291">When all of the data has been exported ExportComplete will be called.</span></span> <span data-ttu-id="d9dd9-292">В Вритебуффер мы добавляем фрагмент данных в список, который мы храним для экспорта.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-292">In WriteBuffer we add the chunk of data to a list we keep for exporting.</span></span> <span data-ttu-id="d9dd9-293">В Експорткомплете мы преобразуем список в массив.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-293">In ExportComplete we convert the list to an array.</span></span> <span data-ttu-id="d9dd9-294">Также задается переменная Анчорнаме, которая запускает другие устройства для запроса привязки, если они у них нет.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-294">The AnchorName variable is also set, which will trigger other devices to request the anchor if they don't have it.</span></span>

<span data-ttu-id="d9dd9-295">В некоторых случаях привязка не будет экспортироваться или создаст небольшую часть данных, которую мы попробуем снова.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-295">In some cases the anchor won't export or will create so little data that we will try again.</span></span> <span data-ttu-id="d9dd9-296">Здесь мы просто вызываем Креатеанчор.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-296">Here we just call CreateAnchor again.</span></span>

<span data-ttu-id="d9dd9-297">Завершающей функцией в пути экспорта является Анчорфаундремотели.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-297">A final function in the export path is AnchorFoundRemotely.</span></span> <span data-ttu-id="d9dd9-298">Когда другое устройство находит привязку, это устройство будет сообщать узлу, и узел будет использовать его в качестве сигнала о том, что привязка является хорошей привязкой и может быть кэширована.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-298">When another device finds the anchor, that device will tell the host, and the host will use that as a signal that the anchor is a "good anchor" and can be cached.</span></span>

<span data-ttu-id="d9dd9-299">**Падут**</span><span class="sxs-lookup"><span data-stu-id="d9dd9-299">**Importing:**</span></span>

<span data-ttu-id="d9dd9-300">Когда HoloLens присоединяется к сеансу, ему необходимо импортировать привязку.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-300">When a HoloLens joins a session, it needs to import an anchor.</span></span> <span data-ttu-id="d9dd9-301">В функции Update Унетанчорманажер запрос Анчорнаме.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-301">In UNETAnchorManager's Update function, the AnchorName is polled.</span></span> <span data-ttu-id="d9dd9-302">При изменении имени привязки начинается процесс импорта.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-302">When the anchor name changes, the import process begins.</span></span> <span data-ttu-id="d9dd9-303">Сначала мы пытаемся загрузить привязку с указанным именем из локального хранилища привязки.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-303">First, we try to load the anchor with the specified name from the local anchor store.</span></span> <span data-ttu-id="d9dd9-304">Если у нас уже есть, мы можем использовать его, не загружая данные повторно.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-304">If we already have it, we can use it without downloading the data again.</span></span> <span data-ttu-id="d9dd9-305">Если у нас нет, мы вызываем Ваитфоранчор, который начнет загрузку.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-305">If we don't have it, then we call WaitForAnchor which will initiate the download.</span></span>

<span data-ttu-id="d9dd9-306">По завершении загрузки вызывается NetworkTransmitter_dataReadyEvent.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-306">When the download is completed, NetworkTransmitter_dataReadyEvent is called.</span></span> <span data-ttu-id="d9dd9-307">Это подаст циклу обновления вызов Импортасинк с загруженными данными.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-307">This will signal the Update loop to call ImportAsync with the downloaded data.</span></span> <span data-ttu-id="d9dd9-308">Импортасинк будет вызывать Импорткомплете по завершении процесса импорта.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-308">ImportAsync will call ImportComplete when the import process is complete.</span></span> <span data-ttu-id="d9dd9-309">Если импорт выполнен успешно, привязка будет сохранена в локальном хранилище проигрывателя.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-309">If the import is successful, the anchor will be saved in the local player store.</span></span> <span data-ttu-id="d9dd9-310">PlayerController.cs фактически вызывает Анчорфаундремотели, чтобы сообщить узлу о том, что установлена хорошая привязка.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-310">PlayerController.cs actually makes the call to AnchorFoundRemotely to let the host know that a good anchor has been established.</span></span>

### <a name="enjoy-your-progress"></a><span data-ttu-id="d9dd9-311">Наслаждайтесь ходом выполнения</span><span class="sxs-lookup"><span data-stu-id="d9dd9-311">Enjoy your progress</span></span>

<span data-ttu-id="d9dd9-312">На этот раз пользователь с HoloLens будет размещать сеанс с помощью кнопки **запустить сеанс** в пользовательском интерфейсе.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-312">This time a user with a HoloLens will host a session using the **start session** button in the UI.</span></span> <span data-ttu-id="d9dd9-313">Другие пользователи, как в HoloLens, так и в головной гарнитуре, будут выбирать сеанс, а затем нажать кнопку **присоединить сеанс** в пользовательском интерфейсе.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-313">Other users, both on HoloLens or an immersive headset, will select the session and then select the **join session** button in the UI.</span></span> <span data-ttu-id="d9dd9-314">Если у вас есть несколько пользователей с устройствами HoloLens, они будут иметь красные облака в своих головах.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-314">If you have multiple people with HoloLens devices, they will have red clouds over their heads.</span></span> <span data-ttu-id="d9dd9-315">Также будет отображаться синий облако для каждой иммерсивного гарнитуры, но синие облака не будут выставляться над гарнитурами, так как гарнитуры не пытаются найти то же пространство координат мира, что и устройства HoloLens.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-315">There will also be a blue cloud for each immersive headset, but the blue clouds will not be above the headsets, as the headsets are not trying to find the same world coordinate space as the HoloLens devices.</span></span>

<span data-ttu-id="d9dd9-316">Эта точка проекта является автономным приложением для управления доступом. Это не делает ничего сложного и может стать базовым.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-316">This point in the project is a contained sharing application; it doesn't do very much, and could act as a baseline.</span></span> <span data-ttu-id="d9dd9-317">В следующих главах мы начнем создавать интерфейс для людей.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-317">In the next chapters, we will start building an experience for people to enjoy.</span></span> <span data-ttu-id="d9dd9-318">Дополнительные рекомендации по проектированию с общим опытом см. здесь.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-318">To get further guidance on shared experience design, go here.</span></span>

## <a name="chapter-4---immersion-and-teleporting"></a><span data-ttu-id="d9dd9-319">Глава 4 — иммерсивное и телеперенос</span><span class="sxs-lookup"><span data-stu-id="d9dd9-319">Chapter 4 - Immersion and teleporting</span></span>

>[!VIDEO https://www.youtube.com/embed/kUHZ5tCOfvY]

### <a name="objectives"></a><span data-ttu-id="d9dd9-320">Цели</span><span class="sxs-lookup"><span data-stu-id="d9dd9-320">Objectives</span></span>

<span data-ttu-id="d9dd9-321">Применяйте интерфейс к каждому типу устройства смешанной реальности.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-321">Cater the experience to each type of mixed reality device.</span></span>

### <a name="what-we-will-build"></a><span data-ttu-id="d9dd9-322">Что будет построено</span><span class="sxs-lookup"><span data-stu-id="d9dd9-322">What we will build</span></span>

<span data-ttu-id="d9dd9-323">Мы будем обновлять приложение, чтобы разместить впечатляющие пользователи гарнитуры по острову с иммерсивное представлением.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-323">We will update the application to put immersive headset users on the island with an immersive view.</span></span> <span data-ttu-id="d9dd9-324">Пользователи HoloLens по-прежнему будут иметь представление о острове с высоты птичьего полета.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-324">HoloLens users will still have the bird's eye view of the island.</span></span> <span data-ttu-id="d9dd9-325">Пользователи каждого типа устройств могут видеть других пользователей по мере их появления в мире.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-325">Users of each device type can see other users as they appear in the world.</span></span> <span data-ttu-id="d9dd9-326">Например, увлекательные пользователи с наушниками могут видеть другие аватары на других путях, и они видят пользователей HoloLens как гигантские облака выше.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-326">For instance, immersive headset users can see the other avatars on other paths on the island, and they see the HoloLens users as giant clouds above the island.</span></span> <span data-ttu-id="d9dd9-327">Для пользователей с головной гарнитурой также будет отображаться курсор пользователя HoloLens, если пользователь HoloLens просматривает остров.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-327">Immersive headset users will also see the cursor of the HoloLens user's gaze ray if the HoloLens user is looking at the island.</span></span> <span data-ttu-id="d9dd9-328">Пользователи HoloLens увидят аватар по острову, который представляет каждого иммерсивного пользователя гарнитуры.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-328">HoloLens users will see an avatar on the island to represent each immersive headset user.</span></span>

<span data-ttu-id="d9dd9-329">**Обновленные данные для иммерсивного устройства:**</span><span class="sxs-lookup"><span data-stu-id="d9dd9-329">**Updated Input for the Immersive device:**</span></span>

* <span data-ttu-id="d9dd9-330">Кнопки левого и правого амортизатора на контроллере Xbox поворачивают проигрыватель</span><span class="sxs-lookup"><span data-stu-id="d9dd9-330">The left bumper and right bumper buttons on the Xbox controller rotate the player</span></span>
* <span data-ttu-id="d9dd9-331">При нажатии кнопки Y на контроллере Xbox будет включен курсор [телепортируйтесь](../discover/navigating-the-windows-mixed-reality-home.md#getting-around-your-home) .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-331">Holding the Y button on the Xbox controller will enable a [teleport](../discover/navigating-the-windows-mixed-reality-home.md#getting-around-your-home) cursor.</span></span> <span data-ttu-id="d9dd9-332">Если в курсоре имеется индикатор в виде вращающейся стрелки, то при отпускании кнопки Y вы будете перенесены в расположение курсора.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-332">If the cursor has a spinning arrow indicator when you release the Y button, you will be teleported to the cursor's location.</span></span>

### <a name="steps"></a><span data-ttu-id="d9dd9-333">Шаги</span><span class="sxs-lookup"><span data-stu-id="d9dd9-333">Steps</span></span>

* <span data-ttu-id="d9dd9-334">Добавление Микседреалитителепорт в Микседреалитикамерапарент</span><span class="sxs-lookup"><span data-stu-id="d9dd9-334">Add MixedRealityTeleport to MixedRealityCameraParent</span></span>
    * <span data-ttu-id="d9dd9-335">В списке **Иерархия** выберите **усланд** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-335">In **Hierarchy** , select **Usland** .</span></span>
    * <span data-ttu-id="d9dd9-336">В **инспекторе** включите **Управление уровнем** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-336">In **Inspector** , enable **Level Control** .</span></span>
    * <span data-ttu-id="d9dd9-337">В списке **Иерархия** выберите **микседреалитикамерапарент** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-337">In **Hierarchy** , select **MixedRealityCameraParent** .</span></span>
    * <span data-ttu-id="d9dd9-338">В **инспекторе** щелкните **Добавить компонент** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-338">In **Inspector** , click **Add Component** .</span></span>
    * <span data-ttu-id="d9dd9-339">Введите **Смешанная реальность телепортируйтесь** и выберите ее.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-339">Type **Mixed Reality Teleport** and select it.</span></span>

### <a name="digging-into-the-code"></a><span data-ttu-id="d9dd9-340">Продвигаясь вглубь в код</span><span class="sxs-lookup"><span data-stu-id="d9dd9-340">Digging into the code</span></span>

<span data-ttu-id="d9dd9-341">Впечатляющие пользователи гарнитуры будут подключены к компьютерам с помощью кабеля, но наш остров больше, чем кабель.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-341">Immersive headset users will be tethered to their PCs with a cable, but our island is larger than the cable is long.</span></span> <span data-ttu-id="d9dd9-342">Чтобы компенсировать, нам нужна возможность перемещать камеру независимо от движения пользователя.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-342">To compensate, we need the ability to move the camera independently of the user's motion.</span></span> <span data-ttu-id="d9dd9-343">Дополнительные сведения о проектировании приложения смешанной реальности (в определенном самодвижении и локомотион) см. на [странице "комфортная](../design/comfort.md) ".</span><span class="sxs-lookup"><span data-stu-id="d9dd9-343">Please see the [comfort page](../design/comfort.md) for more information about designing your mixed reality application (in particular self motion and locomotion).</span></span>

<span data-ttu-id="d9dd9-344">Чтобы описать этот процесс, полезно определить два условия.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-344">In order to describe this process it will be useful to define two terms.</span></span> <span data-ttu-id="d9dd9-345">Во первых, **Долли** будет объектом, который перемещает камеру независимо от пользователя.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-345">First, **dolly** will be the object that moves the camera independently from the user.</span></span> <span data-ttu-id="d9dd9-346">Дочерний объект Game объекта **Долли** будет **основной камерой** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-346">A child game object of the **dolly** will be the **main camera** .</span></span> <span data-ttu-id="d9dd9-347">Основная камера подключена к заголовку пользователя.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-347">The main camera is attached to the user's head.</span></span>

<span data-ttu-id="d9dd9-348">На панели проект перейдите к **ассетс\апппрефабс\суппорт\скриптс\гамелогик** и дважды щелкните **MixedRealityTeleport.CS** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-348">In the project panel, navigate to **Assets\AppPrefabs\Support\Scripts\GameLogic** and double-click on **MixedRealityTeleport.cs** .</span></span>

<span data-ttu-id="d9dd9-349">Микседреалитителепорт имеет два задания.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-349">MixedRealityTeleport has two jobs.</span></span> <span data-ttu-id="d9dd9-350">Во первых, он обрабатывает поворот с помощью амортизаторов.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-350">First, it handles rotation using the bumpers.</span></span> <span data-ttu-id="d9dd9-351">В функции Update мы будем опрашивать "Буттонуп" на Лефтбумпер и Ригхтбумпер.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-351">In the update function we poll for 'ButtonUp' on LeftBumper and RightBumper.</span></span> <span data-ttu-id="d9dd9-352">Жетбуттонуп возвращает значение true только в первом кадре после нажатия кнопки.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-352">GetButtonUp only returns true on the first frame a button is up after having been down.</span></span> <span data-ttu-id="d9dd9-353">Если одна из кнопок была вызвана, то мы понимаем, что пользователь должен повернуть.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-353">If either button had been raised, then we know the user needs to rotate.</span></span>

<span data-ttu-id="d9dd9-354">При повороте мы провыцветание и поворачивайте с помощью простого сценария, именуемого «выцветание».</span><span class="sxs-lookup"><span data-stu-id="d9dd9-354">When we rotate we do a fade out and fade in using a simple script called 'fade control'.</span></span> <span data-ttu-id="d9dd9-355">Мы делаем это, чтобы пользователь не мог увидеть неестественное перемещение, что может привести к дискомфорт.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-355">We do this to prevent the user from seeing an unnatural movement which could lead to discomfort.</span></span> <span data-ttu-id="d9dd9-356">Эффект затухания и исчезновения довольно прост.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-356">The fade in and out effect is fairly simple.</span></span> <span data-ttu-id="d9dd9-357">У нас есть черновая масть перед **основной камерой** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-357">We have a black quad hanging in front of the **main camera** .</span></span> <span data-ttu-id="d9dd9-358">При переходе в альфа-значение с 0 на 1.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-358">When fading out we transition the alpha value from 0 to 1.</span></span> <span data-ttu-id="d9dd9-359">Это постепенно приводит к тому, что черные пикселы из четырех удаляются и скрывают все, что находится за ними.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-359">This gradually causes the black pixels of the quad to render and obscure anything behind them.</span></span> <span data-ttu-id="d9dd9-360">При переходе в обратное значение альфа-канала возвращается к нулю.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-360">When fading back in we transition the alpha value back to zero.</span></span>

<span data-ttu-id="d9dd9-361">При вычислении вращения Обратите внимание, что мы вращающим **Долли** , но вычислим поворот вокруг **основной камеры** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-361">When we calculate the rotation, note that we are rotating our **dolly** but calculating the rotation around the **main camera** .</span></span> <span data-ttu-id="d9dd9-362">Это важно, так как когда **Основная камера** находится далеко от 0, 0, 0, менее точное вращение вокруг доллиа становится с точки зрения пользователя.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-362">This is important as the farther the **main camera** is away from 0,0,0, the less accurate a rotation around the dolly would become from the point of view of the user.</span></span> <span data-ttu-id="d9dd9-363">На самом деле, если не вращается вокруг положения камеры, пользователь будет перемещаться по дуге вокруг **Долли** , а не при повороте.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-363">In fact, if you do not rotate around the camera position, the user will move on an arc around the **dolly** rather than rotating.</span></span>

<span data-ttu-id="d9dd9-364">Второе задание для Микседреалитителепорт заключается в обработке перемещения **Долли** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-364">The second job for MixedRealityTeleport is to handle moving the **dolly** .</span></span> <span data-ttu-id="d9dd9-365">Это делается в Сетворлдпоситион.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-365">This is done in SetWorldPosition.</span></span> <span data-ttu-id="d9dd9-366">Сетворлдпоситион принимает нужную позицию мира, позицию, где пользователь хочет перЦиеве, что они покрывают.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-366">SetWorldPosition takes the desired world position, the position where the user wants to percieve that they inhabit.</span></span> <span data-ttu-id="d9dd9-367">Нам нужно разместить наш **Долли** в этой позиции минус локальное расположение **основной камеры** , так как это смещение будет добавлено в каждый кадр.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-367">We need to put our **dolly** at that position minus the local position of the **main camera** , as that offset will be added each frame.</span></span>

<span data-ttu-id="d9dd9-368">Второй скрипт вызывает Сетворлдпоситион.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-368">A second script calls SetWorldPosition.</span></span> <span data-ttu-id="d9dd9-369">Давайте взглянем на этот сценарий.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-369">Let's look at that script.</span></span> <span data-ttu-id="d9dd9-370">На панели проект перейдите к **ассетс\апппрефабс\суппорт\скриптс\гамелогик** и дважды щелкните **TeleportScript.CS** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-370">In the project panel, navigate to **Assets\AppPrefabs\Support\Scripts\GameLogic** and double-click on **TeleportScript.cs** .</span></span>

<span data-ttu-id="d9dd9-371">Этот сценарий является немного более сложным, чем Микседреалитителепорт.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-371">This script is a little more involved than MixedRealityTeleport.</span></span> <span data-ttu-id="d9dd9-372">Сценарий проверяет наличие кнопки Y на контроллере Xbox, которую необходимо удерживать.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-372">The script is checking for the Y Button on the Xbox controller to be held down.</span></span> <span data-ttu-id="d9dd9-373">Пока кнопка удерживается, отображается курсор телепортируйтесь и сценарий приводит луч к положению пользователя.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-373">While the button is held down a teleport cursor is rendered and the script casts a ray from the user's gaze position.</span></span> <span data-ttu-id="d9dd9-374">Если этот луч конфликтует с той поверхностью, которая больше или меньше направлена, поверхность будет считаться хорошей для телепортироваться к, а анимация на курсоре телепортируйтесь будет включена.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-374">If that ray collides with a surface that is more or less pointing up, the surface will be considered a good surface to teleport to, and the animation on the teleport cursor will be enabled.</span></span> <span data-ttu-id="d9dd9-375">Если луч не конфликтует с поверхностью, наведя на нее больше или меньше, то анимация курсора будет отключена.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-375">If the ray does not collide with a surface more or less pointing up, then the animation on the cursor will be disabled.</span></span> <span data-ttu-id="d9dd9-376">Когда кнопка Y выдается, а вычисленная точка луча является допустимой позицией, скрипт вызывает Сетворлдпоситион с положением, пересекающимся с лучом.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-376">When the Y button is released and the calculated point of the ray is a valid position, the script calls SetWorldPosition with the position the ray intersected.</span></span>

### <a name="enjoy-your-progress"></a><span data-ttu-id="d9dd9-377">Наслаждайтесь ходом выполнения</span><span class="sxs-lookup"><span data-stu-id="d9dd9-377">Enjoy your progress</span></span>

<span data-ttu-id="d9dd9-378">На этот раз необходимо найти друга.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-378">This time you'll need to find a friend.</span></span>

<span data-ttu-id="d9dd9-379">Опять же, пользователю с HoloLens будет размещен сеанс.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-379">Once again, a user with the HoloLens will host a session.</span></span> <span data-ttu-id="d9dd9-380">Другие пользователи будут присоединяться к сеансу.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-380">Other users will join the session.</span></span> <span data-ttu-id="d9dd9-381">Приложение поместит первых трех пользователей, чтобы присоединиться к увлекательной гарнитуре по одному из трех путей на самом острове.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-381">The application will place the first three users to join from an immersive headset on one of the three paths on the island.</span></span> <span data-ttu-id="d9dd9-382">В этом разделе вы можете изучить остров.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-382">Feel free to explore the island in this section.</span></span>

<span data-ttu-id="d9dd9-383">Сведения для уведомления:</span><span class="sxs-lookup"><span data-stu-id="d9dd9-383">Details to notice:</span></span>

1. <span data-ttu-id="d9dd9-384">Вы видите лица в облаках, которые помогают иммерсивное пользователю видеть направление, которое ищет пользователь HoloLens.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-384">You can see faces in the clouds, which helps an immersed user see which direction a HoloLens user is looking.</span></span>
2. <span data-ttu-id="d9dd9-385">Аватары на острове имеют горловины, которые поворачиваются.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-385">The avatars on the island have necks that rotate.</span></span> <span data-ttu-id="d9dd9-386">Они не следуют тем, что делает пользователь, в реальности (у нас нет этой информации), но она делает неприятной опыт.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-386">They won't follow what the user is doing is real reality (we don't have that information) but it makes for a nice experience.</span></span>
3. <span data-ttu-id="d9dd9-387">Если пользователь HoloLens просматривает остров, то в иммерсивное пользователи могут видеть свой курсор.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-387">If the HoloLens user is looking at the Island, the immersed users can see their cursor.</span></span>
4. <span data-ttu-id="d9dd9-388">Облака, представляющие тени, приведенные пользователем HoloLens.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-388">The clouds that represent the HoloLens users cast shadows.</span></span>

## <a name="chapter-5---finale"></a><span data-ttu-id="d9dd9-389">Глава 5-заключение</span><span class="sxs-lookup"><span data-stu-id="d9dd9-389">Chapter 5 - Finale</span></span>

>[!VIDEO https://www.youtube.com/embed/n_HDWJbfpNg]

### <a name="objectives"></a><span data-ttu-id="d9dd9-390">Цели</span><span class="sxs-lookup"><span data-stu-id="d9dd9-390">Objectives</span></span>

<span data-ttu-id="d9dd9-391">Создайте интерактивный интерфейс совместной работы между двумя типами устройств.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-391">Create a collaborative interactive experience between the two device types.</span></span>

### <a name="what-we-will-build"></a><span data-ttu-id="d9dd9-392">Что будет построено</span><span class="sxs-lookup"><span data-stu-id="d9dd9-392">What we will build</span></span>

<span data-ttu-id="d9dd9-393">Основываясь на главе 4, когда пользователь с впечатляющим головным телефоном приближается к головоломке по острову, пользователи HoloLens получат всплывающую подсказку с Советом головоломки.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-393">Building on chapter 4, when a user with an immersive headset gets near a puzzle on the island, the HoloLens users will get a tool tip with a clue to the puzzle.</span></span> <span data-ttu-id="d9dd9-394">После того, как все пользователи с головным телефоном получит свои головоломки и появятся на "готовой панели" в Rocket комнате, Rocket запустится.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-394">Once all of the immersive headset users get past their puzzles and onto the "ready pad" in the rocket room, the rocket will launch.</span></span>

### <a name="steps"></a><span data-ttu-id="d9dd9-395">Шаги</span><span class="sxs-lookup"><span data-stu-id="d9dd9-395">Steps</span></span>

* <span data-ttu-id="d9dd9-396">В списке **Иерархия** выберите **усланд** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-396">In **Hierarchy** , select **Usland** .</span></span>
* <span data-ttu-id="d9dd9-397">В окне **инспектора** на панели **Управление уровнями** установите флажок **включить совместную работу** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-397">In **Inspector** , in **Level Control** , check **Enable Collaboration** .</span></span>

### <a name="digging-into-the-code"></a><span data-ttu-id="d9dd9-398">Продвигаясь вглубь в код</span><span class="sxs-lookup"><span data-stu-id="d9dd9-398">Digging into the code</span></span>

<span data-ttu-id="d9dd9-399">Теперь давайте взглянем на LevelControl.cs.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-399">Now let us look at LevelControl.cs.</span></span> <span data-ttu-id="d9dd9-400">Этот сценарий является ядром логики игры и поддерживает состояние игры.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-400">This script is the core of the game logic and maintains the game state.</span></span> <span data-ttu-id="d9dd9-401">Поскольку это многопользовательская игра, использующая УНЕТ, нам нужно понять, как потоки данных, как минимум, достаточно для изменения этого руководства.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-401">Since this is a multiplayer game using UNET we need to understand how data flows, at least well enough to modify this tutorial.</span></span> <span data-ttu-id="d9dd9-402">Более полный обзор УНЕТ см. в документации Unity.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-402">For a more complete overview of UNET, please refer to Unity's documentation.</span></span>

<span data-ttu-id="d9dd9-403">На панели проект перейдите к **ассетс\апппрефабс\суппорт\скриптс\гамелогик** и дважды щелкните **LevelControl.CS** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-403">In the project panel, navigate to **Assets\AppPrefabs\Support\Scripts\GameLogic** and double-click on **LevelControl.cs** .</span></span>

<span data-ttu-id="d9dd9-404">Давайте посмотрим, как иммерсивное гарнитура означает, что они готовы к запуску Rocket.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-404">Let us understand how an immersive headset indicates that they are ready for the rocket launch.</span></span> <span data-ttu-id="d9dd9-405">Готовность к запуску Rocket передается путем установки одного из трех логических значений в виде списка логических значений, соответствующих трем путям по острову.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-405">Rocket Launch readiness is communicated by setting one of three bools in a list of bools that correspond to the three paths on the island.</span></span> <span data-ttu-id="d9dd9-406">Логическое значение пути задается, когда пользователь, назначенный контуру, находится поверх коричневой панели внутри Rocket комнаты.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-406">A path's bool will be set when the user assigned to the path is on top of the brown pad inside the rocket room.</span></span> <span data-ttu-id="d9dd9-407">Итак, теперь с подробными сведениями.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-407">Okay, now to the details.</span></span>

<span data-ttu-id="d9dd9-408">Мы начнем с функции Update ().</span><span class="sxs-lookup"><span data-stu-id="d9dd9-408">We will start in the Update() function.</span></span> <span data-ttu-id="d9dd9-409">Обратите внимание, что имеется функция "Памятка по".</span><span class="sxs-lookup"><span data-stu-id="d9dd9-409">You will note that there is a 'cheat' function.</span></span> <span data-ttu-id="d9dd9-410">Мы использовали это в разработке для тестирования последовательности запуска и сброса Rocket.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-410">We used this in development to test the rocket launch and reset sequence.</span></span> <span data-ttu-id="d9dd9-411">Он не работает в многопользовательском интерфейсе.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-411">It won't work in the multi user experience.</span></span> <span data-ttu-id="d9dd9-412">Надеюсь, в момент, когда вы усвоить следующую невыполненную работу, вы можете сделать это.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-412">Hopefully by the time you internalize the following infromation you can make it work.</span></span> <span data-ttu-id="d9dd9-413">После того, как мы пропроверяем, следует ли памятка по, мы проверяем, находится ли локальный игрок в процессе погружения.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-413">After we check to see if we should cheat, we check to see if the local player is immersed.</span></span> <span data-ttu-id="d9dd9-414">Мы хотим сосредоточиться на том, как мы нашли, что мы будем на цель.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-414">We want to focus on how we find that we're at the goal.</span></span> <span data-ttu-id="d9dd9-415">Внутри проверки if (иммерсивного) существует вызов Чеккгоал, который скрывается за логическим значением **енаблеколлаборатион** .</span><span class="sxs-lookup"><span data-stu-id="d9dd9-415">Inside of the if (Immersed) check, there is a call to CheckGoal hiding behind the **EnableCollaboration** bool.</span></span> <span data-ttu-id="d9dd9-416">Это соответствует флажку, установленному при выполнении шагов, описанных в этой главе.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-416">This corresponds to the checkbox you checked while completing the steps for this chapter.</span></span> <span data-ttu-id="d9dd9-417">Внутри Енаблеколлаборатион мы видим вызов Чеккгоал ().</span><span class="sxs-lookup"><span data-stu-id="d9dd9-417">Inside of EnableCollaboration we see a call to CheckGoal().</span></span>

<span data-ttu-id="d9dd9-418">Чеккгоал выполняет некоторые математические операции, чтобы узнать, не занимается ли она на панели.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-418">CheckGoal does some math to see if we are more or less standing on the pad.</span></span> <span data-ttu-id="d9dd9-419">Когда мы будем, отладка. log приступил к цели, а затем мы вызываем "Сендатгоалмессаже ()".</span><span class="sxs-lookup"><span data-stu-id="d9dd9-419">When we are, we Debug.Log "Arrived at goal" and then we call 'SendAtGoalMessage()'.</span></span> <span data-ttu-id="d9dd9-420">В Сендатгоалмессаже мы вызываем playerController. Сендатгоал.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-420">In SendAtGoalMessage we call playerController.SendAtGoal.</span></span> <span data-ttu-id="d9dd9-421">Чтобы сэкономить время, вот код:</span><span class="sxs-lookup"><span data-stu-id="d9dd9-421">To save you some time, here's the code:</span></span>

```cs
private void CmdSendAtGoal(int GoalIndex)
{
    levelState.SetGoalIndex(GoalIndex);
}
```

```cs
public void SendAtGoal(int GoalIndex)
{
    if (isLocalPlayer)
    {
        Debug.Log("sending at goal " + GoalIndex);
        CmdSendAtGoal(GoalIndex);
    }
}
```

<span data-ttu-id="d9dd9-422">Обратите внимание, что Сендатгоалмессаже вызывает Кмдсендатгоал, который вызывает Левелстате. Сетгоалиндекс, который возвращается в LevelControl.cs.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-422">Note that SendAtGoalMessage calls CmdSendAtGoal, which calls levelState.SetGoalIndex, which is back in LevelControl.cs.</span></span> <span data-ttu-id="d9dd9-423">На первый взгляд это кажется странным.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-423">At first glance this seems strange.</span></span> <span data-ttu-id="d9dd9-424">Почему бы не просто вызвать Сетгоалиндекс, а не нестранный маршрут через контроллер проигрывателя?</span><span class="sxs-lookup"><span data-stu-id="d9dd9-424">Why not just call SetGoalIndex rather than this strange routing through the player controller?</span></span> <span data-ttu-id="d9dd9-425">Причина заключается в том, что мы УНЕТ модель данных, которая использует для синхронизации данных. Чтобы предотвратить обмана и пробуксовка, УНЕТ требует, чтобы у каждого объекта был пользователь, обладающий полномочиями на изменение синхронизированных переменных.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-425">The reason is that we are conforming to the data model UNET uses to keep data in sync. To prevent cheating and thrashing, UNET requires that each object has a user who has authority to change the synchronized variables.</span></span> <span data-ttu-id="d9dd9-426">Кроме того, только узел (пользователь, запустивший сеанс) может изменять данные напрямую.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-426">Further, only the host (the user that started the session) can change data directly.</span></span> <span data-ttu-id="d9dd9-427">Пользователи, не являющиеся узлами, но обладающие полномочиями, должны отправить команду на узел, который изменит переменную.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-427">Users who are not the host, but have authority, need to send a 'command' to the host which will change the variable.</span></span> <span data-ttu-id="d9dd9-428">По умолчанию узел имеет полномочия для всех объектов, за исключением того объекта, порожденного для представления пользователя.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-428">By default the host has authority over all objects, except for the object spawned to represent the user.</span></span> <span data-ttu-id="d9dd9-429">В нашем случае у этого объекта есть сценарий playercontroller.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-429">In our case this object has the playercontroller script.</span></span> <span data-ttu-id="d9dd9-430">Существует способ запросить полномочия для объекта, а затем внести изменения, но мы решили использовать тот факт, что у контроллера игрока есть самостоятельный центр и маршрутизация команд через контроллер проигрывателя.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-430">There is a way to request authority for an object and then make changes, but we choose to leverage the fact that the player controller has self authority and route commands through the player controller.</span></span>

<span data-ttu-id="d9dd9-431">Сказал другой способ, когда мы обнаружили себя на нашей цели, игроку нужно сообщить ведущему приложению, и узел сообщит всем остальным.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-431">Said another way, when we've found ourselves at our goal, the player needs to tell the host, and the host will tell everyone else.</span></span>

<span data-ttu-id="d9dd9-432">Вернемся к LevelControl.cs, Взгляните на Сетгоалиндекс.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-432">Back in LevelControl.cs look at SetGoalIndex.</span></span> <span data-ttu-id="d9dd9-433">Здесь мы назначим значение значения в синклист (Атгоал).</span><span class="sxs-lookup"><span data-stu-id="d9dd9-433">Here we are setting the value of a value in a synclist (AtGoal).</span></span> <span data-ttu-id="d9dd9-434">Помните, что в контексте узла мы делаем это.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-434">Remember that we are in the context of the host while we do this.</span></span> <span data-ttu-id="d9dd9-435">Как и команда, RPC — это то, что может выдать узел, что приведет к тому, что все клиенты будут запускать некоторый код.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-435">Similar to a command, an RPC is something the host can issue that will cause all clients to run some code.</span></span> <span data-ttu-id="d9dd9-436">Здесь мы вызываем "Рпкчеккаллгоалс".</span><span class="sxs-lookup"><span data-stu-id="d9dd9-436">Here we call 'RpcCheckAllGoals'.</span></span> <span data-ttu-id="d9dd9-437">Каждый клиент будет отдельно проверять, установлены ли все три Атгоалс, и если да, запустите Rocket.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-437">Each client will individually check to see if all three AtGoals are set, and if so, launch the rocket.</span></span>

### <a name="enjoy-your-progress"></a><span data-ttu-id="d9dd9-438">Наслаждайтесь ходом выполнения</span><span class="sxs-lookup"><span data-stu-id="d9dd9-438">Enjoy your progress</span></span>

<span data-ttu-id="d9dd9-439">Основываясь на предыдущей главе, мы будем запускать сеанс, как и раньше.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-439">Building on the previous chapter, we will start the session as before.</span></span> <span data-ttu-id="d9dd9-440">На этот раз, когда пользователи в иммерсивное гарнитуре появятся в "дверце" на пути, появится всплывающая подсказка, которая может видеть только пользователи HoloLens.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-440">This time as the users in the immersive headset get to the "door" on their path, a tooltip will appear that only the HoloLens users can see.</span></span> <span data-ttu-id="d9dd9-441">Пользователи HoloLens несут ответственность за передачу этой информации пользователям в иммерсивное гарнитуру.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-441">The HoloLens users are responsible for communicating this clue to the users in the immersive headset.</span></span> <span data-ttu-id="d9dd9-442">Rocket запустится, когда каждый Аватар пойдет на соответствующую коричневую панель в о вулканах.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-442">The rocket will launch to space once each avatar has stepped on its corresponding brown pad inside the volcano.</span></span> <span data-ttu-id="d9dd9-443">Сцена будет сброшена через 60 секунд, что позволит выполнить ее снова.</span><span class="sxs-lookup"><span data-stu-id="d9dd9-443">The scene will reset after 60 seconds so you can do it again.</span></span>

## <a name="see-also"></a><span data-ttu-id="d9dd9-444">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="d9dd9-444">See also</span></span>

* [<span data-ttu-id="d9dd9-445">213. Ввод в смешанной реальности: контроллеры движения</span><span class="sxs-lookup"><span data-stu-id="d9dd9-445">MR Input 213: Motion controllers</span></span>](mixed-reality-213.md)
