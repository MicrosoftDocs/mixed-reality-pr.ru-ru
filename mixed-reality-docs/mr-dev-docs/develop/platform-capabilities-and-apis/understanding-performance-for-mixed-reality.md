---
title: Основные сведения о производительности смешанной реальности
description: Дополнительные сведения и сведения для анализа и оптимизации производительности приложений Windows Mixed Reality.
author: hferrone
ms.author: v-hferrone
ms.date: 3/26/2019
ms.topic: article
keywords: Windows Mixed Reality, Смешанная реальность, виртуальная реальность, VR, MR, производительность, оптимизация, ЦП, GPU
ms.openlocfilehash: d0218902864586e678f6d51dfade58bd567bcc02
ms.sourcegitcommit: 3236abcba27335fe3d52e38423d2b265ca883355
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2021
ms.locfileid: "106269960"
---
# <a name="understanding-performance-for-mixed-reality"></a>Основные сведения о производительности смешанной реальности

В этой статье приводятся общие сведения о значимости производительности для приложения смешанной реальности.  Работа пользователей может быть значительно снижена, если приложение не работает с оптимальной частотой кадров. Голограммы будут отображаться нестабильно, а отслеживание головного окружения будет неточным, что приведет к ухудшению работы пользователя. Производительность должна рассматриваться как первая функция класса для разработки смешанной реальности, а не для польской задачи.

Недавно мы выпустили приложение с названием "основы качества", которое охватывает общие проблемы с производительностью, проектированием и средой и решениями для приложений HoloLens 2. Это приложение является великолепной визуальной демонстрацией для содержимого, приведенного ниже.

> [!div class="nextstepaction"]
> [Скачать приложение "основы качества"](https://www.microsoft.com/en-us/p/quality-fundamentals/9mwz852q88fw)

Ниже перечислены значения для выполнения частоты кадров для каждой целевой платформы.

| Платформа | Частота целевых кадров |
|----------|-------------------|
| [HoloLens](/hololens/hololens1-hardware) | 60 кадров/с |
| [Портативные компьютеры Windows Mixed Reality](../../discover/immersive-headset-hardware-details.md) | 90 КАДРОВ/С |
| [Компьютеры Windows Mixed Reality](../../discover/immersive-headset-hardware-details.md) | 60 кадров/с |

В приведенной ниже структуре представлены рекомендации по использованию ставок целевых кадров. Мы рекомендуем ознакомиться со [статьей рекомендации по производительности для Unity](../unity/performance-recommendations-for-unity.md) , чтобы получить советы по измерению и улучшению частоты кадров в среде Unity.

## <a name="understanding-performance-bottlenecks"></a>Основные сведения о узких местах производительности

Если приложение имеет небольшую частоту кадров, первый шаг состоит в анализе и понимании того, где приложение получает ресурсоемкие вычисления. Существует два основных процессора, ответственных за работу с визуализацией сцены: ЦП и GPU, каждый из которых обрабатывает различные аспекты приложения смешанной реальности. Ниже приведены три ключевых места, где могут возникнуть узкие места: 

1. **Поток приложения — ЦП** -
    Отвечает за логику приложения, включая обработку входных данных, анимацию, физику и другую логику приложения.
2. **Прорисовка потока — ЦП в GPU** — отвечает за отправку вызовов рисования в GPU. Когда приложение хочет отобразить объект, например куб или модель, этот поток отправляет в графический процессор запрос на выполнение операций.
3. **GPU** — чаще всего обрабатывает графический конвейер приложения для преобразования трехмерных данных (моделей, текстур и т. д.) в пиксели. В итоге он создает 2D-образ для отправки на экран устройства.

![Время существования кадра](images/lifetime-of-a-frame.png)

Как правило, приложения HoloLens будут привязаны к GPU, но не всегда. Используйте приведенные ниже средства и методики, чтобы понять, где размещается узкие места в конкретном приложении.

## <a name="how-to-analyze-your-application"></a>Анализ приложения

Существует множество средств, позволяющих понять профиль производительности и потенциальные узкие места в приложении смешанной реальности. 

Ниже приведены некоторые распространенные средства, помогающие собрать подробные сведения о профилировании для приложения.
- [Анализаторы производительности графики Intel](https://software.intel.com/gpa)
- [Отладчики графики Visual Studio](/visualstudio/debugger/graphics/visual-studio-graphics-diagnostics)
- [Профилировщик Unity](https://docs.unity3d.com/Manual/Profiler.html)
- [Отладчик фреймов Unity](https://docs.unity3d.com/Manual/FrameDebugger.html)
- [Неreal Insights](../unreal/unreal-insights.md)
- [ЭКРАНА](https://devblogs.microsoft.com/pix/)
- [Пофилинг GPU в нереальном режиме](https://docs.unrealengine.com/en-US/TestingAndOptimization/PerformanceAndProfiling/GPU/index.html)

### <a name="how-to-profile-in-any-environment"></a>Профилирование в любой среде

Один из способов определить, является ли приложение процессором GPU или ЦП, — снизить разрешение выходных данных целевого объекта отрисовки. Уменьшая количество пикселей для вычисления, вы сокращаете нагрузку на GPU. Устройство будет отображаться в текстуре меньшего размера, а затем — в виде образца, чтобы отобразить окончательный образ.

При понижении разрешения отрисовки, если:
1) Частота приложений **увеличивается**, и вы, скорее всего, **привязаны к GPU**
1) Частота кадров приложения не **изменилась**, скорее всего, **с границей ЦП**

>[!NOTE]
>Unity предоставляет возможность легко изменять разрешение целевого объекта отрисовки приложения во время выполнения с помощью свойства *[ксрсеттингс. рендервиевпортскале](https://docs.unity3d.com/ScriptReference/XR.XRSettings-renderViewportScale.html)* . Конечный образ, представленный на устройстве, имеет фиксированное разрешение. Платформа будет выполнять выборку выходных данных с низким разрешением для создания изображения более высокого разрешения для отображения на экране. 
>
>```CS
>UnityEngine.XR.XRSettings.renderScale = 0.7f;
>```

## <a name="how-to-improve-your-application"></a>Как улучшить приложение

### <a name="cpu-performance-recommendations"></a>Рекомендации по производительности ЦП

Как правило, большинство работы в приложении смешанной реальности на ЦП предполагает выполнение "моделирования" сцены и обработку логики приложения. Следующие области предназначены для оптимизации:

- Анимации
- Физика
- Выделение памяти
- Сложные алгоритмы (т. е. Обратная кинематика, поиск по пути)

### <a name="gpu-performance-recommendations"></a>Рекомендации по производительности GPU

#### <a name="understanding-bandwidth-vs-fill-rate"></a>Общие сведения о пропускной способности и скорости заполнения
При отрисовке кадра на GPU приложение либо ограничивается пропускной способностью памяти, либо скоростью заполнения.

- **Пропускная способность памяти** — это частота операций чтения и записи, которую GPU может выполнять из памяти.
    - Чтобы определить ограничения пропускной способности, уменьшите качество текстуры и проверьте, увеличилась ли частота кадров.
    - В Unity измените **качество текстуры** в окне **изменение** параметров  >  **проекта** параметры  >  **[качества](https://docs.unity3d.com/Manual/class-QualitySettings.html)**.
- **Коэффициент заполнения** относится к пикселям, которые могут быть выведены в секунду графическим процессором.
    - Чтобы определить ограничения скорости заполнения, уменьшите разрешение экрана и проверьте, увеличилась ли частота кадров. 
    - В Unity используйте свойство *[ксрсеттингс. рендервиевпортскале.](https://docs.unity3d.com/ScriptReference/XR.XRSettings-renderViewportScale.html)*

Пропускная способность памяти обычно включает оптимизацию для одного из следующих вариантов:
1) Уменьшение разрешений текстуры
2) Использование меньшего числа текстур (нормалей, отраженных и т. д.)

Скорость заполнения сосредоточена на уменьшении количества операций, которые необходимо вычислить для итогового отрисованного пикселя, включая:
1) Число объектов для отрисовки или обработки
2) Число операций на шейдер
3) Число стадий GPU до окончательного результата (шейдеры Geometry, эффекты последующей обработки и т. д.)
4) Число пикселей для отрисовки (разрешение экрана)

#### <a name="reduce-polygon-count"></a>Уменьшить число многоугольников

Чем больше число многоугольников, тем больше операций для GPU, тем самым [уменьшая количество многоугольников](/dynamics365/mixed-reality/import-tool/optimize-models#performance-targets) в сцене, тем меньше время визуализации. Есть и другие факторы, которые делают геометрические объекты геометрическими, но количество многоугольников является самой простой метрикой, определяющей объем работы, которую займет визуализация сцены.

#### <a name="limit-overdraw"></a>Ограничение перерисовки

Высокая перерисовка происходит, когда несколько объектов визуализируются, но не отображаются на экране, так как они скрыты объектом окклудинг. Представьте себе, что у стены есть объекты, находящиеся за ней. Вся геометрия будет обработана для подготовки к просмотру, но необходимо будет визуализировать только непрозрачную стену, что приведет к ненужным операциям.

#### <a name="shaders"></a>Шейдеры

Шейдер — это небольшие программы, которые работают на GPU и выполняют два важных шага при подготовке к просмотру:
1) Определение того, какие вершины должны рисоваться и где они находятся в пространстве экрана (шейдер вершин)
    - Шейдер вершин выполняется на вершину для каждой сетки.
2) Определение цвета каждого пикселя (шейдер пикселей)
    - Построитель текстуры выполняется на пиксель и визуализируется с помощью геометрии в целевую текстуру рендеринга.

Обычно шейдеры выполняют много преобразований и вычислений освещения. Хотя сложные модели освещения, тени и другие операции могут создавать отличные результаты, они также поставляются с ценой. Уменьшение числа операций, вычисленных в шейдере, может значительно снизить объем работы, необходимый для GPU на кадр.

##### <a name="shader-coding-recommendations"></a>Рекомендации по кодированию шейдера

- Используйте фильтрацию билинейной, когда это возможно
- Переупорядочение выражений для использования встроенных функций MAD для умножения и добавления в одно и то же время
- Предварительно вычислить как можно больше ресурсов ЦП и передать его в качестве констант в материал
- **Предпочитать операции перемещения из шейдера пикселей к шейдеру вершин**
    - Как правило, количество вершин намного меньше числа пикселов (720p — 921 600 пикселей, 1080p — 2 073 600 пикселей и т. д.)

#### <a name="remove-gpu-stages"></a>Удалить этапы GPU

Эффекты последующей обработки могут быть дорогостоящими и увеличивать скорость заполнения приложения, включая такие приемы сглаживания, как MSAA. В HoloLens мы рекомендуем избегать этих приемов и дополнительных стадий шейдера, таких как Geometry, поверхности и шейдеры вычислений.

## <a name="memory-recommendations"></a>Рекомендации по использованию памяти

Чрезмерная операция выделения и освобождения памяти может привести к нестабильной производительности, замороженным кадрам и другим неблагоприятным результатам. Особенно важно понимать требования к памяти при разработке в Unity, так как управление памятью контролируется сборщиком мусора.

#### <a name="object-pooling"></a>Использование пулов объектов

Пул объектов — это популярная методика снижения затрат на непрерывное выделение и освобождение объектов. Для этого выделяется большой пул идентичных объектов, из которого извлекаются для повторного использования доступные и неактивные экземпляры. Это эффективнее, чем постоянный процесс создания и уничтожения объектов. Пулы объектов отлично подходят для многократно используемых компонентов с переменными периодами жизни в приложении.

## <a name="see-also"></a>См. также раздел
- [Рекомендации по производительности для Unity](../unity/performance-recommendations-for-unity.md)
- [Рекомендуемые параметры для Unity](../unity/recommended-settings-for-unity.md)
- [Рекомендации по производительности для Unreal](../unreal/performance-recommendations-for-unreal.md)
- [Рекомендации по использованию материалов в Unreal](../unreal/unreal-materials.md)
- [Оптимизация трехмерных моделей](/dynamics365/mixed-reality/import-tool/optimize-models#performance-targets)
- [Рекомендации по преобразованию и оптимизации трехмерных моделей в режиме реального времени](/dynamics365/mixed-reality/import-tool/best-practices)
- [Рекомендации по производительности для исполнителей и конструкторов в нереальном режиме](https://docs.unrealengine.com/en-US/TestingAndOptimization/PerformanceAndProfiling/Guidelines/index.html)
- [Рекомендации по использованию VR для нереальных](https://docs.unrealengine.com/en-US/SharingAndReleasing/XRDevelopment/VR/DevelopVR/ContentSetup/index.html)