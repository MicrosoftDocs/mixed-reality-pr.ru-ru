---
title: Перенос приложений HoloLens (1-го поколения) в HoloLens 2
description: Предназначено для разработчиков, которые используют существующее приложение для HoloLens (1-го поколения) и старые версии MRTK и хотят перейти на MRTK версии 2 и HoloLens 2.
author: hferrone
ms.author: grbury
ms.date: 12/9/2020
ms.topic: article
ms.localizationpriority: high
keywords: Windows Mixed Reality, тестирование, MRTK, MRTK версии 2, HoloLens 2, Unity, перенос, 1-е поколение, гарнитура смешанной реальности, гарнитура Windows Mixed Reality, гарнитура виртуальной реальности, миграция, рекомендации, ARM
ms.openlocfilehash: 5315e4d391824bbc17bc4cc4c3c047d671063895
ms.sourcegitcommit: 1c9035487270af76c6eaba11b11f6fc56c008135
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/13/2021
ms.locfileid: "107299899"
---
# <a name="porting-hololens-1st-gen-apps-to-hololens-2"></a>Перенос приложений HoloLens (1-го поколения) в HoloLens 2

Это руководство предназначено для разработчиков, которые используют существующее приложение Unity для HoloLens (1-го поколения) и хотят перенести его на устройство HoloLens 2. Процесс переноса приложения Unity для HoloLens (1-го поколения) на HoloLens 2 состоит из четырех основных шагов. 

Эти шаги подробно описаны в приведенных ниже разделах.

| Шаг 1 | Шаг 2 | Шаг 3 | Шаг 4 |
|----------|-------------------|-------------------|-------------------|
| ![Логотип Visual Studio](../images/visualstudio_logo.png) | ![Логотип Unity](../../design/images/logo-unity.png)| ![Значок Unity](../unity/images/hololens2_icon.jpg) | ![Логотип МРТК](../../design/images/74-12.png) |
| Скачивание новейших средств | Обновление проекта Unity | Компиляция для ARM | Миграция в MRTK версии 2

## <a name="prerequisites"></a>Предварительные требования

Мы **настоятельно рекомендуем** использовать систему управления версиями для сохранения моментального снимка первоначального состояния приложения до начала переноса. Кроме того, мы рекомендуем *сохранить* данные состояния контрольных точек в разное время при выполнении процесса. Также удобно создать еще один экземпляр исходного приложения Unity, чтобы обеспечить сравнение версий приложения во время переноса. 

> [!NOTE]
> Перед переносом убедитесь, что установлены последние версии средств разработки для Windows Mixed Reality. Для большинства разработчиков HoloLens это последняя версия Visual Studio 2019 и соответствующий пакет SDK для Windows. Подробное описание различных версий Unity и набора средств для смешанной реальности (MRTK) версии 2 представлено далее.
>
> Дополнительные сведения см. в статье [Install the tools](../install-the-tools.md) (Установка средств).

## <a name="migrate-project-to-the-latest-version-of-unity"></a>Перенос проекта в последнюю версию Unity

Если вы используете [MRTK версии 2](https://github.com/microsoft/MixedRealityToolkit-Unity), [Unity 2019 LTS](https://unity3d.com/unity/qa/lts-releases) — наилучший вариант долгосрочной поддержки без критических изменений в Unity или MRTK. Оцените все [зависимости от подключаемых модулей](https://docs.unity3d.com/Manual/Plugins.html), которые существуют в проекте, а также определите возможность сборки этих библиотек DLL для ARM64. Если в проекте есть жесткая зависимость от подключаемого модуля ARM64, возможно придется сохранить для приложения платформу ARM.

<!-- MRTK v2 always guarantees support for Unity 2018 LTS, but does not necessarily guarantee support for every iteration of Unity 2019.x.

To help clarify additional differences between [Unity 2018 LTS](https://unity3d.com/unity/qa/lts-releases) and Unity 2019.x, the following table outlines the trade-offs between the two versions. The primary difference between the two is the ability to compile for ARM64 in Unity 2019.

| Unity 2018 LTS | Unity 2019.x |
|----------|-------------------|
| ARM32 build support | ARM32 and ARM64 build support |
| Stable LTS build release | Beta stability |
| [.NET Scripting back-end](https://docs.unity3d.com/2018.4/Documentation/Manual/windowsstore-dotnet.html) *deprecated* | [.NET Scripting back-end](https://docs.unity3d.com/2018.4/Documentation/Manual/windowsstore-dotnet.html) *removed* |
| UNET Networking *deprecated* | UNET Networking *deprecated* |

-->

## <a name="update-sceneproject-settings-in-unity"></a>Обновление параметров сцены или проектов в Unity

После обновления до [Unity 2019 LTS](https://unity3d.com/unity/qa/lts-releases) рекомендуется изменить определенные параметры в Unity, чтобы получить оптимальные результаты на устройстве. Подробное описание этих параметров см. в статье [Рекомендуемые параметры для Unity](../unity/Recommended-settings-for-Unity.md).

Еще раз подчеркнем, что [серверная часть сценариев .NET](https://docs.unity3d.com/Manual/windowsstore-dotnet.html) помечена как нерекомендуемая в Unity 2018 и **удалена** в Unity 2019. Разработчикам настоятельно рекомендуется перевести проект на [IL2CPP](https://docs.unity3d.com/Manual/IL2CPP.html).

> [!NOTE]
> При использовании серверной части для работы со скриптами IL2CPP может увеличиться время сборки из Unity в Visual Studio. Разработчикам следует настроить свои компьютеры для разработки, чтобы [оптимизировать время сборки IL2CPP](https://docs.unity3d.com/Manual/IL2CPP-OptimizingBuildTimes.html).
> Кроме того, возможно, будет полезно настроить [сервер кэширования](https://docs.unity3d.com/Manual/CacheServer.html), особенно для проектов Unity с большим объемом ресурсов (за исключением файлов скриптов) либо постоянно меняющимися сценами или ресурсами. Когда открывается проект, Unity сохраняет соответствующие ресурсы в формате для внутреннего кэша на компьютере разработчика. Измененные элементы нужно повторно импортировать и еще раз обработать. Этот процесс можно выполнить однократно и сохранить на сервере кэширования, а значит, и совместно использовать с другими разработчиками для экономии времени. При этом каждому разработчику не придется обрабатывать повторно импортированные измененные элементы локально.

Разобравшись с критическими изменениями после перехода на обновленную версию Unity, выполните сборку и тестирование текущих приложений для HoloLens (1-го поколения). Кроме того, это подходящий момент для создания и сохранения фиксации в системе управления версиями.

## <a name="compile-dependenciesplugins-for-arm-processor"></a>Компиляция зависимостей или подключаемых модулей для процессора ARM

Приложения для HoloLens 1-го поколения выполнялись на 32-разрядных (x86) процессорах. HoloLens 2 использует процессор ARM. Существующие приложения HoloLens нужно перенести для поддержки ARM. Как отмечалось ранее, Unity 2018 LTS поддерживает компиляцию для приложений ARM32, а Unity 2019.x — для приложений ARM32 и ARM64. Рекомендуется разрабатывать приложения ARM64, так как их производительность существенно выше. Но в таком случае все [зависимости подключаемого модуля](https://docs.unity3d.com/Manual/Plugins.html) также должны быть созданы для ARM64.

Просмотрите все зависимости от библиотеки DLL в приложении. Рекомендуется удалить зависимости, которые больше не нужны для проекта. Для остальных необходимых подключаемых модулей примите соответствующие двоичные файлы ARM32 и ARM64 в проекте Unity.

Когда будут приняты важные библиотеки DLL, создайте решение Visual Studio на основе Unity и скомпилируйте приложение AppX для ARM в Visual Studio, чтобы подтвердить возможность работы с процессорами ARM. Мы рекомендуем сохранить это приложение как фиксацию в системе управления версиями.

> [!IMPORTANT]
> Приложения, использующие MRTK версии 1, можно запускать на HoloLens 2 после изменения целевой платформы сборки на ARM при условии соблюдения всех других требований. К ним относится наличие ARM-версий для всех ваших подключаемых модулей. Но при этом ваше приложение не будет иметь доступа к специальным функциям HoloLens 2, таким как точное отслеживание движений рук и глаз. MRTK версии 1 и MRTK версии 2 имеют разные пространства имен, что позволяет использовать обе версии в одном проекте. Это может быть полезно при переходе от одной версии к другой.

## <a name="update-to-mrtk-version-2"></a>Обновление до MRTK версии 2

[МРТК версии 2](https://github.com/microsoft/MixedRealityToolkit-Unity) — это новый набор средств на основе Unity, который поддерживает как HoloLens (1-го поколения), так и HoloLens 2. Именно в него были добавлены все новые возможности HoloLens 2, такие как взаимодействие с помощью рук и отслеживание глаз.

Дополнительные сведения об использовании MRTK версии 2 см. в следующих ресурсах:

- [MRTK: домашняя страница документации](https://docs.microsoft.com/windows/mixed-reality/mrtk-unity)
- [Руководство по установке](https://docs.microsoft.com/windows/mixed-reality/mrtk-unity/install-the-tools)
- [MRTK: отслеживание рук](https://docs.microsoft.com/windows/mixed-reality/mrtk-unity/features/input/hand-tracking)
- [MRTK: отслеживание движения глаз](https://docs.microsoft.com/windows/mixed-reality/mrtk-unity/features/input/eye-tracking/eye-tracking-main)

### <a name="prepare-for-the-migration"></a>Подготовка к миграции

Перед приемом новых [файлов *.unitypackage для MRTK версии 2](https://github.com/Microsoft/MixedRealityToolkit-Unity/releases) мы рекомендуем составить список **1) пользовательского кода, который интегрируется с MRTK версии 1** и **2) пользовательского кода для взаимодействия с входными данными или для компонентов интерфейса**. Наиболее распространенные конфликты при освоении возможностей MRTK версии 2 для разработчиков в сфере смешанной реальности касаются методов ввода и взаимодействия. Рекомендуем начать изучение [модели ввода MRTK версии 2](https://docs.microsoft.com/windows/mixed-reality/mrtk-unity/features/input/overview).

Наконец, в новом решении [MRTK версии 2](https://github.com/microsoft/MixedRealityToolkit-Unity) реализован переход с модели скриптов и объектов управления в сцене на архитектуру конфигурации и поставщика служб. В результате формируется более четкая иерархия и архитектурная модель. Но для этого нужно изучить новые профили конфигурации. Изучите [руководство по настройке набора средств для смешанной реальности](https://docs.microsoft.com/windows/mixed-reality/mrtk-unity/configuration/mixed-reality-configuration-guide), чтобы приступить к ознакомлению с важными параметрами и профилями, которые нужно адаптировать к требованиям вашего приложения.

### <a name="migrating-the-project"></a>Перенос проекта

Есть высокая степень вероятности, что после импорта [MRTK версии 2](https://github.com/microsoft/MixedRealityToolkit-Unity) в вашем проекте Unity возникнет множество ошибок компиляции. Часто это связано с новой структурой пространства имен и новыми именами компонентов. Перейдите к устранению этих ошибок, изменяя пространства имен и компоненты во всех скриптах.

Дополнительные сведения об определенных различиях между API для HTK/MRTK и MRTK версии 2 приведены в руководстве по переносу на [вики-сайте MRTK версии 2](https://docs.microsoft.com/windows/mixed-reality/mrtk-unity/updates-deployment/htk-to-mrtk-porting-guide).

### <a name="best-practices"></a>Рекомендации

- Преимущество отдается [стандартному построителю текстуры MRTK](https://docs.microsoft.com/windows/mixed-reality/mrtk-unity/features/rendering/mrtk-standard-shader).
- Работайте с типами критических изменений поочередно (например, переход с IFocusable на [IMixedRealityFocusHandler](https://docs.microsoft.com/dotnet/api/microsoft.mixedreality.toolkit.input.imixedrealityfocushandler)).
- Выполняйте проверку после каждого изменения и используйте систему управления версиями.
- По возможности используйте стандартные элементы MRTK для взаимодействия с пользователем (кнопки, баннеры и т. д.).
- Не изменяйте файлы MRTK напрямую. Создайте оболочки для компонентов MRTK.
  - Это упрощает дальнейший прием данных и обновление MRTK.
- Просмотрите и изучите примеры сцен в MRTK, особенно *HandInteractionExamples.scene*.
- Модифицируйте структуру пользовательского интерфейса на основе холста, используя четырехугольники, коллайдеры и текст TextMeshPro.
- Включите [общий доступ к буферу глубины](../unity/camera-in-unity.md#sharing-depth-buffers) или [задайте точку фокусировки](../unity/focus-point-in-unity.md). Предпочтительно использовать 16-разрядный буфер глубины, чтобы повысить производительность. Убедитесь, что при отрисовке цвета отображается глубина. Как правило, Unity не изменяет данные глубины для прозрачных и текстовых игровых объектов.
- Задайте путь однопроходной отрисовки экземпляра.
- Примените [профиль конфигурации HoloLens 2 для MRTK](https://docs.microsoft.com/windows/mixed-reality/mrtk-unity/features/profiles/profiles#hololens-2-profile).

### <a name="testing-your-application"></a>Тестирование приложения

В MRTK версии 2 вы можете имитировать взаимодействие с помощью рук непосредственно в Unity, а также выполнять разработку с новыми интерфейсами API для реализации взаимодействия с помощью рук и отслеживания глаз. Для создания оптимального пользовательского интерфейса требуется устройство HoloLens 2. Мы рекомендуем ознакомиться с документацией и инструментами, чтобы составить более четкое представление о решении. [MRTK версии 2](https://github.com/microsoft/MixedRealityToolkit-Unity) поддерживает разработку для устройств HoloLens (1-го поколения). Традиционные модели ввода (например, выбор элемента касанием) можно тестировать на HoloLens (1-го поколения). 

## <a name="updating-your-interaction-model-for-hololens-2"></a>Обновление модели взаимодействия для HoloLens 2

> [!CAUTION]
> Если в проекте используются какие-либо API-интерфейсы XR.WSA, в будущих выпусках Unity они будут выведены из эксплуатации и заменены новыми API-интерфейсами ввода XR Unity. Дополнительные сведения об [API-интерфейсах ввода XR см. здесь](https://docs.unity3d.com/Manual/xr_input.html).

После переноса приложения и его подготовки к работе с HoloLens 2 можно приступить к обновлению модели взаимодействия и расположения макетов голограмм.
В приложении, разработанном для HoloLens (1-го поколения), по всей вероятности, реализована модель взаимодействия с помощью направления взгляда с подтверждением. Она используется при взаимодействии с голограммами, расположенными на удалении, чтобы они могли поместиться в поле зрения.

Шаги по обновлению структуры приложения для максимальной адаптации к HoloLens 2:
1.  Компоненты MRTK. Если вы добавили [MRTK версии 2](https://github.com/microsoft/MixedRealityToolkit-Unity), можно использовать различные компоненты и скрипты, которые разработаны и оптимизированы для HoloLens 2.

2.  Модель взаимодействия. Рекомендуется обновить модель взаимодействия. В большинстве случаев мы рекомендуем перейти с модели взаимодействия с помощью взгляда с подтверждением на модель взаимодействия с помощью рук. Например, для голограмм, которые обычно оказываются за пределами досягаемости, используются лучи, указывающие на предмет при удаленном взаимодействии, и жесты захвата.

3.  Расположение голограммы. Когда вы перейдете на модель взаимодействия с помощью рук, переместите некоторые голограммы ближе, используя жесты захвата, чтобы непосредственно взаимодействовать с ними руками. Мы рекомендуем переместить ближе такие типы голограмм: небольшие целевые меню, элементы управления, кнопки и небольшие голограммы, которые помещаются в поле зрения HoloLens 2 при захвате и рассмотрении голограммы.
<br>
Все приложения и сценарии разные. Мы будем продолжать совершенствовать и публиковать рекомендации по разработке на основе отзывов и полученных знаний.


## <a name="additional-caveats-and-learnings-about-moving-applications-from-x86-to-arm"></a>Дополнительные предостережения и сведения о переводе приложений с 32-разрядных процессоров на ARM

- Базовые приложения Unity просты. Вы можете создать пакет приложений ARM или выполнить развертывание непосредственно на устройстве для запуска пакета. Некоторые собственные подключаемые модули Unity могут вызывать определенные проблемы при разработке. Поэтому необходимо обновить все собственные подключаемые модули Unity до версии Visual Studio 2019, а затем повторно выполнить сборку для ARM.

- Предположим, что в приложении используется подключаемый модуль AudioKinetic Wwise и в этой версии Unity нет подключаемого модуля UWP для ARM. В такой ситуации придется потратить много усилий на доработку звуковых возможностей в приложении для запуска на ARM. Убедитесь, что все необходимые подключаемые модули для планов разработки установлены и доступны в Unity.

- Иногда для подключаемых модулей, требующихся приложению, может не быть подключаемых модулей UWP или ARM. Это препятствует переносу приложения и его запуску на HoloLens 2. Обратитесь к поставщику подключаемого модуля, чтобы устранить проблему и обеспечить поддержку ARM.

- Элементы minfloat (и их разновидности, такие как min16float, minint и т. д.) в шейдерах могут по-разному действовать на HoloLens 2 и HoloLens (1-го поколения). Но при этом гарантируется, что по крайней мере будет использоваться указанное количество битов. Графические процессоры Intel и Nvidia преимущественно обрабатывают minifloat как 32-битные. В ARM будет использоваться фактическое количество битов. Это означает, что на практике эти показатели будут менее точными или диапазон на HoloLens 2 будет меньше, чем на HoloLens (1-го поколения).

- Инструкции _asm не будут работать в ARM. Поэтому потребуется переписать все строки кода, где используются инструкции _asm.

- ARM не поддерживает набор инструкций SIMD, потому что в ARM отсутствуют некоторые заголовки, такие как xmmintrin.h, emmintrin.h, tmmintrin.h и immintrin.h.

- Компилятор построителя текстуры запускается в ARM во время первого вызова метода рисования после загрузки построителя текстуры или при изменении объекта, от которого зависит построитель, не во время его загрузки. Влияние на частоту кадров может быть заметным в зависимости от того, сколько шейдеров необходимо скомпилировать, и это диктует изменение правил обработки, упаковки и обновления шейдеров для HoloLens 2 по сравнению с HoloLens (1-го поколения).

## <a name="see-also"></a>См. также статью

* [Установка средств](../install-the-tools.md)
* [MRTK: руководство по установке](https://docs.microsoft.com/windows/mixed-reality/mrtk-unity/install-the-tools)
* [MRTK: домашняя страница документации](https://docs.microsoft.com/windows/mixed-reality/mrtk-unity)
* [Перенос из HoloToolkit/MRTK в MRTK версии 2](https://docs.microsoft.com/windows/mixed-reality/mrtk-unity/updates-deployment/htk-to-mrtk-porting-guide)
* [Рекомендуемые параметры для Unity](../unity/recommended-settings-for-unity.md)
* [Understanding performance for Mixed Reality](../platform-capabilities-and-apis/understanding-performance-for-mixed-reality.md) (Основные сведения о производительности для Смешанной реальности)
