---
title: 3. Настройка проекта для смешанной реальности
description: Часть 3 (из 6) серии руководств по созданию приложения для игры в шахматы с помощью Unreal Engine 4 и подключаемого модуля Mixed Reality Toolkit UX Tools
author: hferrone
ms.author: v-hferrone
ms.date: 11/18/2020
ms.topic: article
ms.localizationpriority: high
keywords: Unreal, Unreal Engine 4, UE4, HoloLens, HoloLens 2, смешанная реальность, учебник, начало работы, MRTK, UXT, UX Tools, документация, гарнитура смешанной реальности, гарнитура Windows Mixed Reality, гарнитура виртуальной реальности
ms.openlocfilehash: 491e17c5a85ed05f2e324a4f346cc82d207440469fae97fc88fee7065fae0495
ms.sourcegitcommit: a1c086aa83d381129e62f9d8942f0fc889ffcab0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/05/2021
ms.locfileid: "115226845"
---
# <a name="3-setting-up-your-project-for-mixed-reality"></a>3. Настройка проекта для смешанной реальности

В предыдущем разделе мы настроили проект приложения для игры в шахматы. В этом разделе мы настроем приложение для разработки в контексте смешанной реальности, то есть добавим в него сеанс дополненной реальности. Для этого мы воспользуемся ресурсом данных ARSessionConfig, который содержит полезные параметры для настройки функций дополненной реальности, такие как пространственное сопоставление и загораживание. Дополнительные сведения см. в разделах, посвященных [ARSessionConfig](https://docs.unrealengine.com/en-US/PythonAPI/class/ARSessionConfig.html) и [UARSessionConfig](https://docs.unrealengine.com/en-US/API/Runtime/AugmentedReality/UARSessionConfig/index.html), документации по Unreal.

## <a name="objectives"></a>Задачи

* Работа с параметрами дополненной реальности Unreal Engine.
* Использование ресурса данных ARSessionConfig.
* Настройка объекта Pawn и игрового режима.

## <a name="adding-the-session-asset"></a>Добавление ресурса для сеанса.

Сеансы дополненной реальности в Unreal не возникают сами по себе. Для работы с сеансом требуется ресурс данных ARSessionConfig, который мы сейчас и добавим:

1. В обозревателе контента (**Content Browser**) выберите **Add New > Miscellaneous > Data Asset** (Добавить > Разное > Ресурс данных). Выйдите на уровень корневой папки **Content**.
    * Выберите **ARSessionConfig**, нажмите кнопку **Select** (Выбрать) и присвойте ресурсу имя **ARSessionConfig**.

![Создание ресурса данных](images/unreal-uxt/3-createasset.PNG)

3. Дважды щелкните ресурс **ARSessionConfig**, чтобы открыть его, оставьте параметры по умолчанию и нажмите кнопку **Save** (Сохранить). Вернитесь в главное окно.

![Конфигурация сеанса дополненной реальности](images/unreal-uxt/3-arsessionconfig.PNG)

Следующий шаг — настроить сеанс дополненной реальности таким образом, чтобы он запускался при загрузке уровня и останавливался при его завершении. К счастью, для этого в Unreal есть специальная схема **Level Blueprint** (Схема уровня), которая работает как глобальный граф событий, относящихся к уровню. Если подключить ресурс ARSessionConfig на схеме **Level Blueprint** (Схема уровня), сеанс дополненной реальности будет гарантированно стартовать в момент начала игры.

1. В панели инструментов редактора выберите **Blueprints > Open Level Blueprint** (Схемы > Открыть схему уровня):

![Открытие схемы уровня](images/unreal-uxt/3-level-blueprint.PNG)

5. Перетащите закрепление выполнения (указывающую вправо стрелку) из узла **Event BeginPlay** (Событие BeginPlay) и отпустите его, а затем введите **Start AR Session** (Начать сеанс дополненной реальности) для поиска и нажмите клавишу "ВВОД".  
    * В разделе **Session Config** (Параметры сеанса) щелкните стрелку раскрывающегося списка **Select Asset** (Выбор ресурса) и выберите ресурс **ARSessionConfig**.

![Запуск сеанса дополненной реальности](images/unreal-uxt/3-start-ar-session.PNG)

6. Щелкните правой кнопкой мыши в EventGraph и создайте новый узел **Event EndPlay** (Завершение воспроизведения события). Перетащите закрепление выполнения и отпустите его, а затем введите **Stop AR Session** (Завершить сеанс дополненной реальности) для поиска и нажмите клавишу "ВВОД". Если сеанс дополненной реальности не останавливается по окончании уровня, некоторые функции могут не работать после перезапуска приложения при потоковой передаче данных на гарнитуру.
    * Нажмите кнопку **Compile** (Компилировать), а затем **Save** (Сохранить), после чего вернитесь в главное окно.

![Остановка сеанса дополненной реальности](images/unreal-uxt/3-stoparsession.PNG)

## <a name="create-a-pawn"></a>Создание элемента Pawn

Пока что в проекте недостает объекта-игрока. В Unreal объект **Pawn** представляет игрока в игре, но в нашем случае вместо игры будет взаимодействие в HoloLens 2.

1. В папке **Content** выберите **Add New > Blueprint Class** (Добавить > Класс схемы) и разверните расположенный внизу раздел **All Classes** (Все классы).
    * Найдите элемент **DefaultPawn**, нажмите кнопку **Select** (Выбрать), присвойте ему имя **MRPawn** и дважды щелкните ресурс, чтобы открыть его.

![Создание нового объекта Pawn, наследующего от DefaultPawn](images/unreal-uxt/3-defaultpawn.PNG)

2. Щелкните **Add Component (Добавить компонент) > Camera (Камера)** в панели **Components** (Компоненты) и присвойте ему имя **Camera** (Камера). Убедитесь, что компонент **Camera** (Камера) является прямым дочерним объектом корня (**CollisionComponent**). Это позволит камере игрока перемещаться вместе с устройством HoloLens 2.

> [!NOTE]
> По умолчанию у объектов Pawn есть компоненты, представляющие трехмерную сетку и столкновение. В большинстве проектов Unreal объекты Pawn — это твердые предметы, которые могут сталкиваться с другими компонентами. Поскольку в смешанной реальности объект Pawn и пользователь представляют собой одно и то же, необходимо, чтобы игрок мог проходить сквозь голограммы без столкновений.

3. В панели **Components** (Компоненты) выберите компонент **CollisionComponent**, а затем в панели **Details** (Сведения) прокрутите вниз до раздела **Collision** (Столкновение).
    * Щелкните стрелку раскрывающегося списка **Collision Presets** (Предустановленные режимы столкновения) и выберите в нем значение **NoCollision**.
    * Выполните те же действия для компонента **MeshComponent**.

![Изменение параметров столкновения для объекта Pawn](images/unreal-uxt/3-nocollision.PNG)

4. **Скомпилируйте** и **сохраните** схему.

Закончив с этим, вернитесь в главное окно.

## <a name="create-a-game-mode"></a>Создание игрового режима

Последний аспект настройки приложения для смешанной реальности — это игровой режим (Game Mode). Он определяет целый ряд параметров игры или взаимодействия, включая объект Pawn по умолчанию.

1.  В папке **Content** выберите **Add New > Blueprint Class** (Добавить > Класс схемы) и выберите **Game Mode Base** в качестве родительского класса. Присвойте ему имя **MRGameMode** и дважды щелкните, чтобы открыть.

![MRGameMode в обозревателе содержимого](images/unreal-uxt/3-gamemode.PNG)

2.  В панели **Details** (Сведения) перейдите в раздел **Classes** (Классы) и поменяйте значение параметра **Default Pawn Class** (Класс Pawn по умолчанию) на **MRPawn**.
    * Нажмите кнопку **Compile** (Компилировать), а затем **Save** (Сохранить), после чего вернитесь в главное окно.

![Установка класса Pawn по умолчанию](images/unreal-uxt/3-setpawn.PNG)

3.  Выберите **Edit > Projects Settings** (Правка > Параметры проекта) и щелкните пункт **Maps & Modes** (Карты и режимы) в левом списке.
    * Разверните раздел **Default Modes** (Режимы по умолчанию) и поменяйте значение параметра **Default Game Mode** (Игровой режим по умолчанию) на **MRGameMode**.
    * Разверните раздел **Default Maps** (Карты по умолчанию) и вместо значений **EditorStartupMap** и **GameDefaultMap** выберите значение **Main**. Когда вы закроете и снова откроете редактор, по умолчанию будет выбрана карта Main.

![Параметры проекта — Карты и режимы](images/unreal-uxt/3-mapsandmodes.PNG)

Проект настроен для смешанной реальности. Теперь можно переходить к следующему руководству, в котором показано, как добавить в сцену возможности пользовательского ввода.

[Следующий раздел: 4. Настройка интерактивной сцены](unreal-uxt-ch4.md)
