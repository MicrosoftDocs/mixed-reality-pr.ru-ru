---
title: 5. Добавление кнопки и сброс расположений фигур
description: Часть 5 (из 6) серии руководств по созданию приложения для игры в шахматы с помощью Unreal Engine 4 и подключаемого модуля Mixed Reality Toolkit UX Tools
author: hferrone
ms.author: v-hferrone
ms.date: 11/18/2020
ms.topic: article
ms.localizationpriority: high
keywords: Unreal, Unreal Engine 4, UE4, HoloLens, HoloLens 2, смешанная реальность, учебник, начало работы, MRTK, UXT, UX Tools, документация, гарнитура смешанной реальности, гарнитура Windows Mixed Reality, гарнитура виртуальной реальности
ms.openlocfilehash: 8e16865e89c06c37f2932f1828bf8ca5551e6fce
ms.sourcegitcommit: 32cb81eee976e73cd661c2b347691c37865a60bc
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/04/2020
ms.locfileid: "96609695"
---
# <a name="5-adding-a-button--resetting-piece-locations"></a>5. Добавление кнопки и сброс расположений фигур

В предыдущем руководстве мы добавили субъекты взаимодействия с рукой к компонентам Pawn и Manipulator на шахматной доске, чтобы сделать оба эти компонента интерактивными. В этом разделе показано, как с помощью подключаемого модуля Mixed Reality Toolkit UX Tools можно создать приложение для игры в шахматы с новыми функциями и ссылками на субъекты в схемах. К концу раздела у вас все будет готово к упаковке приложения смешанной реальности и его развертыванию на устройстве или эмуляторе.

## <a name="objectives"></a>Задачи

* Добавление интерактивной кнопки.
* Создание функции для сброса расположения фигуры.
* Подключение кнопки к триггеру, чтобы ее нажатие активировало созданную функцию.

## <a name="creating-a-reset-function"></a>Создание функции сброса

Первым делом необходимо создать схему функции, которая сбрасывает расположение фигуры, возвращая ее на исходное место в сцене.

1.  Откройте **WhiteKing**, щелкните значок **+** рядом с разделом **Functions** (Функции) на панели **My Blueprint** (Моя схема) и присвойте имя **Reset Location** (Сбросить расположение).

2.  Перетащите закрепление выполнения из функции **Reset Location** в произвольное место сетки схемы, чтобы создать узел **SetActorRelativeTransform**.
    * Эта функция задает для субъекта преобразование (расположение, поворот и масштабирование) относительно родительского элемента. С помощью этой функции мы можем вернуть короля на доске в исходное место, даже если сама доска была перемещена.

3. Щелкните правой кнопкой мыши внутри графа событий, выберите **Make Transform** (Создать преобразование) и задайте для параметра **Location** (Расположение) значения **X = -26**, **Y = 4** и **Z = 0**.
    * Соедините закрепление **Return Value** (Возвращаемое значение) с закреплением **New Relative Transform** (Новое относительное преобразование) элемента **SetActorRelativeTransform**.

![Функция сброса расположения](images/unreal-uxt/5-function.PNG)

Скомпилируйте (**Compile**) и сохраните (**Save**) проект, после чего вернитесь в главное окно.


## <a name="adding-a-button"></a>Добавление кнопки

Теперь, когда функция настроена, следующая задача — создать кнопку, при нажатии которой функция будет выполняться.

1.  Щелкните **Add New > Blueprint Class** (Добавить > Класс схемы), разверните раздел **All Classes** (Все классы) и введите **UxtPressableButtonActor** для поиска.
    * Присвойте созданной кнопке имя **ResetButton** и дважды щелкните ее, чтобы открыть соответствующую схему.

![Создание подкласса схемы из кнопки в стиле HoloLens 2](images/unreal-uxt/5-subclass.PNG)

2. Убедитесь, что параметр **ResetButton(self)** выбран в области **Components** (Компоненты). В области **Details** (Сведения) перейдите к разделу **Button** (Кнопка). Укажите для параметра **Button Label** (Метка кнопки) значение Reset (Сбросить), разверните раздел **Button Icon Brush** (Кисть значка с кнопкой) и нажмите кнопку **Open Icon Brush Editor** (Открыть редактор кисти значка).

![Настройка метки и значка для кнопки](images/unreal-uxt/5-buttonconfig.PNG)

Откроется редактор кисти значка, где можно выбрать новый значок для кнопки.

![Выбор значка для кнопки](images/unreal-uxt/5-iconbrusheditor.PNG)

Доступно множество параметров, с помощью которых можно настроить кнопку. Дополнительные сведения о компоненте нажимаемой кнопки UXT см. в [документации](https://microsoft.github.io/MixedReality-UXTools-Unreal/Docs/PressableButton.html).

3. В области **Components** (Компоненты) щелкните **ButtonComponent (Inherited)** и прокрутите панель **Details** (Сведения) до раздела **Events** (События).
    * Нажмите зеленую кнопку **+** рядом с событием **On Button Pressed** (По нажатию кнопки), чтобы добавить это событие в граф событий. Добавленное событие будет инициироваться при нажатии кнопки, которую мы создаем.

Из этого события мы будем вызывать функцию **Reset Location** (Сброс расположения) элемента **WhiteKing**, для чего требуется ссылка на субъект **WhiteKing** на данном уровне.

4.  На панели **My Blueprint** (Моя схема) перейдите к разделу **Variables** (Переменные), нажмите кнопку **+** и присвойте переменной имя **WhiteKing**.
    * На панели **Details** (Сведения) щелкните раскрывающийся список рядом с полем **Variable Type** (Тип переменной), затем выполните поиск по слову **WhiteKing** и выберите **Object Reference** (Ссылка на объект).
    * Установите флажок **Instance Editable** (Редактируемый экземпляр), который позволяет задать переменную на уровне Main.

![Создание переменной](images/unreal-uxt/5-var.PNG)

5.  Перетащите переменную WhiteKing из раздела **My Blueprint > Variables** (Моя схема > Переменные) на граф Reset Button Event Graph (Граф событий кнопки сброса) и выберите **Get WhiteKing** (Получить WhiteKing).

## <a name="firing-the-function"></a>Вызов функции

Теперь осталось сделать так, чтобы при нажатии нашей кнопки вызывалась функция сброса.

1.  Перетащите закрепление вывода WhiteKing и отпустите его для размещения нового узла. Выберите функцию **Reset Location** (Сброс расположения). Наконец, перетащите выходное закрепление выполнения из события **On Button Pressed** (По нажатию кнопки) к входному закреплению выполнения функции **Reset Location** (Сброс расположения). **Скомпилируйте** и **сохраните** схему ResetButton, а затем вернитесь в главное окно.

![Вызов функции сброса расположения из события нажатия кнопки](images/unreal-uxt/5-callresetloc.PNG)

2.  Перетащите элемент **ResetButton** в окно просмотра и задайте для него следующее расположение: **X = 50**, **Y = -25**, **Z = 10**. Задает вращение до **Z = 180**. В разделе **Default** (По умолчанию) задайте для переменной **WhiteKing** значение **WhiteKing**.

![Указание переменной](images/unreal-uxt/5-buttonlevel.PNG)

Запустите приложение, переместите фигуру, а затем нажмите кнопку в стиле HoloLens 2 — вы увидите, как работает логика сброса расположения.

Теперь у вас есть приложение смешанной реальности с интерактивной фигурой и доской, а также работающая кнопка для сброса расположения этой фигуры. Законченное приложение в том объеме, в котором оно реализовано к данному моменту, вы найдете в репозитории [GitHub](https://github.com/microsoft/MixedReality-Unreal-Samples/tree/master/ChessApp). Вы можете не ограничиваться примерами из этого руководства и настроить остальные шахматные фигуры так, чтобы при нажатии этой кнопки вся доска принимала исходный вид.

![Готовая сцена в окне просмотра](images/unreal-uxt/5-endscene.PNG)

Теперь вы можете переходить к последнему разделу, в котором показано, как упаковать приложение и развернуть его на устройстве или в эмуляторе.

> [!IMPORTANT]
> На этом этапе вам необходимо внести изменения в проект с использованием рекомендуемых **[параметров производительности для Unreal](../performance-recommendations-for-unreal.md)** , прежде чем вы развернете приложение на устройстве или в эмуляторе.

[Следующий раздел: 6. Упаковка и развертывание на устройстве или в эмуляторе](unreal-uxt-ch6.md)
