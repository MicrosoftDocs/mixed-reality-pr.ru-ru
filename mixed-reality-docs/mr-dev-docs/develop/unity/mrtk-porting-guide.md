---
title: Подготовка существующего приложения для использования в HoloLens 2
description: Предназначено для разработчиков, которые используют существующее приложение для HoloLens (1-го поколения) и (или) устаревшей версии MRTK и хотят перейти на MRTK версии 2 и HoloLens 2.
author: grbury
ms.author: grbury
ms.date: 07/29/2020
ms.topic: article
ms.localizationpriority: high
keywords: Windows Mixed Reality, test, MRTK, MRTK version 2, HoloLens 2
ms.openlocfilehash: ca7c46f8d3c6b85125be3d6aa9d57e6f0d72fb82
ms.sourcegitcommit: 09599b4034be825e4536eeb9566968afd021d5f3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/03/2020
ms.locfileid: "91699776"
---
# <a name="get-your-existing-app-ready-for-hololens-2"></a>Подготовка существующего приложения для использования в HoloLens 2

## <a name="overview"></a>Обзор

Это руководство предназначено для разработчиков, которые используют существующее приложение Unity для HoloLens (1-го поколения) и хотят перенести его на устройство HoloLens 2. Процесс переноса приложения Unity для HoloLens (1-го поколения) на HoloLens 2 состоит из четырех основных шагов. 

Эти шаги подробно описаны в приведенных ниже разделах.

| Шаг 1 | Шаг 2 | Шаг 3 | Шаг 4 |
|----------|-------------------|-------------------|-------------------|
| ![Логотип Visual Studio](../images/visualstudio_logo.png) | ![Логотип Unity](../../design/images/final_unity_logo.png)| ![Значок Unity](images/hololens2_icon.jpg) | ![Логотип МРТК](../../design/images/final_mrtk-small_logo.png) |
| Скачивание новейших средств | Обновление проекта Unity | Компиляция для ARM | Миграция в MRTK версии 2

Необходимые условия:

**Настоятельно рекомендуется** использовать систему управления версиями для сохранения снимка первоначального состояния приложения до начала переноса. Кроме того, мы рекомендуем *сохранить* данные состояния контрольных точек в разное время при выполнении процесса. Также удобно создать еще один экземпляр исходного приложения Unity, чтобы обеспечить сравнение версий приложения во время переноса. 

> [!NOTE]
> Перед переносом убедитесь, что установлены последние версии средств разработки для Windows Mixed Reality. Для большинства разработчиков HoloLens это последняя версия Visual Studio 2019 и соответствующий пакет SDK для Windows. Подробное описание различных версий Unity и набора средств для смешанной реальности (MRTK) версии 2 представлено далее.
>
> Дополнительные сведения см. в статье [Install the tools](../install-the-tools.md) (Установка средств).

## <a name="migrate-project-to-the-latest-version-of-unity"></a>Перенос проекта в последнюю версию Unity

Если вы используете [MRTK версии 2](https://github.com/microsoft/MixedRealityToolkit-Unity), [Unity 2019 LTS](https://unity3d.com/unity/qa/lts-releases) — наилучший вариант долгосрочной поддержки без критических изменений в Unity или MRTK. Вам следует оценить все [зависимости подключаемого модуля](https://docs.unity3d.com/Manual/Plugins.html), которые сейчас есть в проекте, а также определить возможность выполнить сборку этих библиотек DLL для ARM64. Если подключаемый модуль жесткой зависимости для ARM64 создать не удается, возможно, вам нужно будет продолжить создание приложения для ARM.

<!-- MRTK v2 always guarantees support for Unity 2018 LTS, but does not necessarily guarantee support for every iteration of Unity 2019.x.

To help clarify additional differences between [Unity 2018 LTS](https://unity3d.com/unity/qa/lts-releases) and Unity 2019.x, the following table outlines the trade-offs between the two versions. The primary difference between the two is the ability to compile for ARM64 in Unity 2019.

| Unity 2018 LTS | Unity 2019.x |
|----------|-------------------|
| ARM32 build support | ARM32 and ARM64 build support |
| Stable LTS build release | Beta stability |
| [.NET Scripting back-end](https://docs.unity3d.com/2018.4/Documentation/Manual/windowsstore-dotnet.html) *deprecated* | [.NET Scripting back-end](https://docs.unity3d.com/2018.4/Documentation/Manual/windowsstore-dotnet.html) *removed* |
| UNET Networking *deprecated* | UNET Networking *deprecated* |

-->

## <a name="update-sceneproject-settings-in-unity"></a>Обновление параметров сцены или проектов в Unity

После обновления до [Unity 2019 LTS](https://unity3d.com/unity/qa/lts-releases) рекомендуется изменить определенные параметры в Unity, чтобы получить оптимальные результаты на устройстве. Подробное описание этих параметров см. в статье [Рекомендуемые параметры для Unity](Recommended-settings-for-Unity.md).

Необходимо повторно выполнить итерацию, так как [серверная часть сценариев .NET](https://docs.unity3d.com/Manual/windowsstore-dotnet.html) была помечена как нерекомендуемая в Unity 2018 и *удалена* в Unity 2019. Разработчикам настоятельно рекомендуется перевести проект на [IL2CPP](https://docs.unity3d.com/Manual/IL2CPP.html).

> [!NOTE]
> При использовании серверной части для работы со скриптами IL2CPP может увеличиться время сборки из Unity в Visual Studio. Разработчикам следует настроить свои компьютеры для разработки, чтобы [оптимизировать время сборки IL2CPP](https://docs.unity3d.com/Manual/IL2CPP-OptimizingBuildTimes.html).
> Кроме того, возможно, будет полезно настроить [сервер кэширования](https://docs.unity3d.com/Manual/CacheServer.html), особенно для проектов Unity с большим объемом ресурсов (за исключением файлов скриптов) либо постоянно меняющимися сценами или ресурсами. Когда открывается проект, Unity сохраняет соответствующие ресурсы в формате для внутреннего кэша на компьютере разработчика. Измененные элементы нужно повторно импортировать и еще раз обработать. Этот процесс можно выполнить однократно и сохранить на сервере кэширования, а значит, и совместно использовать с другими разработчиками для экономии времени. При этом каждому разработчику не придется обрабатывать повторно импортированные измененные элементы локально.

Разобравшись с критическими изменениями после перехода на обновленную версию Unity, выполните сборку и тестирование текущих приложений на HoloLens (1-го поколения). Кроме того, это подходящий момент для создания и сохранения фиксации в системе управления версиями.

## <a name="compile-dependenciesplugins-for-arm-processor"></a>Компиляция зависимостей или подключаемых модулей для процессора ARM

Приложения для HoloLens 1-го поколения выполнялись на 32-разрядных (x86) процессорах. HoloLens 2 использует процессор ARM. Поэтому существующие приложения HoloLens нужно перевести на ARM. Как отмечалось ранее, Unity 2018 LTS поддерживает компиляцию для приложений ARM32, а Unity 2019.x — для приложений ARM32 и ARM64. Рекомендуется разрабатывать приложения ARM64, так как производительность при этом существенно выше. Но в таком случае все [зависимости подключаемого модуля](https://docs.unity3d.com/Manual/Plugins.html) также должны быть созданы для ARM64.

Просмотрите все зависимости от библиотеки DLL в приложении. Если зависимость больше не используется, рекомендуется удалить ее из проекта. Для остальных необходимых подключаемых модулей примите соответствующие двоичные файлы ARM32 и ARM64 в проекте Unity.

Когда будут приняты соответствующие библиотеки DLL, создайте решение Visual Studio в Unity и скомпилируйте приложение AppX для ARM в Visual Studio, чтобы проверить, можно ли создать его для процессоров ARM. Мы рекомендуем сохранить приложение как фиксацию в системе управления версиями.

> [!IMPORTANT]
> Приложения, использующие MRTK версии 1, можно запускать на HoloLens 2 после изменения целевой платформы сборки на ARM при условии соблюдения всех других требований. К ним относится наличие ARM-версий для всех ваших подключаемых модулей. Но при этом ваше приложение не будет иметь доступа к специальным функциям HoloLens 2, таким как точное отслеживание движений рук и глаз. MRTK версии 1 и MRTK версии 2 имеют разные пространства имен, что позволяет использовать обе версии в одном проекте. Это может быть полезно при переходе от одной версии к другой.

## <a name="update-to-mrtk-version-2"></a>Обновление до MRTK версии 2

[МРТК версии 2](https://github.com/microsoft/MixedRealityToolkit-Unity) — это новый набор средств на основе Unity, который поддерживает как HoloLens (1-го поколения), так и HoloLens 2. В него также добавлены все новые возможности HoloLens 2, такие как взаимодействие с помощью рук и отслеживание глаз.

Дополнительные сведения об использовании MRTK версии 2 см. в следующих ресурсах:

- [Целевая страница MRTK](https://microsoft.github.io/MixedRealityToolkit-Unity/README.html)
- [Getting started with MRTK](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/GettingStartedWithTheMRTK.html) (Начало работы с MRTK)
- [Отслеживание рук в MRTK](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/Input/HandTracking.html)
- [Отслеживание движения глаз в MRTK](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/EyeTracking/EyeTracking_Main.html)

### <a name="prepare-for-the-migration"></a>Подготовка к миграции

Перед приемом новых файлов [*.unitypackage для MRTK версии 2](https://github.com/Microsoft/MixedRealityToolkit-Unity/releases) рекомендуется провести инвентаризацию **1) любого пользовательского кода, который интегрируется с MRTK версии 1** и **2) любого пользовательского кода для взаимодействия с помощью ввода или для компонентов UX** . Наиболее распространенные конфликты при освоении возможностей MRTK версии 2 для разработчиков в сфере смешанной реальности касаются методов ввода и взаимодействия. Рекомендуем прочитать статью о [модели ввода MRTK версии 2](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/Input/Overview.html).

Наконец, в новом решении [MRTK версии 2](https://github.com/microsoft/MixedRealityToolkit-Unity) реализован переход с модели скриптов и объектов управления в сцене на архитектуру конфигурации и поставщика служб. В результате формируется более четкая иерархия и архитектурная модель. Но для этого нужно изучить новые профили конфигурации. Рекомендуем прочитать [руководство по настройке набора средств для смешанной реальности](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/MixedRealityConfigurationGuide.html), чтобы приступить к ознакомлению с важными параметрами и профилями, которые нужно адаптировать к требованиям вашего приложения.

### <a name="perform-the-migration"></a>Выполнение миграции

Есть высокая степень вероятности, что после импорта [MRTK версии 2](https://github.com/microsoft/MixedRealityToolkit-Unity) в вашем проекте Unity возникнет множество ошибок компиляции. Часто это связано с новой структурой пространства имен и новыми именами компонентов. Перейдите к устранению этих ошибок и измените скрипты в соответствии с новыми пространствами имен и компонентами.

Дополнительные сведения об определенных различиях между API для HTK/MRTK и MRTK версии 2 приведены в руководстве по переносу на [вики-сайте MRTK версии 2](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/HTKToMRTKPortingGuide.html).

### <a name="best-practices"></a>Рекомендации

- Преимущество отдается [стандартному построителю текстуры MRTK](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/README_MRTKStandardShader.html).
- Работайте с типами критических изменений поочередно (например, переход с IFocusable на [IMixedRealityFocusHandler](https://microsoft.github.io/MixedRealityToolkit-Unity/api/Microsoft.MixedReality.Toolkit.Input.IMixedRealityFocusHandler.html)).
- Выполняйте проверку после каждого изменения и используйте систему управления версиями.
- По возможности используйте стандартные элементы взаимодействия с пользователем MRTK (кнопки, баннеры и т. д.).
- Не изменяйте файлы MRTK напрямую. Создайте оболочки для компонентов MRTK.
    - Это упрощает дальнейший прием данных и обновление MRTK.
- Просмотрите и изучите примеры сцен в MRTK, особенно *HandInteractionExamples.scene* .
- Модифицируйте структуру пользовательского интерфейса на основе холста, используя четырехугольники, коллайдеры и текст TextMeshPro.
- Включите [общий доступ к буферу глубины](camera-in-unity.md#sharing-your-depth-buffers-with-windows) или [задайте точку фокусировки](focus-point-in-unity.md). Предпочтительно использовать 16-разрядный буфер глубины, чтобы повысить производительность. Убедитесь, что при отрисовке цвета отображается глубина. Как правило, Unity не записывает данные глубины для прозрачных и текстовых игровых объектов. 
- Задайте путь однопроходной отрисовки экземпляра.
- Используйте [профиль конфигурации Hololens 2 для MRTK](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/Profiles/Profiles.html#hololens-2-profile).

### <a name="testing-your-application"></a>Тестирование приложения

В MRTK версии 2 вы можете имитировать взаимодействие с помощью рук непосредственно в Unity, а также выполнять разработку с использованием новых интерфейсов API для реализации взаимодействия с помощью рук и отслеживания глаз. Для создания оптимального пользовательского интерфейса требуется устройство HoloLens 2. Рекомендуем приступить к изучению документации и инструментов, чтобы составить более четкое представление о решении. [MRTK версии 2](https://github.com/microsoft/MixedRealityToolkit-Unity) поддерживает разработку для устройств HoloLens (1-го поколения). Традиционные модели ввода (например, выбор элемента касанием) можно тестировать на HoloLens (1-го поколения). 

## <a name="updating-your-interaction-model-for-hololens-2"></a>Обновление модели взаимодействия для HoloLens 2

После переноса приложения и его подготовки к работе с HoloLens 2 можно приступить к обновлению модели взаимодействия и расположения макетов голограмм.
В приложении, разработанном для HoloLens (1-го поколения), по всей вероятности, реализована модель взаимодействия с помощью направления взгляда с подтверждением. Она используется при взаимодействии с голограммами, расположенными на удалении, чтобы они могли поместиться в поле зрения.

Шаги по обновлению структуры приложения для максимальной адаптации к HoloLens 2:
1.  Компоненты MRTK. Если вы добавили [MRTK версии 2](https://github.com/microsoft/MixedRealityToolkit-Unity), можно использовать различные компоненты и скрипты, которые разработаны и оптимизированы для HoloLens 2.

2.  Модель взаимодействия. Рекомендуется обновить модель взаимодействия. В большинстве случаев мы рекомендуем перейти с модели взаимодействия с помощью взгляда с подтверждением на модель взаимодействия с помощью рук. Например, для голограмм, которые обычно оказываются за пределами досягаемости, используются лучи, указывающие на предмет при удаленном взаимодействии, и жесты захвата.

3.  Расположение голограммы. Когда вы перейдете на модель взаимодействия с помощью рук, переместите некоторые голограммы ближе, используя жесты захвата, чтобы непосредственно взаимодействовать с ними руками. Мы рекомендуем переместить ближе такие типы голограмм: небольшие целевые меню, элементы управления, кнопки и небольшие голограммы, которые помещаются в поле зрения HoloLens 2 при захвате и рассмотрении голограммы.
<br>
Все приложения и сценарии разные. Мы будем продолжать совершенствовать и публиковать рекомендации по разработке на основе отзывов и полученных знаний.


## <a name="additional-caveats-and-learnings-about-moving-applications-from-x86-to-arm"></a>Дополнительные предостережения и сведения о переводе приложений с 32-разрядных процессоров на ARM

- Базовые приложения Unity просты. Вы можете создать пакет приложений ARM или выполнить развертывание непосредственно на устройстве для запуска пакета. Некоторые собственные подключаемые модули Unity могут вызывать определенные проблемы при разработке. Поэтому необходимо обновить все собственные подключаемые модули Unity до версии Visual Studio 2019, а затем повторно выполнить сборку для ARM.

- Предположим, что в приложении используется подключаемый модуль AudioKinetic Wwise и в этой версии Unity нет подключаемого модуля UWP для ARM. В такой ситуации придется потратить много усилий на доработку звуковых возможностей в приложении для запуска в ARM. Убедитесь, что все необходимые подключаемые модули для планов разработки установлены и доступны в Unity.

- Иногда для подключаемых модулей, требующихся приложению, может не быть подключаемых модулей UWP или ARM. Это препятствует переносу приложения и его запуску на HoloLens 2. Обратитесь к поставщику подключаемого модуля, чтобы устранить проблему и обеспечить поддержку ARM.

- Элементы minfloat (и их разновидности, такие как min16float, minint и т. д.) в шейдерах могут по-разному действовать на HoloLens 2 и HoloLens (1-го поколения). Но при этом гарантируется, что по крайней мере будет использоваться указанное количество битов. Графические процессоры Intel и Nvidia преимущественно обрабатывают их как 32-битные. В ARM будет использоваться фактическое количество битов. Это означает, что на практике эти показатели будут менее точными или диапазон на HoloLens 2 будет меньше, чем на HoloLens (1-го поколения).

- Инструкции _asm не будут работать в ARM. Поэтому потребуется переписать все строки кода, где используются инструкции _asm.

- ARM не поддерживает набор инструкций SIMD, потому что различные заголовки, такие как xmmintrin.h, emmintrin.h, tmmintrin.h и immintrin.h, недоступны в ARM.

- Компилятор построителя текстуры запускается в ARM во время первого вызова метода рисования после загрузки построителя текстуры или при изменении объекта, от которого зависит построитель, не во время его загрузки. Частота кадров может существенно зависеть от количества компилируемых шейдеров. Таким образом, способы обработки, упаковки и обновления построителей текстуры для HoloLens 2 и HoloLens (1-го поколения) будут разными.

## <a name="see-also"></a>См. также статью
* [Установка средств](../install-the-tools.md)
* [Getting started with MRTK v2](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/GettingStartedWithTheMRTK.html) (Начало работы с MRTK версии 2)
* [Переход с API-интерфейсов HTK на API-интерфейсы MRTK](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/HTKToMRTKPortingGuide.html)
* [Рекомендуемые параметры для Unity](recommended-settings-for-unity.md)
* [Understanding performance for Mixed Reality](../platform-capabilities-and-apis/understanding-performance-for-mixed-reality.md) (Основные сведения о производительности для Смешанной реальности)

