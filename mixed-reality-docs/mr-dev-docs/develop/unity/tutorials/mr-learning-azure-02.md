---
title: Учебники по облачным службам Azure, часть 2. Интеграция службы хранилища Azure
description: Из этого курса вы узнаете, как реализовать Хранилище таблиц Azure и Хранилище BLOB-объектов Azure в приложении HoloLens 2.
author: jessemcculloch
ms.author: jemccull
ms.date: 07/01/2020
ms.topic: article
keywords: смешанная реальность, unity, учебник, hololens, hololens 2, служба хранилища azure
ms.localizationpriority: high
ms.openlocfilehash: 64e4aaadf13c03272a4fc9c552a7e4b31e82fdbb
ms.sourcegitcommit: 520c69eb761ad6083b36f448bbcfab89e343e40d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/12/2020
ms.locfileid: "94549107"
---
# <a name="2-integrating-azure-storage"></a><span data-ttu-id="51fe1-105">2. Интеграция службы хранилища Azure</span><span class="sxs-lookup"><span data-stu-id="51fe1-105">2. Integrating Azure storage</span></span>

<span data-ttu-id="51fe1-106">Из этого учебника вы узнаете, как сохранить данные сущности в Хранилище таблиц Azure и эскизы в Хранилище BLOB-объектов Azure.</span><span class="sxs-lookup"><span data-stu-id="51fe1-106">In this tutorial, you will learn how to save entity data to Azure Table storage and thumbnail images to Azure Blob storage.</span></span> <span data-ttu-id="51fe1-107">Эта функция позволяет хранить и получать *отслеживаемые объекты* с такими данными, как идентификатор, имя, эскиз и т. д., между сеансами и устройствами в облаке.</span><span class="sxs-lookup"><span data-stu-id="51fe1-107">This feature will allow us to store and retrieve *Tracked Objects* with data like ID, Name, Thumbnail Image, etc. across sessions and devices to the cloud.</span></span>

## <a name="objectives"></a><span data-ttu-id="51fe1-108">Задачи</span><span class="sxs-lookup"><span data-stu-id="51fe1-108">Objectives</span></span>

* <span data-ttu-id="51fe1-109">Познакомиться с основами службы хранилища Azure.</span><span class="sxs-lookup"><span data-stu-id="51fe1-109">Learn the basics about Azure storage</span></span>
* <span data-ttu-id="51fe1-110">Узнать, как хранить, изменять и получать данные из Хранилища таблиц.</span><span class="sxs-lookup"><span data-stu-id="51fe1-110">Learn how to store, modify and retrieve data from Table storage</span></span>
* <span data-ttu-id="51fe1-111">Узнать, как хранить и удалять изображения из Хранилища BLOB-объектов.</span><span class="sxs-lookup"><span data-stu-id="51fe1-111">Learn how to store and delete images from Blob storage</span></span>

## <a name="understanding-azure-storage"></a><span data-ttu-id="51fe1-112">Общие сведения о службе хранилища Azure</span><span class="sxs-lookup"><span data-stu-id="51fe1-112">Understanding Azure storage</span></span>

<span data-ttu-id="51fe1-113">**Служба хранилища Azure** — это решение Майкрософт для хранения данных в облаке, которое может охватывать множество сценариев и требований.</span><span class="sxs-lookup"><span data-stu-id="51fe1-113">**Azure storage** is a Microsoft storage solution on the cloud that can cover many scenarios and requirements.</span></span> <span data-ttu-id="51fe1-114">Оно может быстро масштабироваться, а также быть легкодоступным для разработчиков.</span><span class="sxs-lookup"><span data-stu-id="51fe1-114">It can scale massively and is easily approachable by developers.</span></span> <span data-ttu-id="51fe1-115">Все службы можно использовать из **учетной записи службы хранилища Azure**.</span><span class="sxs-lookup"><span data-stu-id="51fe1-115">All services can be consumed under the umbrella of an **Azure storage Account**.</span></span> <span data-ttu-id="51fe1-116">В нашем случае мы будем использовать *Хранилище таблиц* и *Хранилище BLOB-объектов*.</span><span class="sxs-lookup"><span data-stu-id="51fe1-116">For our use case we will use *Table storage* and *Blob storage*.</span></span>

<span data-ttu-id="51fe1-117">Дополнительные сведения о [службах хранилища Azure](https://docs.microsoft.com/azure/storage/blobs/storage-blobs-overview).</span><span class="sxs-lookup"><span data-stu-id="51fe1-117">Learn more about [Azure storage services](https://docs.microsoft.com/azure/storage/blobs/storage-blobs-overview).</span></span>

### <a name="azure-table-storage"></a><span data-ttu-id="51fe1-118">Хранилище таблиц Azure</span><span class="sxs-lookup"><span data-stu-id="51fe1-118">Azure Table storage</span></span>

<span data-ttu-id="51fe1-119">Эти службы позволяют хранить данные в виде NoSQL. В этом проекте мы используем их для хранения информации об *отслеживаемом объекте* (например, имя, описание, идентификатор пространственной привязки и многое другое).</span><span class="sxs-lookup"><span data-stu-id="51fe1-119">This services allows us to store data in a NoSQL fashion, in this project we will use it to store information about the *Tracked Object* such as: name, description, spatial anchor id, and more.</span></span>

<span data-ttu-id="51fe1-120">В контексте демонстрационного приложения требуются две таблицы: одна для хранения сведений о проекте с информацией о состоянии обученных моделей (подробнее об этом в учебнике [Интеграция Пользовательского визуального распознавания Azure](mr-learning-azure-03.md)), а вторая — для хранения сведений об *отслеживаемых объектах*.</span><span class="sxs-lookup"><span data-stu-id="51fe1-120">In context of the demo application, you need two Tables, one to store information about the project with information about the state of trained models more about that in the ([Integrating Azure Custom Vision](mr-learning-azure-03.md)) tutorial and a second table to store information about *Tracked Objects*.</span></span>

<span data-ttu-id="51fe1-121">Дополнительные сведения о [хранилище таблиц Azure](https://docs.microsoft.com/azure/storage/tables/table-storage-overview).</span><span class="sxs-lookup"><span data-stu-id="51fe1-121">Learn more about [Azure Table storage](https://docs.microsoft.com/azure/storage/tables/table-storage-overview).</span></span>

### <a name="azure-blob-storage"></a><span data-ttu-id="51fe1-122">Хранилище BLOB-объектов Azure</span><span class="sxs-lookup"><span data-stu-id="51fe1-122">Azure Blob storage</span></span>

<span data-ttu-id="51fe1-123">Эта служба позволяет хранить большие двоичные файлы. Ее можно использовать для хранения фотографий *отслеживаемых объектов* в виде эскиза.</span><span class="sxs-lookup"><span data-stu-id="51fe1-123">This service allows to store large binary files, you will use this to store photos taken for *Tracked Objects* as thumbnail.</span></span>
<span data-ttu-id="51fe1-124">Для демонстрационного приложения необходим один контейнер BLOB-объектов для хранения изображений.</span><span class="sxs-lookup"><span data-stu-id="51fe1-124">For of the demo application you need one Blob Container to store the images.</span></span>

<span data-ttu-id="51fe1-125">Подробнее о [Хранилище BLOB-объектов Azure](https://docs.microsoft.com/azure/storage/blobs/storage-blobs-introduction).</span><span class="sxs-lookup"><span data-stu-id="51fe1-125">Learn more about [Azure Blob storage](https://docs.microsoft.com/azure/storage/blobs/storage-blobs-introduction).</span></span>

## <a name="preparing-azure-storage"></a><span data-ttu-id="51fe1-126">Подготовка службы хранилища Azure</span><span class="sxs-lookup"><span data-stu-id="51fe1-126">Preparing Azure Storage</span></span>

<span data-ttu-id="51fe1-127">Для использования служб хранилища Azure потребуется учетная запись хранения Azure.</span><span class="sxs-lookup"><span data-stu-id="51fe1-127">To consume the Azure storage services you will need an Azure storage account.</span></span> <span data-ttu-id="51fe1-128">Сведения о создании учетной записи хранения см. [здесь](https://docs.microsoft.com/azure/storage/common/storage-account-create?tabs=azure-portal).</span><span class="sxs-lookup"><span data-stu-id="51fe1-128">To create a storage account, see [Create a storage account](https://docs.microsoft.com/azure/storage/common/storage-account-create?tabs=azure-portal).</span></span> <span data-ttu-id="51fe1-129">Дополнительные сведения об учетных записях хранения см. в [этой статье](https://docs.microsoft.com/azure/storage/common/storage-account-overview).</span><span class="sxs-lookup"><span data-stu-id="51fe1-129">To learn more about storage accounts, see [Azure storage account overview](https://docs.microsoft.com/azure/storage/common/storage-account-overview).</span></span>

<span data-ttu-id="51fe1-130">Как только у вас будет учетная запись хранения, вы сможете получить строку подключения на **портале Azure**, которая потребуется в следующем разделе этого урока.</span><span class="sxs-lookup"><span data-stu-id="51fe1-130">Once you have a storage account, you can retrieve the connection string from the **Azure Portal** which will be needed in the next section of this lesson.</span></span>

### <a name="optional-azure-storage-explorer"></a><span data-ttu-id="51fe1-131">Обозреватель службы хранилища Azure (необязательно)</span><span class="sxs-lookup"><span data-stu-id="51fe1-131">Optional Azure Storage Explorer</span></span>

<span data-ttu-id="51fe1-132">Хотя вы можете просматривать и проверять все изменения данных из пользовательского интерфейса в приложении, рекомендуется установить [Обозреватель службы хранилища Azure](https://azure.microsoft.com/features/storage-explorer/).</span><span class="sxs-lookup"><span data-stu-id="51fe1-132">While you can see and verify all data changes from the UI inside the application, we recommend to install [Azure Storage Explorer](https://azure.microsoft.com/features/storage-explorer/).</span></span> <span data-ttu-id="51fe1-133">Это средство позволяет визуально просматривать данные в службе хранилища Azure и существенно помогает при отладке и обучении.</span><span class="sxs-lookup"><span data-stu-id="51fe1-133">This tool allows you to visually see the data in the Azure storage and is of great help when debugging and learning.</span></span>

> [!TIP]
> <span data-ttu-id="51fe1-134">Для тестирования в редакторе Unity можно использовать локальный эмулятор:</span><span class="sxs-lookup"><span data-stu-id="51fe1-134">For testing from inside the Unity editor you can use a local emulator:</span></span>
> * <span data-ttu-id="51fe1-135">в Windows 10 можно использовать [эмулятор хранения Azure](https://docs.microsoft.com/azure/storage/common/storage-use-emulator);</span><span class="sxs-lookup"><span data-stu-id="51fe1-135">on Windows 10 you can use [Azure Storage Emulator](https://docs.microsoft.com/azure/storage/common/storage-use-emulator)</span></span>
> * <span data-ttu-id="51fe1-136">в MacOS/Linux можно использовать [образ Azurite](https://hub.docker.com/_/microsoft-azure-storage-azurite) для Docker.</span><span class="sxs-lookup"><span data-stu-id="51fe1-136">on MacOS/Linux you can use [Azurite Docker Image](https://hub.docker.com/_/microsoft-azure-storage-azurite) for Docker</span></span>

## <a name="preparing-the-scene"></a><span data-ttu-id="51fe1-137">Подготовка сцены</span><span class="sxs-lookup"><span data-stu-id="51fe1-137">Preparing the scene</span></span>

<span data-ttu-id="51fe1-138">В окне Hierarchy (Иерархия) найдите и выберите объект **DataManager**.</span><span class="sxs-lookup"><span data-stu-id="51fe1-138">In the Hierarchy window, locate the **DataManager** object and select it.</span></span>

![Unity с полями конфигурации компонента скрипта DataManager, отображаемыми в инспекторе](images/mr-learning-azure/tutorial2-section4-step1-1.png)

<span data-ttu-id="51fe1-140">В окне Inspector (Инспектор) вы увидите, что в компоненте **DataManager (script)** (DataManager — скрипт) хранятся все параметры **службы хранилища Azure**.</span><span class="sxs-lookup"><span data-stu-id="51fe1-140">From the Inspector window you will see that the **DataManager (script)** component is where all **Azure storage** related settings are kept.</span></span> <span data-ttu-id="51fe1-141">Все соответствующие параметры уже заданы, нужно просто заменить значение в поле *Connection String* (Строка подключения) на то, которое можно получить на портале Azure.</span><span class="sxs-lookup"><span data-stu-id="51fe1-141">All relevant settings are already set, you just need to replace the *Connection String* field with the one you can retrieve from the Azure Portal.</span></span> <span data-ttu-id="51fe1-142">Если вы используете локальное решение эмулятора хранения Azure, вы можете сохранить уже предоставленное значение для параметра *Connection String* (Строка подключения).</span><span class="sxs-lookup"><span data-stu-id="51fe1-142">If you are using a local Azure storage emulator solution, then you can keep the already provided *Connection String*.</span></span>

<span data-ttu-id="51fe1-143">Компонент **DataManager (script)** (DataManager — скрипт) отвечает за взаимодействие с **Хранилищем таблиц** и **Хранилищем BLOB-объектов**, которые используются другими скриптами контроллера в компонентах пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="51fe1-143">The **DataManager (script)** is responsible for talking to the **Table storage** and **Blob storage** which is consumed by other controller scripts on the UI components.</span></span>

## <a name="writing-and-reading-data-from-azure-table-storage"></a><span data-ttu-id="51fe1-144">Запись и чтение данных из Хранилища таблиц Azure</span><span class="sxs-lookup"><span data-stu-id="51fe1-144">Writing and reading data from Azure Table storage</span></span>

<span data-ttu-id="51fe1-145">Все подготовлено, пора создать *отслеживаемый объект*.</span><span class="sxs-lookup"><span data-stu-id="51fe1-145">With everything prepared it's time to create a *Tracked Object*.</span></span>

<span data-ttu-id="51fe1-146">Откройте приложение на устройстве HoloLens, щелкните **Set Object** (Настроить объект), вы увидите, как объект *EnterObjectName* станет активным в иерархии.</span><span class="sxs-lookup"><span data-stu-id="51fe1-146">Open the application on your HoloLens, click on the **Set Object** and you will see how the *EnterObjectName* object will become active in the hierarchy.</span></span> <span data-ttu-id="51fe1-147">В этом меню щелкните *панель поиска* и введите имя, которое вы хотите дать *отслеживаемому объекту*.</span><span class="sxs-lookup"><span data-stu-id="51fe1-147">In this menu click on the *search bar* and type in the name you want to give the *Tracked Object*.</span></span> <span data-ttu-id="51fe1-148">После указания имени нажмите кнопку **Set object** (Настроить объект).</span><span class="sxs-lookup"><span data-stu-id="51fe1-148">After providing a name click on the **Set object** button.</span></span> <span data-ttu-id="51fe1-149">При этом будет создан *отслеживаемый объект* в Хранилище таблиц Azure, и вы увидите **карту объекта**.</span><span class="sxs-lookup"><span data-stu-id="51fe1-149">This will create the *Tracked Object* on the Azure Table storage and you will see now the **Object Card**.</span></span>

<span data-ttu-id="51fe1-150">Эта **карта объекта** является представлением пользовательского интерфейса *отслеживаемого объекта* и будет играть важную роль в этой серии учебников.</span><span class="sxs-lookup"><span data-stu-id="51fe1-150">This **Object Card** is a UI representation of the *Tracked Object* and will have an important role several times in this tutorial series.</span></span>

<span data-ttu-id="51fe1-151">Теперь щелкните *текстовое поле* описания и введите Car (Автомобиль), после этого нажмите кнопку **Save** (Сохранить), чтобы сохранить изменения.</span><span class="sxs-lookup"><span data-stu-id="51fe1-151">Now click on the description *text box* and type in "Car", after that click on the **Save** button to save the changes.</span></span> <span data-ttu-id="51fe1-152">Остановите работу приложения и запустите его повторно.</span><span class="sxs-lookup"><span data-stu-id="51fe1-152">Stop the application and rerun it.</span></span>

<span data-ttu-id="51fe1-153">Теперь щелкните **Search Object** (Поиск объекта) и введите на *панели поиска* имя, которое задавалось при создании *отслеживаемого объекта*.</span><span class="sxs-lookup"><span data-stu-id="51fe1-153">Now this time click on **Search Object** and type in the *search bar* the name you have used before when creating the *Tracked Object*.</span></span> <span data-ttu-id="51fe1-154">Вы увидите, что **карта объекта** со всеми данными извлекается из **Хранилища таблиц Azure**.</span><span class="sxs-lookup"><span data-stu-id="51fe1-154">You will see that the **Object Card** with all the data is retrieved from the **Azure Table storage**.</span></span>

<span data-ttu-id="51fe1-155">Вы можете закрывать **карту объекта**, создавать *отслеживаемые объекты* и изменять их данные.</span><span class="sxs-lookup"><span data-stu-id="51fe1-155">Feel free to close the **Object Card** and create new *Tracked Objects* and edit their data.</span></span>

> [!TIP]
> <span data-ttu-id="51fe1-156">Если вы установили [Обозреватель службы хранилища Azure](https://azure.microsoft.com/features/storage-explorer/), просмотрите таблицу *объектов*, и вы увидите там созданный *отслеживаемый объект*.</span><span class="sxs-lookup"><span data-stu-id="51fe1-156">If you have installed the [Azure Storage Explorer](https://azure.microsoft.com/features/storage-explorer/) then look into the *objects* table and you will see there the created *Tracked Object*.</span></span>

## <a name="uploading-and-download-image-from-azure-blob-storage"></a><span data-ttu-id="51fe1-157">Отправка и скачивание изображения из Хранилища BLOB-объектов Azure</span><span class="sxs-lookup"><span data-stu-id="51fe1-157">Uploading and Download image from Azure Blob storage</span></span>

<span data-ttu-id="51fe1-158">В этом разделе вы будете использовать Хранилище BLOB-объектов Azure для отправки и скачивания изображений, которые будут использоваться в качестве эскизов для *отслеживаемых объектов*.</span><span class="sxs-lookup"><span data-stu-id="51fe1-158">In this section you will use the Azure Blob storage to upload and download images that will be used as thumbnails for *Tracked Objects*.</span></span>

> [!NOTE]
> <span data-ttu-id="51fe1-159">В этом учебнике приложение будет делать фотографии для отправки изображений в Хранилище BLOB-объектов.</span><span class="sxs-lookup"><span data-stu-id="51fe1-159">In this tutorial the application will take photos to upload images to the Blob storage.</span></span> <span data-ttu-id="51fe1-160">Если вы запускаете его локально из редактора Unity, убедитесь в наличии подключенной к компьютеру веб-камеры.</span><span class="sxs-lookup"><span data-stu-id="51fe1-160">If you are running this locally from the Unity editor, then make sure that you have a webcam connected to your computer.</span></span>

<span data-ttu-id="51fe1-161">Откройте приложение на устройстве HoloLens, щелкните **Set Object** (Настроить объект) и введите на *панели поиска* Car (Автомобиль).</span><span class="sxs-lookup"><span data-stu-id="51fe1-161">Open the application on your HoloLens, click on **Set Object** and type in the *search bar* the name "Car".</span></span> <span data-ttu-id="51fe1-162">Теперь вы увидите **карту объекта**, нажмите кнопку **Camera** (Камера), и вам будет предложено выполнить жест касания для фотосъемки.</span><span class="sxs-lookup"><span data-stu-id="51fe1-162">Now you should see the **Object Card**, click on the **Camera** button and you will be instructed to do an AirTap to take a photo.</span></span> <span data-ttu-id="51fe1-163">После фотосъемки вы увидите сообщение об активной передаче, а через некоторое время там, где раньше был заполнитель, должно появиться изображение.</span><span class="sxs-lookup"><span data-stu-id="51fe1-163">After taking a photo you will see a message that informs you about the active upload and after a while the image should appear where the placeholder was before.</span></span>

<span data-ttu-id="51fe1-164">Теперь перезапустите приложение и найдите *отслеживаемый объект*, а ранее отправленное изображение должно появиться в виде эскиза.</span><span class="sxs-lookup"><span data-stu-id="51fe1-164">Now rerun the application and search for the *Tracked Object* and the previously uploaded image should appear as thumbnail.</span></span>

## <a name="deleting-image-from-azure-blob-storage"></a><span data-ttu-id="51fe1-165">Удаление изображения из Хранилища BLOB-объектов Azure</span><span class="sxs-lookup"><span data-stu-id="51fe1-165">Deleting image from Azure Blob storage</span></span>

<span data-ttu-id="51fe1-166">В предыдущем разделе вы передавали новые изображения в Хранилище BLOB-объектов Azure. В этом разделе вы удалите эскиз для *отслеживаемых объектов*.</span><span class="sxs-lookup"><span data-stu-id="51fe1-166">In the previous section you uploaded new images to Azure Blob storage, in this section you will delete an image thumbnail for *Tracked Objects*.</span></span>

<span data-ttu-id="51fe1-167">Откройте приложение на устройстве HoloLens, щелкните **Set Object** (Настроить объект) и введите на *панели поиска* Car (Автомобиль).</span><span class="sxs-lookup"><span data-stu-id="51fe1-167">Open the application on your HoloLens, click on **Set Object** and type in the *search bar* the name "Car".</span></span> <span data-ttu-id="51fe1-168">Теперь вы увидите **карту объекта** с эскизом, нажмите кнопку **Delete** (Удалить).</span><span class="sxs-lookup"><span data-stu-id="51fe1-168">Now you should see the **Object Card** with the thumbnail image, click on the **Delete** button.</span></span> <span data-ttu-id="51fe1-169">Вы увидите, что эскиз заменится изображением заполнителя.</span><span class="sxs-lookup"><span data-stu-id="51fe1-169">You will notice that the thumbnail image is replaced by the placeholder image.</span></span>

<span data-ttu-id="51fe1-170">Теперь перезапустите приложение и найдите *отслеживаемый объект* ранее удаленного эскиза, вы должны увидеть только изображение заполнителя.</span><span class="sxs-lookup"><span data-stu-id="51fe1-170">Now rerun the application and search for the *Tracked Object* of the previously deleted thumbnail, you should only see the placeholder image.</span></span>

## <a name="congratulations"></a><span data-ttu-id="51fe1-171">Поздравляем!</span><span class="sxs-lookup"><span data-stu-id="51fe1-171">Congratulations</span></span>

<span data-ttu-id="51fe1-172">Из этого учебника вы узнали, как с помощью службы хранилища Azure можно сохранять неструктурированные данные (например, в нашем случае **отслеживаемые объекты** и двоичные файлы) в виде эскизов для демонстрационного приложения **HoloLens 2** в облаке.</span><span class="sxs-lookup"><span data-stu-id="51fe1-172">In this tutorial you learned how Azure storage services can be used to persist unstructured data, like in our case **Tracked Objects** and binaries in form of thumbnail images for the **HoloLens 2** demo application on the cloud.</span></span>

<span data-ttu-id="51fe1-173">Из следующего учебника вы узнаете, как использовать Пользовательское визуальное распознавание Azure для обнаружения изображений, связанных с *отслеживаемым объектом*.</span><span class="sxs-lookup"><span data-stu-id="51fe1-173">In the next tutorial you will learn how to use Azure Custom Vision to detect images associated with a *Tracked Object*.</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="51fe1-174">Следующее руководство: 3. Интеграция Пользовательского визуального распознавания Azure</span><span class="sxs-lookup"><span data-stu-id="51fe1-174">Next tutorial: 3. Integrating Azure Custom Vision</span></span>](mr-learning-azure-03.md)
