---
title: Взаимодействие с трехмерными объектами
description: Из этого курса вы узнаете, как использовать Mixed Reality Toolkit (MRTK) для взаимодействия с трехмерными объектами и манипулирования ими в приложениях смешанной реальности.
author: jessemcculloch
ms.author: jemccull
ms.date: 02/05/2021
ms.topic: article
keywords: смешанная реальность, Unity, учебник, HoloLens, MRTK, Mixed Reality Toolkit, UWP, взаимодействие с объектами, ограничивающие элементы управления
ms.localizationpriority: high
ms.openlocfilehash: 1ab7b3a334639be564717d77d3bbc478a25e8326
ms.sourcegitcommit: ad1e0c6a31f938a93daa2735cece24d676384f3f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "102237245"
---
# <a name="7-interacting-with-3d-objects"></a>7. Взаимодействие с трехмерными объектами

В этом учебнике вы узнаете, как включить манипулирование дальними и ближними трехмерными объектами и ограничить допустимые типы манипуляций. Вы также узнаете, как добавлять ограничивающие элементы управления вокруг трехмерных объектов, чтобы упростить манипулирование этими объектами.

## <a name="objectives"></a>Задачи

* Узнайте, как настроить трехмерные объекты, чтобы с ними можно было взаимодействовать.
* Узнайте, как добавлять ограничивающие элементы управления к трехмерным объектам.

## <a name="manipulating-3d-objects"></a>Работа с трехмерными объектами

В этом разделе вы добавите возможность манипулирования всеми деталями лунохода, упорядоченными в таблице, во время работы с [учебником по размещению объектов в сцене](mr-learning-base-04.md).

Для получения этого результата вам нужно выполнить следующие шаги:

1. Добавить компонент Object Manipulator (Script) (Манипулятор объектами — скрипт) ко всем объектам деталей.
2. Добавить компонент NearInteractionGrabbable ко всем объектам деталей.
3. Настройте компонент Object Manipulator (Script) (Манипулятор объектами — скрипт).

> [!NOTE]
> Чтобы **объект поддерживал манипуляции**, он должен иметь следующие компоненты:
>
> * компонент **Collider** (Коллайдер), например Box Collider;
> * компонент **Object Manipulator (Script)** (Манипулятор объектами — скрипт).
>
> Чтобы **объект поддерживал манипуляции** и **захват отслеживаемыми руками**, он должен иметь следующие компоненты:
>
> * компонент **Collider** (Коллайдер), например Box Collider;
> * компонент **Object Manipulator (Script)** (Манипулятор объектами — скрипт);
> * компонент **NearInteractionGrabbable**.

Кроме того, необходимо настроить обозреватель лунохода, чтобы можно было разместить детали лунохода и выполнить его полноценную сборку.

В окне Hierarchy (Иерархия) разверните объект RoverExplorer > **RoverParts** и выберите все дочерние объекты деталей лунохода и **RoverAssembly**, затем в окне Inspector (Инспектор) нажмите кнопку **Add Component** (Добавить компонент), чтобы добавить следующие компоненты ко всем выбранным объектам:

* компонент **Object Manipulator (Script)** (Манипулятор объектами — скрипт);
* компонент **NearInteractionGrabbable**;
* компонент **Part Assembly Controller (Script)** (Элемент управления сборкой деталей — скрипт).

![Unity с выбранным объектом RoverAssembly и всеми частями лунохода и добавленными компонентами](images/mr-learning-base/base-07-section1-step1-1.png)

> [!TIP]
> Чтобы выбрать несколько объектов, которые не расположены рядом, нажмите и удерживайте клавишу CTRL и выберите любой объект с помощью кнопки мыши.

> [!NOTE]
> В нашем примере, когда добавляется компонент Object Manipulator (Script), автоматически добавляется и компонент Constraint Manager (Script), от которого тот зависит.

> [!NOTE]
> Для выполнения задач этого учебника к деталям лунохода уже добавлены коллайдеры. Чтобы получить дополнительные сведения о коллайдерах, воспользуйтесь <a href="https://docs.unity3d.com/Manual/CollidersOverview.html" target="_blank">этим разделом</a> из документации по Unity.

> [!NOTE]
> Элемент управления сборкой деталей (скрипт) не является частью МRТК, но включен в активы учебника.

Выбрав все объекты деталей лунохода и объект RoverAssembly, в окне Inspector (Инспектор) настройте компонент **Object Manipulator (Script)** (Манипулятор объектами — скрипт) следующим образом:

* В раскрывающемся списке **Two Handed Manipulation Type** (Тип манипуляции двумя руками), снимите флажок Scale (Масштаб), чтобы были выбраны только параметры **Move** (Перемещение) и **Rotate** (Поворот).

![Unity с настроенным типом манипуляции двумя руками](images/mr-learning-base/base-07-section1-step1-2.png)

> [!NOTE]
> На этом этапе вы включили манипулирование объектами для всех объектов деталей лунохода и объекта RoverAssembly.

В окне Project (Проект) перейдите к папке **Packages** > **Mixed Reality Toolkit Standard Assets** > **Audio**, где находятся аудиоклипы:

![Окно проекта Unity с выбранной папкой аудио](images/mr-learning-base/base-07-section1-step1-3.png)

В окне Hierarchy (Иерархия) выберите все **объекты деталей лунохода**, затем в окне Inspector (Инспектор) нажмите кнопку **Add Component** (Добавить компонент), чтобы добавить компонент **Audio Sources** (Источники аудио) и настроить его следующим образом:

* В поле **AudioClip** укажите аудиоклип **MRTK_Scale_Start**.
* Снимите флажок **Play On Awake** (Воспроизвести при загрузке).
* Для параметра **Spatial Blend** (Пространственное наложение) установите значение 1.

![Unity с выбранными всеми частями лунохода и добавленным и настроенным компонентом Audio Source](images/mr-learning-base/base-07-section1-step1-4.png)

В окне Hierarchy (Иерархия) разверните объект RoverAssembly > RoverModel_PlacementHints_XRay > **Parts_PlacementHints**, чтобы отобразить все объекты указания расположения, а затем выберите первую деталь лунохода, RoverParts > **Camera_Part** и настройте компонент **Part Assembly Controller (Script)** (Элемент управления сборкой деталей — скрипт) следующим образом:

* В поле **Location To Place** (Расположение для размещения) укажите объект **Camera_PlacementHint**.

![Unity с настроенным компонентом Camera_Part PartAssemblyController](images/mr-learning-base/base-07-section1-step1-5.png)

**Повторите** это действие для каждого из оставшихся объектов деталей лунохода и объекта RoverAssembly, чтобы настроить компонент **Part Assembly Controller (Script)** (Элемент управления сборкой деталей — скрипт) следующим образом:

* Для **Generator_Part** в поле **Location To Place** (Расположение для размещения) укажите объект **Generator_PlacementHint**.
* Для **Lights_Part** в поле **Location To Place** (Расположение для размещения) укажите объект **Lights_PlacementHint**.
* Для **UHFAntenna_Part** в поле **Location To Place** (Расположение для размещения) укажите объект **UHFAntenna_PlacementHint**.
* Для **Spectrometer_Part** в поле **Location To Place** (Расположение для размещения) укажите объект **Spectrometer_PlacementHint**.
* Для **RoverAssembly** укажите сам объект, т. е. тот же объект **RoverAssembly** в поле **Location To Place** (Расположение для размещения).

В окне Hierarchy (Иерархия) выберите RoverExplorer > Buttons (Кнопки) > объект кнопки **Reset** (Сброс), затем в окне Inspector (Инспектор) настройте интерактивное событие **OnClick ()** следующим образом:

* В поле **None (Object)** (Отсутствует (объект)) укажите объект **RoverAssembly**.
* В раскрывающемся списке **No Function** (Функция отсутствует) выберите **PartAssemblyController** > **ResetPlacement ()** , чтобы задать эту функцию как действие, выполняемое при срабатывании события.

![Unity с настроенным событием Reset для объекта кнопки OnClick](images/mr-learning-base/base-07-section1-step1-6.png)

Теперь, войдя в игровой режим, вы сможете поместить детали на луноход в режиме ближнего или дальнего взаимодействия. Когда деталь будет близка к соответствующей подсказке о размещении, она автоматически закрепится в нужном месте и станет деталью лунохода. Чтобы сбросить параметры размещения, нажмите кнопку Reset (Сброс):

![Разделенное представление Unity в режиме воспроизведения с нажатой кнопкой Reset](images/mr-learning-base/base-07-section1-step1-7.png)

Дополнительные сведения о компоненте Object Manipulator (Манипулятор объектами) и его свойствах вы можете получить в [этом учебнике](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/README_ObjectManipulator.html) на [портале документации по MRTK](https://docs.microsoft.com/windows/mixed-reality/mrtk-docs/).

## <a name="adding-bounds-control"></a>Добавление ограничивающего элемента управления

Ограничивающие элементы управления делают манипулирование объектами одной рукой более простым и интуитивно понятным при ближнем и дальнем взаимодействии, предоставляя маркеры для масштабирования и вращения.

В нашем примере вы добавите ограничивающий элемент управления в объект RoverExplorer, чтобы легко перемещать, вращать и масштабировать любые элементы среды. Кроме того, вы добавите в меню возможность включать и отключать ограничивающий элемент управления.

В окне Hierarchy (Иерархия) выберите объект **RoverExplorer**, а затем в окне Inspector (Инспектор) нажмите кнопку **Add Component** (Добавить компонент), чтобы добавить следующие компоненты:

* компонент **BoundsControl**;
* компонент **Object Manipulator (Script)** (Манипулятор объектами — скрипт).

Затем **снимите флажки** рядом со всеми компонентами, чтобы они были **отключены** по умолчанию:

![Unity с выбранным объектом RoverExplorer и добавленными и отключенными компонентами](images/mr-learning-base/base-07-section2-step1-1.png)

> [!NOTE]
> Визуализация ограничивающего элемента управления создается только во время выполнения, поэтому вы не увидите его до переключения в игровой режим.

> [!NOTE]
>Компонент Object Manipulator (Script) автоматически добавляет компонент Constraint Manager (Script)

В окне Hierarchy (Иерархия) разверните в меню объект **ButtonCollection**, чтобы отобразить четыре кнопки и переименовать третью кнопку на **BoundsControl_Enable**. Затем в окне Inspector (Инспектор) настройте компонент **Button Config Helper (Script)** (Помощник настройки кнопки — скрипт) следующим образом:

* Установите для параметра **Main Label Text** (Текст основной метки) значение **Enable** (Включить).
* В поле **None (Object)** (Отсутствует (объект)) укажите объект **RoverExplorer**.
* В раскрывающемся списке **No Function** (Функция отсутствует) выберите **BoundsControl** > **bool Enabled** (Активация по логическому значению), чтобы обновлять это значение свойства при срабатывании события.
* Убедитесь, что флажок аргумента **установлен**.
* Щелкните небольшой значок **+** , чтобы добавить событие.
* В поле **None (Object)** (Отсутствует (объект)) укажите объект **RoverExplorer**.
* В раскрывающемся списке **No Function** (Функция отсутствует) выберите **ObjectManipulator** > **bool enabled** (Активация по логическому значению), чтобы обновлять это значение свойства при срабатывании события.
* Убедитесь, что флажок аргумента **установлен**.
* В области **Icon** (Значок) сохраните значок куба без ограничивающего элемента управления.

![Unity с выбранным объектом кнопки BoundsControl_Enable и настроенным компонентом Button Config Helper](images/mr-learning-base/base-07-section2-step1-2.png)

Переименуйте четвертую и последнюю кнопку на **BoundsControl_Disable**, затем в окне Inspector (Инспектор) настройте компонент **Button Config Helper (Script)** (Помощник настройки кнопки — скрипт) следующим образом:

* Установите для параметра **Main Label Text** (Текст основной метки) значение **Disable** (Отключить).
* В поле **None (Object)** (Отсутствует (объект)) укажите объект **RoverExplorer**.
* В раскрывающемся списке **No Function** (Функция отсутствует) выберите **BoundsControl** > **bool Enabled** (Активация по логическому значению), чтобы обновлять это значение свойства при срабатывании события.
* Убедитесь, что флажок аргумента **снят**.
* Щелкните небольшой значок **+** , чтобы добавить событие.
* В поле **None (Object)** (Отсутствует (объект)) укажите объект **RoverExplorer**.
* В раскрывающемся списке **No Function** (Функция отсутствует) выберите **ObjectManipulator** > **bool enabled** (Активация по логическому значению), чтобы обновлять это значение свойства при срабатывании события.
* Убедитесь, что флажок аргумента **снят**.
* В области **Icon** (Значок) выберите значок куба с ограничивающим элементом управления.

![Unity с выбранным объектом кнопки BoundsControl_Disable и настроенным компонентом Button Config Helper](images/mr-learning-base/base-07-section2-step1-3.png)

Теперь, переключившись в игровой режим и включив ограничивающий элемент управления нажатием кнопки Enable (Включить), вы можете использовать режим ближнего или дальнего взаимодействия для перемещения, вращения и масштабирования ограничивающего элемента управления. Чтобы повторно отключить ограничивающий элемент управления, нажмите кнопку Disable (Отключить):

![Разделенное представление Unity в режиме воспроизведения с изменением ограничивающего элемента управления](images/mr-learning-base/base-07-section2-step1-4.png)

Дополнительные сведения о компоненте BoundsControl и его свойствах см. в [этом руководстве](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/README_BoundsControl.html) на [портале документации по MRTK](https://docs.microsoft.com/windows/mixed-reality/mrtk-docs/).

## <a name="congratulations"></a>Поздравляем!

В этом учебнике вы узнали, как включить манипулирование дальними и ближними трехмерными объектами и ограничить допустимые типы манипуляций. Вы также узнали, как добавлять ограничивающие элементы управления вокруг трехмерных объектов, чтобы упростить манипулирование этими объектами.

> [!div class="nextstepaction"]
> [Следующее руководство: 8. Использование отслеживания взгляда](mr-learning-base-08.md)
