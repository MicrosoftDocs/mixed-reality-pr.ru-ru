---
title: Интеграция Пользовательского визуального распознавания Azure
description: Пройдите этот курс, и вы узнаете, как реализовать Пользовательское визуальное распознавание Azure в приложении смешанной реальности HoloLens 2.
author: jessemcculloch
ms.author: jemccull
ms.date: 02/05/2021
ms.topic: article
keywords: смешанная реальность, Unity, учебник, HoloLens, HoloLens 2, Пользовательское визуальное распознавание Azure, Azure Cognitive Services, облачные службы Azure, Windows 10
ms.localizationpriority: high
ms.openlocfilehash: cb391aa2cdb7944234cdeede7dd05825c008d0d8
ms.sourcegitcommit: 59c91f8c70d1ad30995fba6cf862615e25e78d10
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "99590576"
---
# <a name="3-integrating-azure-custom-vision"></a>3. Интеграция Пользовательского визуального распознавания Azure

В этом руководстве показано, как использовать **Пользовательское визуальное распознавание Azure**. Вы отправите набор фотографий, чтобы связать их с *отслеживаемым объектом*, передать их в службу **Пользовательское визуальное распознавание** и начать процесс обучения. Затем вы будете использовать службу для обнаружения *отслеживаемого объекта* путем записи фотографий из веб-канала веб-камеры.

## <a name="objectives"></a>Задачи

* Узнать о Пользовательском визуальном распознавании Azure.
* Узнать, как настроить сцену для работы с Пользовательским визуальным распознаванием в этом проекте.
* Узнать, как интегрировать передачу, обучение и обнаружение изображений.

## <a name="understanding-azure-custom-vision"></a>Общие сведения о Пользовательском визуальном распознавании Azure

**Пользовательское визуальное распознавание Azure** входит в семейство служб **Cognitive Services** и используется для обучения классификаторов изображений. Классификатор изображений — это служба ИИ, которая использует обученную модель для применения соответствующих тегов. Эта функция классификации будет использоваться нашим приложением для обнаружения *отслеживаемых объектов*.

См. сведения о [Пользовательском визуальном распознавании Azure](/azure/cognitive-services/custom-vision-service/home).

## <a name="preparing-azure-custom-vision"></a>Подготовка Пользовательского визуального распознавания Azure

Перед началом работы нужно создать проект пользовательского визуального распознавания, и самый быстрый способ сделать это — использовать веб-портал.

Следуйте инструкциям из этого [краткого руководства](/azure/cognitive-services/custom-vision-service/getting-started-build-a-classifier#choose-training-images), чтобы настроить учетную запись и проект (до раздела *Отправка и снабжение тегами изображений*).

> [!WARNING]
> Для обучения модели необходимо иметь минимум два тега и пять изображений на каждый тег. Для работы с этим приложением нужно создать хотя бы один тег с пятью изображениями, чтобы последующий процесс обучения не завершился сбоем.

## <a name="preparing-the-scene"></a>Подготовка сцены

В окне проекта перейдите в папку **Assets** > **MRTK.Tutorials.AzureCloudServices** > **Prefabs** > **Manager** (Активы > MRTK.Tutorials.AzureCloudServices > Заготовки > Диспетчер).

![Unity с окном проекта, в котором отображается путь к заготовке ObjectDetectionManager](images/mr-learning-azure/tutorial3-section4-step1-1.png)

После этого перетащите заготовку **ObjectDetectionManager** в иерархию сцены.

![Unity с полями конфигурации компонента скрипта ObjectDetectionManager, отображаемыми в инспекторе](images/mr-learning-azure/tutorial3-section4-step1-2.png)

В окне иерархии найдите и выберите объект **ObjectDetectionManager**.
Заготовка **ObjectDetectionManager** содержит компонент **ObjectDetectionManager (script)** (ObjectDetectionManager — скрипт). Как видно в окне Inspector (Инспектор), он зависит от параметров Azure и параметров в окне Project (Проект).

## <a name="retrieving-azure-api-resource-credentials"></a>Получение учетных данных ресурса API Azure

Необходимые учетные данные для параметров **ObjectDetectionManager (script)** (ObjectDetectionManager — скрипт) можно получить на портале Azure и портале пользовательского визуального распознавания.

### <a name="retrieving-azure-settings-credentials"></a>Получение учетных данных для параметров Azure

Найдите ресурс пользовательского визуального распознавания типа **Cognitive Services**, созданный при работе с разделом *Подготовка сцены* этого учебника (выберите имя ресурса пользовательского визуального распознавания с *-Prediction* в конце). Щелкните *Overview* (Общие сведения) или *Keys and Endpoint* (Ключи и конечная точка), чтобы получить необходимые учетные данные.

### <a name="retrieving-project-settings-credentials"></a>Получение учетных данных для параметров проекта

На панели мониторинга [пользовательского визуального распознавания](https://www.customvision.ai/projects) откройте созданный проект и щелкните значок шестеренки в правом верхнем углу страницы, чтобы открыть страницу параметров. В правой части раздела *Resources* (Ресурсы) вы найдете необходимые учетные данные.

Теперь, когда объект **ObjectDetectionManager (script)** (ObjectDetectionManager — скрипт) правильно настроен, найдите и выберите в иерархии сцены объект **SceneController**.

![Unity с полями конфигурации компонента скрипта SceneController, отображаемыми в инспекторе](images/mr-learning-azure/tutorial3-section4-step1-3.png)

Вы увидите, что поле *Object Detection Manager* (Диспетчер обнаружения объектов) в компоненте **SceneController** пустое. Перетащите **ObjectDetectionManager** из раздела иерархии в это поле и сохраните сцену.

![Unity с настроенным компонентом скрипта SceneController](images/mr-learning-azure/tutorial3-section4-step1-4.png)

## <a name="take-and-upload-images"></a>Получение и отправка изображений

Запустите сцену и щелкните **Set Object** (Настроить объект), а затем введите имя одного из **отслеживаемых объектов**, созданных в [предыдущем уроке](mr-learning-azure-02.md). Теперь нажмите кнопку **Computer Vision** (Компьютерное зрение) в нижней части **карты объекта**.

Откроется новое окно, где вам нужно взять шесть фотографий для обучения модели распознаванию изображений. Нажмите кнопку **Camera** (Камера) и выполните жест касания при просмотре объекта, который вы хотите отслеживать. Сделайте это шесть раз.

> [!TIP]
> Чтобы улучшить обучение модели, попробуйте использовать изображение с разными ракурсами и условиями освещения.

Получив достаточное количество изображений, нажмите кнопку **Train** (Обучить), чтобы начать процесс обучения модели в облаке. При активации процесса сначала будут отправлены все изображения, а затем начнется обучение. Это может занять около минуты. Сообщение в меню информирует о ходе выполнения. По завершении процесса работу приложения можно остановить.

> [!TIP]
> Объект **ObjectDetectionManager (script)** (ObjectDetectionManager — скрипт) напрямую отправляет изображения в службу Пользовательского визуального распознавания. В качестве альтернативы API пользовательского визуального распознавания принимает URL-адреса изображений. Вместо этого в качестве упражнения можно изменить объект **ObjectDetectionManager (script)** (ObjectDetectionManager — скрипт) для отправки изображений в Хранилище BLOB-объектов.

## <a name="detect-objects"></a>Обнаружение объектов

Перед обнаружением объектов необходимо изменить ключ API в разделе **ObjectDetectionManager (script)** в параметрах проекта, которому уже назначен ключ пользовательского визуального распознавания.

Найдите ресурс пользовательского визуального распознавания на портале Azure. Щелкните *Keys and Endpoint* (Ключи и конечная точка), чтобы получить ключ API и заменить старый ключ API в параметрах проекта.

Теперь можно применить обученную модель к тесту, запустить приложение, а затем в *главном меню* щелкнуть **Search Object** (Поиск объекта) и ввести имя **отслеживаемого объекта** в вопросе. Когда появится **карта объекта**, нажмите кнопку **Custom Vision** (Пользовательское визуальное распознавание). Объект **ObjectDetectionManager** начнет создавать изображения в фоновом режиме с камеры, а в меню будет отображаться ход выполнения. Наведите камеру на объект, который использовался для обучения модели, и вы увидите, что через некоторое время она определит его.

## <a name="congratulations"></a>Поздравляем!

В этом руководстве показано, как работать с Пользовательским визуальным распознаванием Azure для обучения изображений и использования службы классификации для обнаружения изображений, соответствующих связанному **отслеживаемому объекту**.

В следующем руководстве будет показано, как с помощью Пространственных привязок Azure связать *отслеживаемый объект* с расположением в физическом мире и как отобразить стрелку, которая позволит пользователю вернуться к связанному расположению отслеживаемого объекта.

> [!div class="nextstepaction"]
> [Следующее руководство: 4. Интеграция Пространственных привязок Azure](mr-learning-azure-04.md)