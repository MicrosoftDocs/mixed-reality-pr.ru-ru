---
title: Настройка намерения и распознавание естественного языка
description: Пройдите этот курс, чтобы узнать, как настроить распознавание намерений и естественного языка в приложениях смешанной реальности.
author: jessemcculloch
ms.author: jemccull
ms.date: 02/26/2019
ms.topic: article
keywords: смешанная реальность, Unity, учебник, HoloLens, MRTK, Mixed Reality Toolkit, UWP, Пространственные привязки Azure, распознавание речи, Windows 10, LUIS, портал LUIS, намерение, сущности, речевые фрагменты, понимание естественного языка
ms.localizationpriority: high
ms.openlocfilehash: 8d840855321de5d4e055b944783649c9d8028f9a
ms.sourcegitcommit: d3a3b4f13b3728cfdd4d43035c806c0791d3f2fe
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/20/2021
ms.locfileid: "98581476"
---
# <a name="4-setting-up-intent-and-natural-language-understanding"></a>4. Настройка намерения и распознавания естественного языка

В этом руководстве вы изучите распознавание намерений в службе "Речь" Azure. Распознавание намерения позволяет реализовать в приложениях речевые команды на основе искусственного интеллекта, благодаря которым пользователи смогут произносить неспециализированные речевые команды для успешной передачи своих намерений системе.

## <a name="objectives"></a>Задачи

* Узнайте, как настроить на портале LUIS намерения, сущности и речевые фрагменты.
* Узнайте, как реализовать в приложении распознавание намерений и понимание естественного языка.

## <a name="preparing-the-scene"></a>Подготовка сцены

В окне Hierarchy (Иерархия) выберите объект **Lunarcom**, а затем в окне Inspector (Инспектор) с помощью кнопки **Добавить компонент** добавьте компонент **Lunarcom Intent Recognizer (Script)** (Распознаватель намерений Lunarcom — скрипт) к объекту Lunarcom.

![mrlearning-speech](images/mrlearning-speech/tutorial4-section1-step1-1.png)

В окне проекта перейдите к папке **Assets** (Активы) > **MRTK.Tutorials.GettingStarted** > **Prefabs** (Заготовки) > **RocketLauncher**, перетащите заготовку **RocketLauncher_Complete** в окно Hierarchy (Иерархия) и поместите ее в приемлемое положение перед камерной, например так:

* для параметра преобразования **Position** (Положение) укажите значения X = 0, Y = 0,4, Z = 1;
* для параметра преобразования **Rotation** (Поворот) укажите значения X = 0, Y = 90, Z = 0.

![mrlearning-speech](images/mrlearning-speech/tutorial4-section1-step1-2.png)

В окне Hierarchy (Иерархия) снова выберите объект **Lunarcom**, затем разверните объект **RocketLauncher_Complete** > **Button** и назначьте каждый из дочерних объектов объекта **Button** в соответствующем поле **Lunar Launcher Buttons**:

![mrlearning-speech](images/mrlearning-speech/tutorial4-section1-step1-3.png)

## <a name="creating-the-azure-language-understanding-resource"></a>Создание ресурса распознавания речи в Azure

В этом разделе мы создадим ресурс прогнозирования Azure для приложения LUIS (Интеллектуальная служба распознавания речи), создание которого описывается в следующем разделе.

Войдите в <a href="https://portal.azure.com" target="_blank">Azure</a> и щелкните **Создать ресурс**. Теперь найдите и выберите **Распознавание речи**:

![mrlearning-speech](images/mrlearning-speech/tutorial4-section2-step1-1.png)

Нажмите кнопку **Создать**, чтобы создать экземпляр этой службы.

![mrlearning-speech](images/mrlearning-speech/tutorial4-section2-step1-2.png)

На странице "Создание" щелкните вариант **Прогнозирование** и введите следующие значения:

* Для параметра **Подписка** выберите **Бесплатная пробная версия**, если вы используете пробную версию подписки. Либо выберите любую другую из существующих подписок.
* В разделе **Группа ресурсов** щелкните ссылку **Создать**, введите подходящее имя, например *MRKT-Tutorials*, а затем щелкните **ОК**.

![mrlearning-speech](images/mrlearning-speech/tutorial4-section2-step1-3.png)

> [!NOTE]
> На момент написания этой статьи не нужно было создавать ресурс разработки, так как пробный ключ разработки автоматически создается в LUIS при создании службы LUIS, как описывается в следующем разделе.

> [!TIP]
> Если у вас есть другая подходящая группа ресурсов в учетной записи Azure, например, после выполнения инструкций из руководства по [Пространственным привязкам Azure](mr-learning-asa-01.md), можно использовать эту группу ресурсов вместо создания новой.

На странице "Создание" введите следующие значения:

* В поле **Имя** введите подходящее имя службы, например *MRTK-Tutorials-AzureSpeechServices*.
* В поле **Расположение прогноза** выберите расположение, ближайшее к физическому расположению пользователей приложения, например *(США) Западная часть США*.
* В поле **Ценовая категория прогнозирование** для работы с этим руководством выберите уровень **F0 (5 вызовов в секунду, 10 000 вызовов в месяц).**

![mrlearning-speech](images/mrlearning-speech/tutorial4-section2-step1-4.png)

Затем щелкните вкладку **Проверка и создание**, просмотрите сведения и нажмите кнопку **Создать** в нижней части страницы, чтобы создать ресурс и новую группу ресурсов, если вы выбрали такой вариант:

![mrlearning-speech](images/mrlearning-speech/tutorial4-section2-step1-5.png)

> [!NOTE]
> После нажатия кнопки "Создать" вам придется подождать, пока завершится создание службы, что может занять несколько минут.

Когда завершится создание ресурса, вы увидите сообщение **Развертывание выполнено**:

![mrlearning-speech](images/mrlearning-speech/tutorial4-section2-step1-6.png)

## <a name="creating-the-language-understanding-intelligent-service-luis"></a>Создание Интеллектуальной службы распознавания речи (LUIS)

В этом разделе описывается, как создать приложение LUIS, настроить и обучить в нем модель прогнозирования и подключить его к ресурсу прогнозирования Azure, который вы создали на предыдущем шаге.

В частности, вы создадите намерение, которое по речевому фрагменту пользователя о выполнении действия активирует событие Interactable.OnClick() для одной из трех красных кнопок сцены, в зависимости от того, какую из этих кнопок упоминает пользователь.

Например, если пользователь произносит **go ahead and launch the rocket** (поехали, запускай ракету), приложение прогнозирует, что **go ahead** (поехали) означает выполнение **действия**, и что **нужное** событие Interactable.OnClick() относится к кнопке **launch** (запуск).

Для получения этого результата вам нужно выполнить следующие шаги:

1. Создание приложения LUIS.
2. Создание намерений.
3. Создание примеров речевых фрагментов.
4. Создание сущностей.
5. Сопоставление сущностей и примеров речевых фрагментов.
6. Обучение, тестирование и публикация приложения.
7. Присвоение приложению ресурса прогнозирования Azure.

### <a name="1-create-a-luis-app"></a>1. Создание приложения LUIS

Используя ту же учетную запись, с которой вы создавали ресурс Azure в предыдущем разделе, войдите в службу <a href="https://www.luis.ai" target="_blank">LUIS</a>, выберите страну и подтвердите согласие с условиями использования. На следующем этапе в ответ на предложение **привязать учетную запись Azure** выберите вариант **Continue using your trial key** (Продолжить использование ключа пробной версии), чтобы использовать ресурс разработки Azure.

> [!NOTE]
> Если вы ранее регистрировались в LUIS и срок вашего ключа пробной версии уже истек, воспользуйтесь документацией [по переходу на использование ключа создания ресурса Azure](/azure/cognitive-services/luis/luis-migration-authoring), чтобы переместить ресурс разработки LUIS в Azure.

После входа щелкните **Новое приложение** и введите следующие значения во всплывающем окне **Создание нового приложения**:

* В поле **Имя** введите подходящее имя, например *MRTK Tutorials — AzureSpeechServices*.
* В поле **Язык и региональные параметры** выберите **Английский**.
* В поле **Описание** можно ввести описание (необязательно).
* В поле **Ресурс прогнозирования** выберите ресурс прогнозирования из раскрывающегося списка, который был создан на портале Azure.

Теперь нажмите кнопку **Готово**, чтобы создать приложение.

![mrlearning-speech](images/mrlearning-speech/tutorial4-section3-step1-1.png)

Когда создание приложения завершится, вы автоматически перейдете на страницу **Панель мониторинга** этого приложения.

![mrlearning-speech](images/mrlearning-speech/tutorial4-section3-step1-2.png)

### <a name="2-create-intents"></a>2. Создание намерений

На странице Dashboard (Панель мониторинга) откройте Build (Сборка) > App Assets (Активы приложения) > **Intents** (Намерения), затем щелкните **Create** (Создать) и введите следующие значения во всплывающем окне **Create new intent** (Создание нового намерения):

* В поле **Имя намерения** введите **PressButton**.

Теперь нажмите кнопку **Готово**, чтобы создать намерение.

![mrlearning-speech](images/mrlearning-speech/tutorial4-section3-step2-1.png)

> [!CAUTION]
> В рамках этого руководства проект Unity будет ссылаться на это намерение по имени, вот так: "PressButton". Следовательно, крайне важно присвоить намерению точно такое же имя.

Когда создание намерения завершится, вы автоматически перейдете на страницу этого намерения.

![mrlearning-speech](images/mrlearning-speech/tutorial4-section3-step2-2.png)

### <a name="3-create-example-utterances"></a>3. Создание примеров речевых фрагментов

Для намерения **PressButton** добавьте в список **Example utterance** (Примеры речевых фрагментов) следующие примеры речевых фрагментов:

* activate launch sequence
* show me a placement hint
* initiate the launch sequence
* press placement hints button
* give me a hint
* push the launch button
* i need a hint
* press the reset button
* time to reset the experience
* go ahead and launch the rocket

Когда вы завершите добавление примеров речевых фрагментов, страница намерения PressButton будет выглядеть примерно так:

![mrlearning-speech](images/mrlearning-speech/tutorial4-section3-step3-1.png)

> [!CAUTION]
> В рамках этого руководства в проекте Unity будут использоваться слова hint, hints, reset и launch. Следовательно, крайне важно правильно и точно внести эти слова в список.

### <a name="4-create-entities"></a>4. Создание сущностей

На странице намерения PressButton откройте Build (Сборка) > App Assets (Активы приложения) > **Entities** (Сущности), затем щелкните **Create** (Создать) и введите следующие значения во всплывающем окне **Create new entity** (Создание новой сущности):

* В поле **Имя сущности** введите **Action**.
* В поле **Entity type** (Тип сущности) выберите **Machine learned** (Машинное обучение)

Затем нажмите кнопку **Create** (Создать), чтобы создать новую сущность:

![mrlearning-speech](images/mrlearning-speech/tutorial4-section3-step4-1.png)

**Повторите** описанный выше шаг, чтобы создать еще одну сущность с именем **Target**. Теперь у вас будет две сущности с именами Action и Target:

![mrlearning-speech](images/mrlearning-speech/tutorial4-section3-step4-2.png)

> [!CAUTION]
> В рамках этого руководства проект Unity будет ссылаться на эти сущности по именам, вот так: Action и Target. Следовательно, крайне важно присвоить точно такие же имена.

### <a name="5-assign-entities-to-the-example-utterances"></a>5. Сопоставление сущностей и примеров речевых фрагментов

Со страницы "Сущности" вернитесь на страницу намерения **PressButton**.

На странице намерения PressButton щелкните слово **go**, а затем слово **ahead**, и выберите **Action (Простая)** из контекстного всплывающего меню, чтобы обозначить **go ahead** как значение сущности **Action**:

![mrlearning-speech](images/mrlearning-speech/tutorial4-section3-step5-1.png)

Теперь речевой фрагмент **go ahead** определен как значение сущности **Action**. Вы увидите значение сущности действия под фразой "Go ahead" (Вперед):

![mrlearning-speech](images/mrlearning-speech/tutorial4-section3-step5-2.png)

> [!NOTE]
> Красная черта под меткой на изображении выше обозначает, что это значение сущности еще не было спрогнозировано, этим вопросом мы займемся на этапе обучения модели, описанном в следующем разделе.

Теперь щелкните слово **launch** и выберите **Target (Простая)** из контекстного всплывающего меню, чтобы обозначить **launch** как значение сущности **Target**:

![mrlearning-speech](images/mrlearning-speech/tutorial4-section3-step5-3.png)

Теперь слово **launch** определено как значение для сущности **Target**. Вы увидите новое значение сущности Target под словом "launch" (Запуск):

![mrlearning-speech](images/mrlearning-speech/tutorial4-section3-step5-4.png)

Теперь для намерения PressButton пример речевого фрагмента "go ahead and launch the rocket" будет спрогнозирован следующим образом:

* Намерение: PressButton.
* Сущность Action: go ahead
* Сущность Target: launch

**Повторите** описанный выше процесс из двух шагов, чтобы присвоить метки сущностей Action и Target каждому примеру речевых фрагментов, обязательно добавив следующие слова в качестве сущностей **Target**:

* **hint** (обозначает кнопку HintsButton в проекте Unity);
* **hints** (обозначает кнопку HintsButton в проекте Unity);
* **reset** (обозначает кнопку ResetButton в проекте Unity);
* **launch** (обозначает кнопку LaunchButton в проекте Unity).

Когда вы завершите пометку примеров речевых фрагментов, страница намерения PressButton будет выглядеть примерно так:

![mrlearning-speech](images/mrlearning-speech/tutorial4-section3-step5-5.png)

### <a name="6-train-test-and-publish-the-app"></a>6. Обучение, тестирование и публикация приложения

Чтобы обучить приложение, щелкните кнопку **Обучить** и дождитесь завершения процесса обучения:

![mrlearning-speech](images/mrlearning-speech/tutorial4-section3-step6-1.png)

> [!NOTE]
> Как видно на изображении выше, красные линии под метками исчезли, а значит, все эти значения сущностей теперь прогнозируются. Также вы можете обратить внимание на значок состояния слева от кнопки "Обучение", который теперь сменил цвет с красного на зеленый.

Когда завершится процесс обучения, щелкните кнопку **Тест** и введите фразу **go ahead and launch the rocket**, а затем нажмите клавишу ВВОД:

![mrlearning-speech](images/mrlearning-speech/tutorial4-section3-step6-2.png)

Когда завершится обработка тестового речевого фрагмента, щелкните **Проверить** и оцените результат:

* Намерение: PressButton (с достоверностью 98,5 %)
* Сущность Action: go ahead
* Сущность Target: launch

![mrlearning-speech](images/mrlearning-speech/tutorial4-section3-step6-3.png)

Чтобы опубликовать приложение, нажмите кнопку **Опубликовать** справа вверху, затем во всплывающем окне **Choose your publishing slot and settings** (Выберите слот и параметры публикации) выберите пункт **Production** (Рабочий) и нажмите кнопку **Done** (Готово):

![mrlearning-speech](images/mrlearning-speech/tutorial4-section3-step6-4.png)

Дождитесь окончания процесса публикации.

![mrlearning-speech](images/mrlearning-speech/tutorial4-section3-step6-5.png)

Перейдите к странице Manage > Application Settings > **Azure Resources** (Управление > Параметры приложения > Ресурсы Azure), которая должна выглядеть примерно так:

![mrlearning-speech](images/mrlearning-speech/tutorial4-section3-step6-6.png)

## <a name="connecting-the-unity-project-to-the-luis-app"></a>Подключение проекта Unity к приложению LUIS

На странице "Управление" > "Параметры приложения" > **Ресурсы Azure** щелкните значок **копирования**, чтобы скопировать значение в поле **Пример запроса**:

![mrlearning-speech](images/mrlearning-speech/tutorial4-section4-step1-1.png)

Вернитесь в проект Unity, в окне Hierarchy (Иерархия) выберите объект **Lunarcom**, а затем в окне Inspector (Инспектор) найдите компонент **Lunarcom Intent Recognizer (Script)** (Распознаватель намерений Lunarcom — скрипт) и настройте его, как описано ниже.

* В поле **LUIS Endpoint** (Конечная точка LUIS) вставьте значение **примера запроса**, которое вы скопировали на предыдущем шаге:

![mrlearning-speech](images/mrlearning-speech/tutorial4-section4-step1-2.png)

## <a name="testing-and-improving-the-intent-recognition"></a>Тестирование и улучшение распознавания намерений

Чтобы применить распознавание намерений прямо в редакторе Unity, необходимо разрешить использовать диктовку на компьютере разработке. Чтобы проверить эту настройку, откройте **Параметры** Windows, выберите **Конфиденциальность** > **Речь** и убедитесь, что здесь включен параметр **Распознавание речи в сети**:

![mrlearning-speech](images/mrlearning-speech/tutorial4-section5-step1-1.png)

Теперь, войдя в игровой режим, вы сможете проверить распознавание намерений. Для начала нажмите кнопку ракеты. Если к вашему компьютеру подключен микрофон, при произнесении первого примера речевого фрагмента **go ahead and launch the rocket** объект LunarModule будет запущен в космос:

![mrlearning-speech](images/mrlearning-speech/tutorial4-section5-step1-2.png)

Проверьте все **примеры речевых фрагментов**, потом попробуйте **немного изменять эти примеры**, а также произнесите несколько **произвольных речевых фрагментов**.

Теперь вернитесь в <a href="https://www.luis.ai" target="_blank">LUIS</a> и откройте меню "Сборка" > "Improve app performance" (Повысить производительность приложения) > **Review endpoint utterances** (Проверить речевые фрагменты конечной точки), с помощью **переключателя** перейдите из представления сущностей в **представление токенов** и изучите полученные речевые фрагменты.

* В столбце **Utterance** (Речевой фрагмент) вы можете изменять и (или) удалять присвоенные метки, чтобы они лучше соответствовали вашим намерениям.
* В столбце **Aligned intent** (Сопоставленное намерение) убедитесь, что намерение выбрано правильно.
* В столбце **Добавить/Удалить** можно щелкнуть зеленую галочку, чтобы добавить новый речевой фрагмент, или красный крестик, чтобы удалить речевой фрагмент.

Завершив изучение речевых фрагментов в удобном для вас темпе, нажмите кнопку **Обучение**, чтобы повторно обучить модель, а затем кнопку **Опубликовать**, чтобы еще раз опубликовать обновленное приложение:

![mrlearning-speech](images/mrlearning-speech/tutorial4-section5-step1-3.png)

> [!NOTE]
> Если речевой фрагмент конечной точки не соответствует намерению PressButton и вы хотите, чтобы модель знала об отсутствии намерений в этом речевом фрагменте, измените значение сопоставленного намерения на "Нет".

**Повторите** этот процесс произвольное количество раз, которое вы сочтете разумным для улучшения модели приложения.

## <a name="congratulations"></a>Поздравляем!

Теперь в вашем проекте реализовано понимание речевых команд, что позволит приложению распознавать намерения пользователей даже без точного совпадения с сохраненной командой. Запустите приложение на устройстве и убедитесь, что все работает правильно.