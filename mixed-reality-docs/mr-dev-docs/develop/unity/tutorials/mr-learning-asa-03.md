---
title: Сохранение, получение и совместное использование Пространственных привязок Azure
description: Пройдите этот курс и узнайте, как сохранять, получать и совместно использовать Пространственные привязки Azure в приложении смешанной реальности.
author: jessemcculloch
ms.author: jemccull
ms.date: 07/01/2020
ms.topic: article
keywords: смешанная реальность, Unity, учебник, HoloLens, MRTK, Mixed Reality Toolkit, UWP, Пространственные привязки Azure, сеансы приложений
ms.localizationpriority: high
ms.openlocfilehash: 4bae36bfb24130fc7914563af07c09374162f3cb
ms.sourcegitcommit: d3a3b4f13b3728cfdd4d43035c806c0791d3f2fe
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/20/2021
ms.locfileid: "98582049"
---
# <a name="3-saving-retrieving-and-sharing-azure-spatial-anchors"></a><span data-ttu-id="79e95-104">3. Сохранение, получение и совместное использование Пространственных привязок Azure</span><span class="sxs-lookup"><span data-stu-id="79e95-104">3. Saving, retrieving, and sharing Azure Spatial Anchors</span></span>

<span data-ttu-id="79e95-105">В этом учебнике вы узнаете, как сохранять Пространственные привязки Azure между сеансами приложения, сохраняя идентификатор привязки в хранилище HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="79e95-105">In this tutorial, you will learn how to save Azure Spatial Anchors across multiple app sessions by saving the anchor ID to the HoloLens 2's storage.</span></span> <span data-ttu-id="79e95-106">Вы также узнаете, как передать этот идентификатор привязки другим устройствам для согласования привязок между несколькими устройствами.</span><span class="sxs-lookup"><span data-stu-id="79e95-106">You will also learn how to share this anchor ID to other devices for a multi-device anchor alignment.</span></span>

## <a name="objectives"></a><span data-ttu-id="79e95-107">Задачи</span><span class="sxs-lookup"><span data-stu-id="79e95-107">Objectives</span></span>

* <span data-ttu-id="79e95-108">Узнать, как обеспечить пространственное выравнивание в разных сеансах приложения.</span><span class="sxs-lookup"><span data-stu-id="79e95-108">Learn how to achieve spatial alignment across multiple app sessions.</span></span>
* <span data-ttu-id="79e95-109">Узнать, как обеспечить пространственное выравнивание на нескольких устройствах.</span><span class="sxs-lookup"><span data-stu-id="79e95-109">Learn how to achieve spatial alignment between multiple devices.</span></span>

## <a name="preparing-the-scene"></a><span data-ttu-id="79e95-110">Подготовка сцены</span><span class="sxs-lookup"><span data-stu-id="79e95-110">Preparing the scene</span></span>

<span data-ttu-id="79e95-111">В окне Hierarchy (Иерархия) разверните объект **ButtonParent**.</span><span class="sxs-lookup"><span data-stu-id="79e95-111">In the Hierarchy window, expand the **ButtonParent** object.</span></span> <span data-ttu-id="79e95-112">Выберите **последние четыре дочерних объекта кнопок**.</span><span class="sxs-lookup"><span data-stu-id="79e95-112">Select the **last four child button** objects.</span></span> <span data-ttu-id="79e95-113">В окне Inspector (Инспектор) **установите флажок** рядом с полем имени, чтобы все объекты стали активными.</span><span class="sxs-lookup"><span data-stu-id="79e95-113">In the Inspector window, **check** the checkbox next to the name field to make all the objects active.</span></span>

![Unity с выбранными и активными объектами кнопок, которые раньше были неактивны](images/mr-learning-asa/asa-03-section1-step1-1.png)

<span data-ttu-id="79e95-115">В окне Hierarchy (Иерархия) выберите объекты **ButtonParent**.</span><span class="sxs-lookup"><span data-stu-id="79e95-115">In the Hierarchy window, select the **ButtonParent** objects.</span></span> <span data-ttu-id="79e95-116">Затем в окне Inspector (Инспектор) найдите компонент **GridObjectCollection** и нажмите кнопку **Update Collection** (Обновить коллекцию), чтобы обновить расположение всех дочерних объектов **ButtonParent**.</span><span class="sxs-lookup"><span data-stu-id="79e95-116">Then in the Inspector window, locate the **GridObjectCollection** component and click the **Update Collection** button to update the position of all the **ButtonParent** object's child objects.</span></span>

![Unity с обновленным компонентом GridObjectCollection](images/mr-learning-asa/asa-03-section1-step1-2.png)

## <a name="persisting-azure-spatial-anchors-between-app-sessions"></a><span data-ttu-id="79e95-118">Сохранение Пространственных привязок Azure между сеансами приложения</span><span class="sxs-lookup"><span data-stu-id="79e95-118">Persisting Azure Spatial Anchors between app sessions</span></span>

<span data-ttu-id="79e95-119">Из этого раздела вы узнаете, как сохранить идентификатор привязки Azure на локальном диске HoloLens и извлечь его с диска.</span><span class="sxs-lookup"><span data-stu-id="79e95-119">In this section, you will learn how to save and retrieve the Azure Anchor ID to and from the HoloLens' local disk.</span></span> <span data-ttu-id="79e95-120">Так вы сможете запрашивать в Azure один и тот же идентификатор привязки в разных сеансах приложения.</span><span class="sxs-lookup"><span data-stu-id="79e95-120">This will allow you to query Azure for the same anchor ID between different app sessions.</span></span> <span data-ttu-id="79e95-121">Это позволит вам разместить привязанные голограммы в том же расположении, что и в предыдущем сеансе приложения.</span><span class="sxs-lookup"><span data-stu-id="79e95-121">It will enable the anchored holograms to be positioned at the same location as in the previous app session.</span></span>

<span data-ttu-id="79e95-122">В окне "Иерархия" разверните объект **ButtonParent** и найдите две кнопки с именами **SaveAzureAnchorIdToDisk** и **GetAzureAnchorIdFromDisk**:</span><span class="sxs-lookup"><span data-stu-id="79e95-122">In the Hierarchy window, expand the **ButtonParent** object and locate the two buttons named **SaveAzureAnchorIdToDisk** and **GetAzureAnchorIdFromDisk**:</span></span>

![Unity с выбранными объектами кнопок SaveAzureAnchorIdToDisk и GetAzureAnchorIdFromDisk](images/mr-learning-asa/asa-03-section2-step1-1.png)

<span data-ttu-id="79e95-124">Выполните действия, которые описаны в инструкциях по [настройке кнопок для управления сценой](mr-learning-asa-02.md#configuring-the-buttons-to-operate-the-scene) из предыдущего руководства, чтобы настроить компонент **Interactable (Script)** (Доступный для взаимодействия — скрипт) для каждой из этих двух кнопок:</span><span class="sxs-lookup"><span data-stu-id="79e95-124">Follow the same steps as in the [configuring the buttons to operate the scene](mr-learning-asa-02.md#configuring-the-buttons-to-operate-the-scene) instructions from the previous tutorial to configure the **Interactable (Script)** component on each of the two buttons:</span></span>

* <span data-ttu-id="79e95-125">Для объекта кнопки **SaveAzureAnchorIdToDisk** назначьте функцию AnchorModuleScript > **SaveAzureAnchorIdToDisk ()** .</span><span class="sxs-lookup"><span data-stu-id="79e95-125">For the **SaveAzureAnchorIdToDisk** button object, assign the AnchorModuleScript > **SaveAzureAnchorIdToDisk ()** function.</span></span>
* <span data-ttu-id="79e95-126">Для объекта кнопки **GetAzureAnchorIdFromDisk** назначьте функцию AnchorModuleScript > **GetAzureAnchorIdFromDisk ()** .</span><span class="sxs-lookup"><span data-stu-id="79e95-126">For the **GetAzureAnchorIdFromDisk** button object, assign the AnchorModuleScript > **GetAzureAnchorIdFromDisk ()** function.</span></span>

<span data-ttu-id="79e95-127">После компиляции обновленного приложения в HoloLens вы сможете использовать одни и те же Пространственные привязки Azure в разных сеансах приложения, сохранив идентификаторы этих привязок.</span><span class="sxs-lookup"><span data-stu-id="79e95-127">If you build the updated app to your HoloLens, you can now persist Azure Spatial Anchors between app sessions by saving the Azure Anchor ID.</span></span> <span data-ttu-id="79e95-128">Чтобы проверить этот механизм, можно выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="79e95-128">To test it out, you can follow these steps:</span></span>

1. <span data-ttu-id="79e95-129">Переместите Rover Explorer в нужное расположение.</span><span class="sxs-lookup"><span data-stu-id="79e95-129">Move the Rover Explorer to the desired location</span></span>
2. <span data-ttu-id="79e95-130">Запустите сеанс Azure.</span><span class="sxs-lookup"><span data-stu-id="79e95-130">Start Azure Session</span></span>
3. <span data-ttu-id="79e95-131">Создайте привязку Azure (она создается в расположении, где размещается Rover Explorer).</span><span class="sxs-lookup"><span data-stu-id="79e95-131">Create Azure Anchor (creates anchors at the location of the Rover Explorer)</span></span>
4. <span data-ttu-id="79e95-132">Сохраните идентификатор привязки Azure на диск.</span><span class="sxs-lookup"><span data-stu-id="79e95-132">Save Azure Anchor ID to Disk</span></span>
5. <span data-ttu-id="79e95-133">Перезагрузите приложение.</span><span class="sxs-lookup"><span data-stu-id="79e95-133">Restart the app</span></span>
6. <span data-ttu-id="79e95-134">Получите с диска идентификатор привязки Azure (который вы только что сохранили).</span><span class="sxs-lookup"><span data-stu-id="79e95-134">Get Azure Anchor from Disk (loads the anchor ID you just saved)</span></span>
7. <span data-ttu-id="79e95-135">Запустите сеанс Azure.</span><span class="sxs-lookup"><span data-stu-id="79e95-135">Start Azure Session</span></span>
8. <span data-ttu-id="79e95-136">Найдите привязку Azure (она отвечает за размещение Rover Explorer в расположении, которое мы настроили на шаге 3).</span><span class="sxs-lookup"><span data-stu-id="79e95-136">Find Azure Anchor (positions the Rover Explorer at the location from step 3)</span></span>

> [!NOTE]
> <span data-ttu-id="79e95-137">Чтобы полностью перезапустить приложение после выхода из представления иммерсивного приложения, окно приложения в доме в смешанной реальности необходимо закрыть перед повторным запуском из меню "Пуск".</span><span class="sxs-lookup"><span data-stu-id="79e95-137">To fully restart the app, after exiting the immersive app view, the app window in the mixed reality home needs to be closed before relaunching it from the Start menu.</span></span> <span data-ttu-id="79e95-138">См. сведения об [использовании приложений в HoloLens](/hololens/holographic-home#using-apps-on-hololens).</span><span class="sxs-lookup"><span data-stu-id="79e95-138">For additional details, you can refer to the [Using apps on HoloLens](/hololens/holographic-home#using-apps-on-hololens) documentation.</span></span>

## <a name="sharing-azure-spatial-anchors-between-devices"></a><span data-ttu-id="79e95-139">Совместное использование Пространственных привязок Azure на разных устройствах</span><span class="sxs-lookup"><span data-stu-id="79e95-139">Sharing Azure Spatial Anchors between devices</span></span>

<span data-ttu-id="79e95-140">В этом разделе вы узнаете, как совместно использовать идентификатор привязки Azure на нескольких устройствах.</span><span class="sxs-lookup"><span data-stu-id="79e95-140">In this section, you will learn how to share the Azure Anchor ID between multiple devices.</span></span> <span data-ttu-id="79e95-141">Это позволяет нескольким устройствам обращаться в Azure по одному идентификатору привязки, то есть поддерживать пространственное выравнивание привязанных голограмм.</span><span class="sxs-lookup"><span data-stu-id="79e95-141">This will allow multiple devices to query Azure for the same anchor ID, allowing the anchored holograms to be spatially aligned.</span></span> <span data-ttu-id="79e95-142">Пространственное выравнивание, то есть размещение голограмм в одном физическом расположении на нескольких устройствах, является важнейшей частью совместного использования взаимодействий в среде HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="79e95-142">Spatial alignment, i.e., seeing the same holograms in the same physical location between multiple devices, is key to local shared experiences in the HoloLens 2.</span></span>

<span data-ttu-id="79e95-143">Есть много способов передавать идентификаторы привязок Azure между несколькими устройствами, часть из которых описана в серии [руководств по многопользовательским возможностям](mr-learning-sharing-02.md).</span><span class="sxs-lookup"><span data-stu-id="79e95-143">There are many ways to transfer Azure Anchor IDs between devices, including methods outlined in the [Multi-user capabilities tutorials](mr-learning-sharing-02.md) series.</span></span> <span data-ttu-id="79e95-144">В нашем примере применяется простая веб-служба для отправки и скачивания идентификаторов привязок с нескольких устройств.</span><span class="sxs-lookup"><span data-stu-id="79e95-144">In this example, you will use a simple web service to upload and download anchor IDs between devices.</span></span>

<span data-ttu-id="79e95-145">В окне Hierarchy (Иерархия) разверните объект **ButtonParent**.</span><span class="sxs-lookup"><span data-stu-id="79e95-145">In the Hierarchy window, expand the **ButtonParent** object.</span></span>   <span data-ttu-id="79e95-146">Найдите две кнопки с именами **ShareAzureAnchorIdToNetwork** и **GetAzureAnchorIdFromNetwork**.</span><span class="sxs-lookup"><span data-stu-id="79e95-146">Locate the two buttons named **ShareAzureAnchorIdToNetwork** and **GetAzureAnchorIdFromNetwork**:</span></span>

![Unity с выбранными объектами кнопок ShareAzureAnchorIdToNetwork и GetAzureAnchorIdFromNetwork](images/mr-learning-asa/asa-03-section3-step1-1.png)

<span data-ttu-id="79e95-148">Выполните действия, которые описаны в инструкциях по [настройке кнопок для управления сценой](mr-learning-asa-02.md#configuring-the-buttons-to-operate-the-scene) из предыдущего руководства, чтобы настроить компонент **Interactable (Script)** (Доступный для взаимодействия — скрипт) для каждой из этих двух кнопок:</span><span class="sxs-lookup"><span data-stu-id="79e95-148">Follow the same steps as in the [configuring the buttons to operate the scene](mr-learning-asa-02.md#configuring-the-buttons-to-operate-the-scene) instructions from the previous tutorial to configure the **Interactable (Script)** component on each of the two buttons:</span></span>

* <span data-ttu-id="79e95-149">Для объекта **ShareAzureAnchorIdToNetwork** назначьте функцию AnchorModuleScript > **ShareAzureAnchorIdToNetwork ()** .</span><span class="sxs-lookup"><span data-stu-id="79e95-149">For the **ShareAzureAnchorIdToNetwork** object, assign the AnchorModuleScript > **ShareAzureAnchorIdToNetwork ()** function.</span></span>
* <span data-ttu-id="79e95-150">Для объекта **GetAzureAnchorIdFromNetwork** назначьте функцию AnchorModuleScript > **GetAzureAnchorIdFromNetwork ()** .</span><span class="sxs-lookup"><span data-stu-id="79e95-150">For the **GetAzureAnchorIdFromNetwork** object, assign the AnchorModuleScript > **GetAzureAnchorIdFromNetwork ()** function.</span></span>

<span data-ttu-id="79e95-151">После компиляции обновленного приложения на двух устройствах HoloLens вы сможете поддерживать пространственное выравнивание, используя общий идентификатор привязки Azure.</span><span class="sxs-lookup"><span data-stu-id="79e95-151">If you build the updated app to two HoloLens devices, you can now achieve spatial alignment by sharing the Azure Anchor ID.</span></span> <span data-ttu-id="79e95-152">Чтобы проверить этот механизм, можно выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="79e95-152">To test it out, you can follow these steps:</span></span>

1. <span data-ttu-id="79e95-153">На устройстве HoloLens 1: Переместите Rover Explorer в нужное расположение.</span><span class="sxs-lookup"><span data-stu-id="79e95-153">On HoloLens device 1: Move the Rover Explorer to the desired location.</span></span>
2. <span data-ttu-id="79e95-154">На устройстве HoloLens 1: запустите сеанс Azure.</span><span class="sxs-lookup"><span data-stu-id="79e95-154">On HoloLens device 1: Start Azure Session.</span></span>
3. <span data-ttu-id="79e95-155">На устройстве HoloLens 1: Создайте привязку Azure (она создается в расположении, где размещается Rover Explorer).</span><span class="sxs-lookup"><span data-stu-id="79e95-155">On HoloLens device 1: Create Azure Anchor (creates anchors at the location of the Rover Explorer).</span></span>
4. <span data-ttu-id="79e95-156">На устройстве HoloLens 1: сохраните идентификатор привязки Azure в сетевое расположение.</span><span class="sxs-lookup"><span data-stu-id="79e95-156">On HoloLens device 1: Share Azure Anchor ID to Network.</span></span>
5. <span data-ttu-id="79e95-157">На устройстве HoloLens 2: Запустите приложение.</span><span class="sxs-lookup"><span data-stu-id="79e95-157">On HoloLens device 2: Start the app.</span></span>
6. <span data-ttu-id="79e95-158">На устройстве HoloLens 2: получите совместно используемый идентификатор привязки из сетевого расположения (тот же идентификатор привязки, который вы только что сохранили с устройства HoloLens 1).</span><span class="sxs-lookup"><span data-stu-id="79e95-158">On HoloLens device 2: Get Shared Anchor ID from Network (fetches the anchor ID just shared from HoloLens device 1).</span></span>
7. <span data-ttu-id="79e95-159">На устройстве HoloLens 2: запустите сеанс Azure.</span><span class="sxs-lookup"><span data-stu-id="79e95-159">On HoloLens device 2: Start Azure Session.</span></span>
8. <span data-ttu-id="79e95-160">На устройстве HoloLens 2: Найдите привязку Azure (она отвечает за размещение Rover Explorer в расположении, которое мы настроили в шаге 3).</span><span class="sxs-lookup"><span data-stu-id="79e95-160">On HoloLens device 2: Find Azure Anchor (positions the Rover Explorer at the location from step 3).</span></span>

> [!TIP]
> <span data-ttu-id="79e95-161">Если у вас только одно устройство HoloLens, для проверки механизма вы можете перезапускать приложение вместо перехода на второе устройство HoloLens.</span><span class="sxs-lookup"><span data-stu-id="79e95-161">If you only have one HoloLens, you can still test the functionality by restarting the app instead of using a second HoloLens device.</span></span>

## <a name="congratulations"></a><span data-ttu-id="79e95-162">Поздравляем!</span><span class="sxs-lookup"><span data-stu-id="79e95-162">Congratulations</span></span>

<span data-ttu-id="79e95-163">Из этого руководства вы узнали, как использовать Пространственные привязки Azure в разных сеансах приложения и между перезапусками приложения, сохранив идентификаторы таких привязок на локальном диске HoloLens.</span><span class="sxs-lookup"><span data-stu-id="79e95-163">In this tutorial, you learned how to persist Azure Spatial Anchors between app sessions and app restarts by saving the Azure Spatial Anchor ID to the local disk on HoloLens.</span></span> <span data-ttu-id="79e95-164">Вы также узнали, как совместно использовать Пространственные привязки Azure на нескольких устройствах, применяя базовый статический механизм совместного использования голограмм.</span><span class="sxs-lookup"><span data-stu-id="79e95-164">You also learned how to share Azure Spatial Anchors between multiple devices for a basic multi-user, static hologram shared experience.</span></span>

<span data-ttu-id="79e95-165">В следующем руководстве показано, как предоставлять пользователям обратную связь в реальном времени.</span><span class="sxs-lookup"><span data-stu-id="79e95-165">In the next tutorial, you will learn how to provide users with real-time feedback.</span></span> <span data-ttu-id="79e95-166">Эта обратная связь включает сведения о создании привязки, качестве среды и состоянии сеанса Azure.</span><span class="sxs-lookup"><span data-stu-id="79e95-166">This feedback will include information about Anchor creation, the quality of environment understanding, and the Azure session's state.</span></span> <span data-ttu-id="79e95-167">Без такой обратной связи пользователи не смогут узнать, успешно ли отправлена привязка в Azure, обладает ли среда достаточным качеством среды для создания привязки и в каком состоянии сейчас находится система.</span><span class="sxs-lookup"><span data-stu-id="79e95-167">Without feedback, users may not know whether an anchor has successfully been uploaded to Azure, whether the quality of the environment is sufficient for anchor creation, or the current state.</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="79e95-168">Следующее руководство: 4. Отображение отзывов по пространственным привязкам Azure</span><span class="sxs-lookup"><span data-stu-id="79e95-168">Next Tutorial: 4. Displaying Azure Spatial Anchor feedback</span></span>](mr-learning-asa-04.md)