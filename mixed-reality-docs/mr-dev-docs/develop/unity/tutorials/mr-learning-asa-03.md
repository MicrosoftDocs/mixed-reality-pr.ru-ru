---
title: Сохранение, получение и совместное использование Пространственных привязок Azure
description: Пройдите этот курс и узнайте, как сохранять, получать и совместно использовать Пространственные привязки Azure в приложении смешанной реальности.
author: jessemcculloch
ms.author: jemccull
ms.date: 02/05/2021
ms.topic: article
keywords: смешанная реальность, Unity, учебник, HoloLens, MRTK, Mixed Reality Toolkit, UWP, Пространственные привязки Azure, сеансы приложений
ms.localizationpriority: high
ms.openlocfilehash: 91f1139181a5a77123e003fc0c64d0661220a143
ms.sourcegitcommit: 59c91f8c70d1ad30995fba6cf862615e25e78d10
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "99590686"
---
# <a name="3-saving-retrieving-and-sharing-azure-spatial-anchors"></a>3. Сохранение, получение и совместное использование Пространственных привязок Azure

В этом учебнике вы узнаете, как сохранять Пространственные привязки Azure между сеансами приложения, сохраняя идентификатор привязки в хранилище HoloLens 2. Вы также узнаете, как передать этот идентификатор привязки другим устройствам для согласования привязок между несколькими устройствами.

## <a name="objectives"></a>Задачи

* Узнать, как обеспечить пространственное выравнивание в разных сеансах приложения.
* Узнать, как обеспечить пространственное выравнивание на нескольких устройствах.

## <a name="preparing-the-scene"></a>Подготовка сцены

В окне Hierarchy (Иерархия) разверните объект **ButtonParent**. Выберите **последние четыре дочерних объекта кнопок**. В окне Inspector (Инспектор) **установите флажок** рядом с полем имени, чтобы все объекты стали активными.

![Unity с выбранными и активными объектами кнопок, которые раньше были неактивны](images/mr-learning-asa/asa-03-section1-step1-1.png)

В окне Hierarchy (Иерархия) выберите объекты **ButtonParent**. Затем в окне Inspector (Инспектор) найдите компонент **GridObjectCollection** и нажмите кнопку **Update Collection** (Обновить коллекцию), чтобы обновить расположение всех дочерних объектов **ButtonParent**.

![Unity с обновленным компонентом GridObjectCollection](images/mr-learning-asa/asa-03-section1-step1-2.png)

## <a name="persisting-azure-spatial-anchors-between-app-sessions"></a>Сохранение Пространственных привязок Azure между сеансами приложения

Из этого раздела вы узнаете, как сохранить идентификатор привязки Azure на локальном диске HoloLens и извлечь его с диска. Так вы сможете запрашивать в Azure один и тот же идентификатор привязки в разных сеансах приложения. Это позволит вам разместить привязанные голограммы в том же расположении, что и в предыдущем сеансе приложения.

В окне "Иерархия" разверните объект **ButtonParent** и найдите две кнопки с именами **SaveAzureAnchorIdToDisk** и **GetAzureAnchorIdFromDisk**:

![Unity с выбранными объектами кнопок SaveAzureAnchorIdToDisk и GetAzureAnchorIdFromDisk](images/mr-learning-asa/asa-03-section2-step1-1.png)

Выполните действия, которые описаны в инструкциях по [настройке кнопок для управления сценой](mr-learning-asa-02.md#configuring-the-buttons-to-operate-the-scene) из предыдущего руководства, чтобы настроить компонент **Interactable (Script)** (Доступный для взаимодействия — скрипт) для каждой из этих двух кнопок:

* Для объекта кнопки **SaveAzureAnchorIdToDisk** назначьте функцию AnchorModuleScript > **SaveAzureAnchorIdToDisk ()** .
* Для объекта кнопки **GetAzureAnchorIdFromDisk** назначьте функцию AnchorModuleScript > **GetAzureAnchorIdFromDisk ()** .

После компиляции обновленного приложения в HoloLens вы сможете использовать одни и те же Пространственные привязки Azure в разных сеансах приложения, сохранив идентификаторы этих привязок. Чтобы проверить этот механизм, можно выполнить следующие действия.

1. Переместите Rover Explorer в нужное расположение.
2. Запустите сеанс Azure.
3. Создайте привязку Azure (она создается в расположении, где размещается Rover Explorer).
4. Сохраните идентификатор привязки Azure на диск.
5. Перезагрузите приложение.
6. Получите с диска идентификатор привязки Azure (который вы только что сохранили).
7. Запустите сеанс Azure.
8. Найдите привязку Azure (она отвечает за размещение Rover Explorer в расположении, которое мы настроили на шаге 3).

> [!NOTE]
> Чтобы полностью перезапустить приложение после выхода из представления иммерсивного приложения, окно приложения в доме в смешанной реальности необходимо закрыть перед повторным запуском из меню "Пуск". См. сведения об [использовании приложений в HoloLens](/hololens/holographic-home#using-apps-on-hololens).

## <a name="sharing-azure-spatial-anchors-between-devices"></a>Совместное использование Пространственных привязок Azure на разных устройствах

В этом разделе вы узнаете, как совместно использовать идентификатор привязки Azure на нескольких устройствах. Это позволяет нескольким устройствам обращаться в Azure по одному идентификатору привязки, то есть поддерживать пространственное выравнивание привязанных голограмм. Пространственное выравнивание, то есть размещение голограмм в одном физическом расположении на нескольких устройствах, является важнейшей частью совместного использования взаимодействий в среде HoloLens 2.

Есть много способов передавать идентификаторы привязок Azure между несколькими устройствами, часть из которых описана в серии [руководств по многопользовательским возможностям](mr-learning-sharing-02.md). В нашем примере применяется простая веб-служба для отправки и скачивания идентификаторов привязок с нескольких устройств.

В окне Hierarchy (Иерархия) разверните объект **ButtonParent**.   Найдите две кнопки с именами **ShareAzureAnchorIdToNetwork** и **GetAzureAnchorIdFromNetwork**.

![Unity с выбранными объектами кнопок ShareAzureAnchorIdToNetwork и GetAzureAnchorIdFromNetwork](images/mr-learning-asa/asa-03-section3-step1-1.png)

Выполните действия, которые описаны в инструкциях по [настройке кнопок для управления сценой](mr-learning-asa-02.md#configuring-the-buttons-to-operate-the-scene) из предыдущего руководства, чтобы настроить компонент **Interactable (Script)** (Доступный для взаимодействия — скрипт) для каждой из этих двух кнопок:

* Для объекта **ShareAzureAnchorIdToNetwork** назначьте функцию AnchorModuleScript > **ShareAzureAnchorIdToNetwork ()** .
* Для объекта **GetAzureAnchorIdFromNetwork** назначьте функцию AnchorModuleScript > **GetAzureAnchorIdFromNetwork ()** .

После компиляции обновленного приложения на двух устройствах HoloLens вы сможете поддерживать пространственное выравнивание, используя общий идентификатор привязки Azure. Чтобы проверить этот механизм, можно выполнить следующие действия.

1. На устройстве HoloLens 1: Переместите Rover Explorer в нужное расположение.
2. На устройстве HoloLens 1: запустите сеанс Azure.
3. На устройстве HoloLens 1: Создайте привязку Azure (она создается в расположении, где размещается Rover Explorer).
4. На устройстве HoloLens 1: сохраните идентификатор привязки Azure в сетевое расположение.
5. На устройстве HoloLens 2: Запустите приложение.
6. На устройстве HoloLens 2: получите совместно используемый идентификатор привязки из сетевого расположения (тот же идентификатор привязки, который вы только что сохранили с устройства HoloLens 1).
7. На устройстве HoloLens 2: запустите сеанс Azure.
8. На устройстве HoloLens 2: Найдите привязку Azure (она отвечает за размещение Rover Explorer в расположении, которое мы настроили в шаге 3).

> [!TIP]
> Если у вас только одно устройство HoloLens, для проверки механизма вы можете перезапускать приложение вместо перехода на второе устройство HoloLens.

## <a name="congratulations"></a>Поздравляем!

Из этого руководства вы узнали, как использовать Пространственные привязки Azure в разных сеансах приложения и между перезапусками приложения, сохранив идентификаторы таких привязок на локальном диске HoloLens. Вы также узнали, как совместно использовать Пространственные привязки Azure на нескольких устройствах, применяя базовый статический механизм совместного использования голограмм.

В следующем руководстве показано, как предоставлять пользователям обратную связь в реальном времени. Эта обратная связь включает сведения о создании привязки, качестве среды и состоянии сеанса Azure. Без такой обратной связи пользователи не смогут узнать, успешно ли отправлена привязка в Azure, обладает ли среда достаточным качеством среды для создания привязки и в каком состоянии сейчас находится система.

> [!div class="nextstepaction"]
> [Следующее руководство: 4. Отображение отзывов по пространственным привязкам Azure](mr-learning-asa-04.md)