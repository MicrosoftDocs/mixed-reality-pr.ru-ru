---
title: Запись смешанной реальности (DirectX)
description: Узнайте о некоторых способах выполнения смешанной записи реальности с помощью DirectX.
author: mattzmsft
ms.author: v-vtieto
ms.date: 09/28/2021
ms.topic: article
keywords: Нормативная бумага, Фото, видео, захват, Камера
ms.openlocfilehash: 0ba9345b06569253590e395607bcfd196cebc734
ms.sourcegitcommit: bea83261bf9ce7a27a618e5bc54dc4d7711f5435
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2021
ms.locfileid: "130157788"
---
# <a name="mixed-reality-capture-for-developers-directx"></a>Запись смешанной реальности для разработчиков (DirectX)

> [!NOTE]
> Дополнительные сведения о новой функции нормативных требований для HoloLens 2 см. в разделе [Render на камере ПС](#render-from-the-pv-camera-opt-in) ниже.

Прежде чем приступить к работе, мы рекомендуем ознакомиться со статьей [Обзор записи смешанной реальности](../advanced-concepts/mixed-reality-capture-overview.md) .

#### <a name="render-from-the-pv-camera-opt-in"></a>Подготовка к просмотру с помощью камеры ПС (согласие)

HoloLens 2 добавляет возможность визуализации иммерсивного приложения **с камеры пс** при выполнении записи смешанной реальности. Чтобы обеспечить правильную визуализацию приложения, приложение должно принять участие в этой функции.

Визуализация с камеры PV обеспечивает следующие улучшения по сравнению с НОРМАТИВным опытом по умолчанию:
* Выравнивание по голограммам для физической среды и взаимодействие практических действий должны быть точными на всех расстояниях. Избегайте смещения на расстоянии, отличном от точки фокусировки, как в случае с соблюдением требований по умолчанию.
* Правый глаз на гарнитуре не будет скомпрометирован, так как он не будет использоваться для визуализации голограмм для выходных данных нормативных требований.

Для подготовки к просмотру с помощью камеры PV необходимо выполнить три шага:
1. Включение Фотовидеокамера Холографиквиевконфигуратион
2. Обработка дополнительного Холографиккамера рендеринга
3. Проверьте, правильно ли отображаются шейдеры и код из этого дополнительного Холографиккамера

##### <a name="enable-the-photovideocamera-holographicviewconfiguration-in-directx"></a>Включение Фотовидеокамера Холографиквиевконфигуратион в DirectX

Чтобы принять участие в подготовке к просмотру с камеры ПС, приложение просто включает [Холографиквиевконфигуратион](/uwp/api/Windows.Graphics.Holographic.HolographicViewConfiguration)фотовидеокамера:
```csharp
var display = Windows.Graphics.Holographic.HolographicDisplay.GetDefault();
var view = display.TryGetViewConfiguration(Windows.Graphics.Holographic.HolographicViewConfigurationKind.PhotoVideoCamera);
if (view != null)
{
    view.IsEnabled = true;
}
```

##### <a name="handle-the-additional-holographiccamera-render-in-directx"></a>Обработка дополнительного рендеринга Холографиккамера в DirectX

Когда приложение получает согласие на подготовку к просмотру с камеры PV и начинается запись смешанной реальности:
1. Будет срабатывать событие Камерааддед Холографикспаце. Это событие может быть отложено, если приложение не может справиться с камерой в данный момент.
2. Когда событие завершится без необработанных РБП, Холографиккамера появится в списке следующего Холографикфраме Аддедкамерас.

При остановке записи смешанной реальности (или в случае, если приложение отключает конфигурацию представления при выполнении записи смешанной реальности), Холографиккамера будет отображаться в списке следующего Холографикфраме Ремоведкамерас и будет срабатывать событие Камераремовед Холографикспаце.

В Холографиккамера было добавлено свойство [виевконфигуратион](/uwp/api/windows.graphics.holographic.holographiccamera.viewconfiguration) , помогающее определить конфигурацию, к которой принадлежит камера.

##### <a name="verify-shaders-and-code-support-additional-cameras"></a>Проверка возможности поддержки шейдеров и кода дополнительных камер

Запустите запись смешанной реальности и проверьте необычное выравнивание, отсутствие содержимого или проблемы с производительностью. Обновите шейдеры и код соответствующим образом.

Если в некоторых сценах не поддерживается отрисовка на дополнительную камеру, можно отключить Холографиквиевконфигуратион Фотовидеокамера.

### <a name="disabling-mrc-in-your-app"></a>Отключение нормативных требований в приложении

#### <a name="2d-app"></a>2D-приложение

При выполнении записи смешанной реальности 2D-приложения могут закрывать свое визуальное содержимое:
* Присутствие с флагом [DXGI_PRESENT_RESTRICT_TO_OUTPUT](/windows/desktop/direct3ddxgi/dxgi-present)
* Создание цепочки подкачки приложения с помощью флага [DXGI_SWAP_CHAIN_FLAG_HW_PROTECTED](/windows/desktop/api/dxgi/ne-dxgi-dxgi_swap_chain_flag)
* с обновление Windows 10 за май 2019 г., установив [исскринкаптуринаблед](/uwp/api/windows.ui.viewmanagement.applicationview.isscreencaptureenabled) аппликатионвиев

#### <a name="immersive-app"></a>Иммерсивное приложение

В иммерсивное приложение может быть исключено из захвата смешанной реальности, чтобы исключить их визуальное содержимое:
* Настройка [Исконтентпротектионенаблед](/uwp/api/windows.graphics.holographic.holographiccamerarenderingparameters.iscontentprotectionenabled) холографиккамерарендерингпараметер для отключения захвата смешанной реальности для соответствующего кадра
* Настройка [Ишардвареконтентпротектионенаблед](/uwp/api/windows.graphics.holographic.holographiccamera.ishardwarecontentprotectionenabled) холографиккамера для отключения захвата смешанной реальности для связанной с ним камеры holographic

#### <a name="password-keyboard"></a>Клавиатура с паролем

при обновление Windows 10 за май 2019 г. визуальное содержимое автоматически исключается из записи смешанной реальности, когда отображается пароль или закрепление клавиатуры.

### <a name="knowing-when-mrc-is-active"></a>Знание того, когда активна НОРМАТИВная информация

Класс [аппкаптуре](/uwp/api/Windows.Media.Capture.AppCapture) может использоваться приложением для получения сведений о том, когда работает запись системы в смешанной реальности (для аудио или видео).

>[!NOTE]
>API [Жетфоркуррентвиев](/uwp/api/windows.media.capture.appcapture.getforcurrentview) аппкаптуре может вернуть значение null, если запись смешанной реальности недоступна на устройстве. Также важно отменить регистрацию события Каптурингчанжед, когда приложение приостанавливается, в противном случае НОРМАТИВное состояние может стать заблокированным.

## <a name="integrating-mrc-functionality-from-within-your-app"></a>Интеграция функций нормативных требований из приложения

Приложение "смешанная реальность" может начать захватывать фотографии или видео в приложении, а захваченное содержимое становится доступным для вашего приложения без сохранения в "рулоне камеры" устройства. Вы можете создать настраиваемый набор средств записи или воспользоваться встроенным ИНТЕРФЕЙСом для захвата камеры. 

### <a name="mrc-with-built-in-camera-ui"></a>НОРМАТИВ с помощью встроенного пользовательского интерфейса камеры

Разработчики могут использовать *[API пользовательского интерфейса для записи камеры](/windows/uwp/audio-video-camera/capture-photos-and-video-with-cameracaptureui)* , чтобы получить записанную пользователем фотографию или видео смешанной реальности с помощью всего нескольких строк кода.

Этот API запускает встроенный интерфейс для камеры с соблюдением требований, где пользователи могут взять фотографию или видео и возвратить полученную запись в приложение. Вы можете создать настраиваемый набор записей для записи смешанной реальности, если вам нужно добавить пользовательский интерфейс камеры или доступ на более низком уровне для записи потоков.

### <a name="creating-a-custom-mrc-recorder"></a>Создание пользовательского средства записи пользовательских нормативных требований

Хотя пользователь всегда может запускать фотографию или видео с помощью службы записи системных требований, приложение может захотеть создать пользовательское приложение для камеры, включающее голограммы в потоке камеры, как и в случае с соблюдением требований. Это позволяет приложению запускать записи из пользовательского ввода, создавать пользовательский пользовательский интерфейс записи или настраивать параметры пользователя, чтобы присвоить несколько примеров.

**HoloStudio добавляет пользовательскую камеру с особой назначением, используя эффекты нормативных требований**

![HoloStudio добавляет пользовательскую камеру с особой назначением, используя эффекты нормативных требований](images/cameraiconholostudio-300px.jpg)

другие приложения могут сделать это с помощью [api-интерфейсов Windowsного захвата носителей](/uwp/api/Windows.Media.Capture.MediaCapture) для управления камерой и добавления видео и звуковых эффектов с соблюдением требований к виртуальным голограммам, а также аудио и видео приложения.

У приложений есть два варианта добавления этого результата:
* Старый API: [Windows. Media. Capture. Медиакаптуре. Аддеффектасинк ()](/uwp/api/windows.media.capture.mediacapture.addeffectasync)
* Новый рекомендуемый API Майкрософт (Возвращает объект, что позволяет управлять динамическими свойствами): [Windows. Media. Capture. медиакаптуре. аддвидеоеффектасинк ()](/uwp/api/windows.media.capture.mediacapture.addvideoeffectasync)  /  [Windows. Media. Capture. Медиакаптуре. Аддаудиоеффектасинк ()](/uwp/api/windows.media.capture.mediacapture.addaudioeffectasync) , который требует, чтобы приложение создали собственную реализацию [Ивидеоеффектдефинитион](/uwp/api/Windows.Media.Effects.IVideoEffectDefinition) и [иаудиоеффектдефинитион](/uwp/api/windows.media.effects.iaudioeffectdefinition). Примеры см. в [примере приложения нормативных требований](https://github.com/microsoft/Windows-universal-samples/tree/master/Samples/HolographicMixedRealityCapture) .

>[!NOTE]
> Windows. Visual Studio не распознает пространство имен Media. микседреалитикаптуре, но строки остаются действительными.

Воздействие на видео с НОРМАТИВными действиями (**Windows. Media. Микседреалитикаптуре. Микседреалитикаптуревидеоеффект**)

|  Имя свойства  |  Type  |  Значение по умолчанию  |  Описание |
|----------|----------|----------|----------|
|  StreamType  |  UINT32 ([медиастреамтипе](/uwp/api/Windows.Media.Capture.MediaStreamType))  |  1 (Видеорекорд)  |  Опишите поток отслеживания, для которого используется этот результат. Звук недоступен. |
|  холограмкомпоситионенаблед  |  Логическое  |  true  |  Флаг для включения или отключения голограмм в видеозаписи. |
|  рекордингиндикаторенаблед  |  Логическое  |  true  |  Флаг для включения или отключения индикатора записи на экране во время записи голограммы. |
|  видеостабилизатионенаблед  |  Логическое  |  FALSE  |  флаг, позволяющий включать или отключать видео стабилизации с помощью средства записи HoloLens. |
|  видеостабилизатионбуфферленгс  |  ЗНАЧЕНИЕМ  |  0  |  Укажите, сколько кадров с предысторией используется для видео стабилизации. 0 — это 0-задержка и почти "бесплатная" с точки зрения мощности и производительности. 15 рекомендуется использовать для наивысшего качества (за счет 15 кадров задержки и памяти). |
|  глобалопаЦитикоеффиЦиент  |  FLOAT  |  0,9 (HoloLens) 1,0 (иммерсивное головной телефон)  |  Установите коэффициент глобальной прозрачности для голограммы в диапазоне от 0,0 (полностью прозрачный) до 1,0 (полностью непрозрачный). |
|  бланконпротектедконтент  |  Логическое  |  FALSE  |  Установите флаг, чтобы включить или отключить возврат пустого кадра, если имеется 2D-приложение UWP, показывающее защищенное содержимое. Если этот флаг имеет значение false, а двухмерная приложение UWP отображает защищенное содержимое, то 2D-приложение UWP будет заменено защищенной текстурой содержимого как на гарнитуре, так и в записи смешанной реальности. |
|  шовхидденмеш  |  Логическое  |  FALSE  |  Флаг для включения или отключения отображения скрытой сетки областей и соседнего содержимого камеры Holographic. |
| аутпутсизе | Размер | 0, 0 | Задайте желаемый размер выходных данных после кадрирования для видео стабилизации. Размер кадрирования по умолчанию выбирается, если задано значение 0 или указан недопустимый размер выходных данных. |
| преферредхолограмперспективе | ЗНАЧЕНИЕМ | **отображение параметров камеры** на портале устройств Windows | Перечисление, используемое для указания того, какую конфигурацию представления с помощью камеры holographic следует записать: 0 (дисплей) означает, что приложение не будет запрашивать отрисовку из фото-или видеокамеры, 1 (Фотовидеокамера) запросит приложение подготовиться к просмотру из фотографии или видеокамеры (если оно поддерживается приложением). Поддерживается только в HoloLens 2 |

>[!NOTE]
> вы можете изменить значение по умолчанию **преферредхолограмперспективе** на портале устройств Windows, перейдя на [страницу записи смешанной реальности](../advanced-concepts/using-the-windows-device-portal.md#mixed-reality-capture) и отменив **просмотр с камеры**. Значение по умолчанию равно **1 (фотовидеокамера)**, но его можно снять, чтобы задать для него значение **0 (экран)**.
>
> значение по умолчанию **преферредхолограмперспективе** было **0 (дисплей)** до обновления июня 2020 (Windows holographic, версия 2004, сборка 19041,1106 и Windows holographic, версия 1903 сборка 18362,1064).

НОРМАТИВный звуковой результат (**Windows. Media. Микседреалитикаптуре. Микседреалитикаптуреаудиоеффект**)

| Имя свойства | Type | Значение по умолчанию | Описание |
|----------|----------|----------|----------|
| миксермоде | ЗНАЧЕНИЕМ | 2 (MIC и системные аудио) | Перечисление, используемое для указания того, какие источники звука следует использовать: 0 (только MIC Audio), 1 (только для системных аудио), 2 (MIC и системные аудио) |
| лупбаккгаин | FLOAT | настройка **усиления звука приложения** на портале устройства Windows | Применить к системному звуковому тому. Диапазон от 0,0 до 5,0. Поддерживается только в HoloLens 2 |
| микрофонегаин | FLOAT | параметр " **усиление звука с микрофона** " на портале устройств Windows | Примените к тому, чтобы применить микрофон. Диапазон от 0,0 до 5,0. Поддерживается только в HoloLens 2 |

>[!NOTE]
> вы можете изменить значение по умолчанию **лупбаккгаин** или **микрофонегаин** на портале устройств Windows, перейдя на [страницу захвата смешанной реальности](../advanced-concepts/using-the-windows-device-portal.md#mixed-reality-capture) и настроив ползунок рядом с соответствующими параметрами. Оба параметра по умолчанию имеют значение **1,0**, но могут быть установлены для любого значения в диапазоне от **0,0** до **5,0**.
>
> использование Windows портала устройств для настройки значений усиления по умолчанию было добавлено с обновлением 2020 июня (Windows holographic, версия 2004 сборка 19041,1106 и Windows holographic, версия 1903 сборка 18362,1064).

### <a name="simultaneous-mrc-limitations"></a>Ограничения на одновременное соблюдение требований

Необходимо иметь в виду некоторые ограничения, когда несколько приложений обращаются к НОРМАТИВным данным в одно и то же время.

#### <a name="photovideo-camera-access"></a>Доступ к фото и видеокамере

в HoloLens 1, норматив не сможет записать фотографию или записать видео, пока процесс записывает видео или отправит фотографию. Обратная попытка также имеет значение true: Если норматив работает, приложение не сможет получить доступ к камере. 

с HoloLens 2 можно предоставить доступ к камере. Если вам не требуется прямой контроль над разрешением или частотой кадров, можно инициализировать Медиакаптуре, используя [свойство шаредмоде](/uwp/api/windows.media.capture.mediacaptureinitializationsettings.sharingmode) с шаредреадонли.  

##### <a name="built-in-mrc-photo-and-video-camera-access"></a>Встроенный доступ к фотографиям и видеокамере с соблюдением требований

функции, встроенные в Windows 10 (через Кортана, меню пуск, ярлыки оборудования, Miracast, Windows портал устройств):

* Будет выполняться с Ексклусивеконтрол по умолчанию

Однако поддержка была добавлена в подсистему требований к работе в общем режиме: 

* Если приложение запрашивает Ексклусивеконтрол доступ к фото-и видеокамере, встроенная НОРМАТИВная плата автоматически прекращает использовать фото и видеокамеру, поэтому запрос приложения будет выполнен. 
* Если сборка с соблюдением нормативных требований запущена, когда приложение имеет Ексклусивеконтрол, встроенное НОРМАТИВное выражение будет работать в режиме Шаредреадонли 

Эта функция общего режима имеет определенные ограничения.

* фото с помощью Кортана, аппаратных сочетаний клавиш или меню "пуск": требуется обновление Windows 10 апрель 2018 (или более поздней версии).
* видео с помощью Кортана, ярлыков оборудования или меню "пуск": требуется обновление Windows 10 апрель 2018 (или более поздней версии).
* потоковая передача требований для Miracast: требуется обновление Windows 10 за октябрь 2018 г. (или более поздней версии)
* потоковая передача требований для Windows портала устройств или через HoloLens вспомогательное приложение: требуется HoloLens 2

>[!NOTE]
> Разрешение и частота кадров встроенного пользовательского интерфейса камеры с нормой электрооборудования может уменьшиться от обычных значений, когда другое приложение использует фото-или видеокамеру.

#### <a name="mrc-access-for-developers"></a>НОРМАТИВный доступ для разработчиков

При использовании функции нормативных требований рекомендуется всегда запрашивать монопольный доступ к камере. Это обеспечит приложению полный контроль над параметрами камеры при условии, что вы знаете об ограничениях, перечисленных выше. 

* Создание объекта записи мультимедиа с помощью [параметров инициализации](/uwp/api/windows.media.capture.mediacaptureinitializationsettings)
* Установка свойства [шарингмоде](/uwp/api/windows.media.capture.mediacaptureinitializationsettings.sharingmode#Windows_Media_Capture_MediaCaptureInitializationSettings_SharingMode) в **монопольном режиме**

> [!CAUTION]
> Прежде чем продолжить, внимательно прочтите [Примечания шарингмоде](/uwp/api/windows.media.capture.mediacaptureinitializationsettings.sharingmode#remarks) .

* Настройка камеры в нужном виде
* Запустите приложение, запишите видеокадры с помощью API запуска, а затем включите НОРМАТИВную память.

> [!CAUTION]
> Если вы запускаете функцию нормативных требований перед запуском приложения, мы не можем гарантировать, что функция будет работать должным образом.

Полный пример описанного выше процесса можно найти в [образце отслеживания с помощью holographic лиц](/samples/microsoft/windows-universal-samples/holographicfacetracking).

> [!NOTE]
> до Windows 10 обновления от апреля 2018 пользовательский учетный записи пользователя в приложении был взаимоисключающим с соблюдением нормативных требований системы (запись фотографий, запись видео или потоковая передача с портала Windows устройств).

## <a name="see-also"></a>См. также раздел

* [Обзор записи смешанной реальности](../advanced-concepts/mixed-reality-capture-overview.md)
* [захват смешанной реальности для пользователей HoloLens](/hololens/holographic-photos-and-videos)
* [Зрительское представление](../../design/spectator-view.md)

