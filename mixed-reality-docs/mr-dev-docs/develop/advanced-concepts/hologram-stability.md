---
title: Стабильность голограммы
description: HoloLens автоматически иснимают голограммы, но существуют шаги, которые помогут разработчикам повысить стабильность.
author: thetuvix
ms.author: alexturn
ms.date: 07/08/2020
ms.topic: article
keywords: голограммы, стабильность, hololens, гарнитура смешанной реальности, гарнитура Windows Mixed Reality, гарнитура виртуальной реальности, частота кадров, подготовка к просмотру, репроектное разделение
appliesto:
- HoloLens
ms.openlocfilehash: a4a22221d3238bb7dfed711e6ee1f11edc70238e
ms.sourcegitcommit: bea83261bf9ce7a27a618e5bc54dc4d7711f5435
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2021
ms.locfileid: "130158367"
---
# <a name="hologram-stability"></a>Стабильность голограммы

для достижения стабильных голограмм HoloLens имеет встроенный конвейер image стабилизации. Конвейер стабилизации работает автоматически в фоновом режиме, поэтому для его включения не нужно предпринимать никаких дополнительных действий. Тем не менее следует использовать методы, повышающие устойчивость к голограммам, и избежать сценариев, снижающих стабильность.

## <a name="hologram-quality-terminology"></a>Терминология с голограммами

Качество голограмм является результатом хорошей среды и хорошей разработки приложений. приложения, работающие на постоянной 60 кадров (в секунду) в среде, где HoloLens могут контролировать окружающую среду, обеспечивают синхронизацию голограммы и соответствующей системы координат. С точки зрения пользователя голограммы, которые предназначены для стационарной работы, не перемещаются относительно среды.

Следующая терминология может помочь при выявлении проблем с средой, несоответствием или низкой частотой отрисовки или что-либо еще.
* **Правильно.** После того как голограмма заблокирована и помещается в реальный мир, она должна остаться в том месте, где она размещена, в окружающей среде, независимо от движения пользователя или небольших и разреженных изменений среды. Если позже в неожиданном месте появляется голограмма, это может привести к проблемам с *точностью* . Такие сценарии могут возникнуть, если две отдельные комнаты выглядят одинаковыми.
* **Синхронизации.** Пользователи наблюдают колебания в виде высокой частоты встряхиваний голограммы, что может произойти при отслеживании снижения среды. Для пользователей решение выполняет [настройку датчика](/hololens/hololens-updates).
* **Жуддер.** Низкие частоты отрисовки приводят к неравномерному перемещению и удвоенным изображениям голограмм. Жуддер особенно заметны в голограммах с движением. Разработчикам необходимо поддерживать [постоянную 60 кадров в кадре/](hologram-stability.md#frame-rate)с.
* **Настройке.** Пользователи видят сообщение о том, что появляется голограмма, которая исчезает из места первоначального размещения. Смещение происходит, когда вы размещаете голограммы на расстоянии от [пространственных привязок](../../design/spatial-anchors.md), особенно в несопоставленных частях среды. Создание голограмм, близких к пространственным привязкам, снижает вероятность смещения.
* **Переход.** Время от времени, когда «POP» или «переходит» из своего расположения. Перестановка может произойти, когда отслеживание корректирует голограммы так, чтобы они соответствовали обновленному пониманию среды.
* **Дорожки.** Когда в Sway отображается голограмма, соответствующая перемещению головного пользователя. дорожки происходит, когда приложение не полностью реализует [перепроекцию](hologram-stability.md#reprojection), и если HoloLens не [калибровка](/hololens/hololens-calibration) для текущего пользователя. Пользователь может повторно запустить приложение [калибровки](/hololens/hololens-calibration) , чтобы устранить проблему. Разработчики могут обновить плоскость стабилизации, чтобы улучшить стабильность.
* **Разделение цветов.** в HoloLens отображаются последовательное отображение цвета, в которых цветовые каналы flash красный-зеленый-синий-зеленый при 60 гц (отдельные поля цвета отображаются с частотой 240 гц). Каждый раз, когда пользователь отслеживает подвижную голограмму со своими глазами, ведущие и замыкающие края этой голограммы разделяются их составляющими цветами, что приводит к появлении эффектов «Радуга». Степень разделения зависит от скорости голограммы. В некоторых реже случаях перемещение головного элемента с легкостью при взгляде на стационарную голограмму также может привести к появлению эффектов «Радуга», который называется *[разделением цветов](hologram-stability.md#color-separation)*.

## <a name="frame-rate"></a>Частота кадров

Частота кадров — первый основополагающий уровень стабильности. Для того чтобы голограммы были стабильными в мире, каждое изображение, представленное пользователю, должно иметь голограммы, нарисованные в правильном месте. на экране отображается HoloLens обновление 240 раз в секунду, в котором показаны четыре отдельных поля цвета для каждого вновь визуализированного изображения, что приводит к пользовательскому взаимочастоте 60 кадров в секунду. Чтобы обеспечить наилучшую производительность, разработчики приложений должны поддерживать 60 кадров/с, что преобразуется для согласованного предоставления нового образа операционной системе каждые 16 миллисекунд.

**60 кадров/** с чтобы нарисовать голограммы так, как будто они находятся в реальной жизни, HoloLens необходимо визуализировать изображения из расположения пользователя. так как отрисовка изображений занимает некоторое время, HoloLens прогнозирует, где заголовком пользователя будет отображаться, когда изображения отображаются на экране. Однако этот алгоритм прогнозирования является приближением. HoloLens оборудовано оборудованием, которое корректирует подготовленный образ для учета расхождений между прогнозируемой позицией и фактической позицией в головном офисе. Эта корректировка делает изображение, которое видит пользователь, отображается так, как если бы оно было отображено из правильного расположения, а голограммы были стабильными. Обновления образа лучше подходят для небольших изменений и не могут полностью исправить определенные вещи в отображаемом образе, например Motion-фокусировки.

Выполняя отрисовку в 60 кадров/с, вы выполняете три вещи, которые помогут сделать стабильные голограммы:
1. Минимизация общей задержки между отрисовкой изображения и видимым пользователем изображением. В подсистеме и потоке отрисовки, работающей в локкстеп, выполнение в 30FPS может добавить 33,3 МС дополнительной задержки. Уменьшение задержки сокращает ошибку прогноза и повышает стабильность.
2. Это делает так, чтобы каждое изображение достигло глаза пользователя в непротиворечивом размере задержки. При отрисовке в течение 30 кадров/с на дисплее по-прежнему отображаются изображения с частотой 60 кадров/с, что означает, что одно и то же изображение будет показано дважды в строке. Второй кадр будет иметь 16,6 мс больше времени задержки, чем первый кадр, и потребуется исправить более произносится ошибка. Такая несогласованность при ошибке может привести к нежелательному жуддеру в 60 Гц.
3. Вы уменьшаете дрожание, характеризующееся неравномерным движением и двоением изображений. Чем быстрее перемещаются голограммы и чем ниже частота кадров отрисовки, тем заметнее дрожание. Ожидание поддержания в течение 60 кадров/с в любое время поможет избежать жуддер для данной подвижной голограммы.

**Согласованность с частотой кадров** Согласованность частоты кадров очень важна для большого количества кадров в секунду. иногда удаленные кадры неизбежны для любого приложения с большим количеством содержимого, а HoloLens реализует некоторые сложные алгоритмы для восстановления после случайных сбоев. Однако постоянно изменяющаяся частота кадров гораздо более заметна для пользователя, чем выполнение согласованных с низкой частотой кадров. Например, приложение, которое выглядит непрерывно для пяти кадров (60 кадров в секунду в течение этих пяти кадров), а затем удаляет все остальные кадры для следующих 10 кадров (30 кадров/с в течение этих 10 кадров) будет отображаться более стабильно, чем приложение, которое постоянно отображается в течение 30 кадров в секунду.

В связанной заметке операционная система регулирует приложения до 30 кадров в сек при выполнении [записи смешанной реальности](/hololens/holographic-photos-and-videos) .

**Анализ производительности** Существуют различные виды средств, которые можно использовать для оценки частоты кадров приложения, например:
* GPUView;
* отладчик графики Visual Studio;
* Профилировщики, встроенные в трехмерные механизмы, такие как Unity

## <a name="hologram-render-distances"></a>Расстояния, отображаемые на голограммах

>[!VIDEO https://www.youtube.com/embed/-606oZKLa_s]

Система человеческого визуального элемента интегрирует несколько сигналов, зависящих от расстояния, когда она фиксатес и фокусируется на объекте.
* [Проживание](https://en.wikipedia.org/wiki/Accommodation_%28eye%29) — Сосредоточьтесь на индивидуальном глазе.
* [Конвергенция](https://en.wikipedia.org/wiki/Convergence_(eye)) — два глаза перемещаются внутрь или наружу по центру объекта.
* [Представление с помощью бинокля](https://en.wikipedia.org/wiki/Stereopsis) — различия между изображениями левого и правого взгляда, которые зависят от расстояния объекта от точки с фиксацией.
* Заливка, относительный угловой размер и другие монокулар (один глаз).

Конвергенция и проживание являются уникальными, так как их сетчаткиные подсказки, связанные с изменением глаз для восприятия объектов на разных расстояниях. В естественном просмотре конвергенции и проживание связаны. Когда глаза просматривают нечто близкое (например, нос), глаза пересекается с ближайшим моментом. Когда глаза просматривают что-то в бесконечности, глаза становятся параллельными, а глаз — бесконечностью. 

пользователи, людьми HoloLens, всегда будут иметь 2,0 м для поддержания четкого изображения, так как отображаемые HoloLens фиксированы на оптическом расстоянии примерно 2,0 м от пользователя. Разработчики приложений контролируют, где соходят глаза пользователей, размещая содержимое и голограммы с различной глубиной. Когда пользователи разбиваются на разные расстояния, естественная связь между двумя подсказками нарушается, что может привести к визуальному дискомфорт или выносливости, особенно если размер конфликта велик. 

Дискомфорт из верженце-проживания можно избежать или свести к минимальному объему, сохранив согласованное содержимое как можно ближе к 2,0 м (т. е. в сцене с большим количеством важных областей около 2,0 м, если это возможно). Если содержимое не может размещаться почти в 2,0 м, дискомфорт от конфликта верженце-проживание значительно выше, когда пользователь Взгляните между различными расстояниями. Иными словами, гораздо комфортнее смотреть на неподвижную голограмму на расстоянии в 50 сантиметров, чем на такую же голограмму, которая постоянно приближается и удаляется.

Размещение содержимого на 2,0 м также выгодно, так как два дисплея предназначены для полного перекрытия на этом расстоянии. Для изображений, размещенных на этой плоскости, по мере того, как они выходят за пределы holographic, они будут отображаться с одного экрана, пока все еще будут видны на другом. Это может привести к нарушению глубины голограммы.

**Оптимальное расстояние от пользователя для размещения голограмм**

![Оптимальное расстояние от пользователя для размещения голограмм](images/distanceguiderendering-750px.png)

**Резкие плоскости** Для максимального удобства мы рекомендуем обрезать расстояние отрисовки в 85 cm с исчезновением содержимого, начиная с 1 МБ. В приложениях, где самые голограммы и пользователи являются стационарными, можно легко просмотреть голограммы, как в 50 cm. В таких случаях приложения должны полагаться на плоскость обрезки, не превышающую 30 см, и исчезать должна начаться не менее 10 см. Каждый раз, когда содержимое находится ближе, чем 85 cm, важно убедиться, что пользователи часто не перемещаются ближе или дальше от голограмм или что самые отдаленные области обычно не перемещаются ближе к пользователю или дальше от него. Содержимое должно быть спроектировано таким образом, чтобы не допустить необходимости взаимодействия более чем с 85 cm от пользователя, но если содержимое должно отрисовываться ближе, чем 85 cm, хорошим правилом для разработчиков является проектирование сценариев, в которых пользователи и (или) голограммы не перемещаются более чем на 25% времени.

**Рекомендации** Если не удается разместить голограммы на 2 м, а конфликты между конвергенцией и проживанием не могут быть устранены, оптимальная зона для размещения с голограммами составляет от 1,25 м до 5 м. В каждом случае разработчики должны структурировать содержимое, чтобы рекомендовать пользователям взаимодействовать с 1 + m (например, настроить размер содержимого и параметры размещения по умолчанию).

## <a name="reprojection"></a>Репроектное
в HoloLens есть сложная методика стабилизации с аппаратной поддержкой holographic, известная как репроектная. При перепроецировании учитывается движение и изменение точки зрения (Камерапосе) при анимации сцены, а пользователь перемещает свой заголовок.  Приложения должны выполнять определенные действия для наиболее эффективного использования РЕПРОЕКЦИИ.


Существует четыре основных типа РЕПРОЕКЦИИ.
* **Репроектная глубина:**  Обеспечивает лучшие результаты с наименьшим объемом усилий от приложения.  Все части визуализированной сцены изменяются независимо от их расстояния от пользователя.  Некоторые артефакты отрисовки могут быть видимыми, когда глубина глубины резко меняется.  этот параметр доступен только для HoloLens 2 и впечатляющих головных телефонов.
* **Плоское перепроецирование:**  Позволяет приложению точно управлять стабилизации.  Плоскость задается приложением, и все на этой плоскости будет самой стабильной частью сцены.  Чем выше голограмма, тем менее стабильной она будет.  этот параметр доступен на всех платформах Windows MR.
* **Автоматическое плоское перепроецирование:**  Система устанавливает плоскость стабилизации, используя сведения в буфере глубины.  этот параметр доступен в HoloLens поколение 1 и HoloLens 2.
* **Нет:** Если приложение ничего не делает, используется плоская репроектная шкала с стабилизации плоскостью, фиксированная на 2 метрах в направлении заголовка пользователя, обычно создающая подстандартные результаты.

Приложения должны предпринять определенные действия, чтобы включить различные типы РЕПРОЕКЦИИ
* **Репроектная глубина:** Приложение отправляет свой буфер глубины в систему для каждого отображаемого кадра.  в Unity переработка по глубине выполняется с параметром **общий буфер глубины** в области **Windows Mixed Reality Параметры** в разделе **управление подключаемым модулем XR**.  Приложения DirectX вызывают CommitDirect3D11DepthBuffer.  Приложение не должно вызывать Сетфокуспоинт.
* **Плоское перепроецирование:** В каждом кадре приложения сообщают системе, что расположение плоскости необходимо стабилизировать.  Приложения Unity вызывают Сетфокуспоинтфорфраме и должны отключить **общий буфер глубины** .  Приложения DirectX вызывают Сетфокуспоинт и не должны вызывать CommitDirect3D11DepthBuffer.
* **Автоматическое плоское перепроецирование:** Чтобы включить приложение, приложению необходимо отправить свой буфер глубины в систему, так как это приведет к перепроецированию в глубину. приложения, использующие набор средств смешанной реальности (мртк), могут настроить [поставщик параметров камеры](/windows/mixed-reality/mrtk-unity/features/camera-system/windows-mixed-reality-camera-settings#hololens-2-reprojection-method) для использования реплоской репроекции. Собственные приложения должны задавать `DepthReprojectionMode` в [холографиккамерарендерингпараметерс](/uwp/api/windows.graphics.holographic.holographiccamerarenderingparameters) для `AutoPlanar` каждого кадра. для HoloLens поколения 1 приложение не должно вызывать сетфокуспоинт.

### <a name="choosing-reprojection-technique"></a>Выбор метода РЕПРОЕКЦИИ

Тип стабилизации |    Иммерсивные гарнитуры |    поколение HoloLens 1 | HoloLens 2
--- | --- | --- | ---
Репроектная глубина |    Рекомендуется |   Недоступно |   Рекомендуется<br/><br/>Приложения Unity должны использовать Unity 2018.4.12 +, Unity 2019.3 + или Unity 2020.3 +. В противном случае используйте автоматическое плоское перепроецирование.
Автоматическое плоское перепроецирование | Недоступно |   Рекомендуется по умолчанию |   Рекомендуется, если репроектность глубины не дает наилучших результатов<br/><br/>Для приложений Unity рекомендуется использовать Unity 2018.4.12 +, Unity 2019.3 + или Unity 2020.3 +.  Предыдущие версии Unity будут работать с слегка сниженными результатами РЕПРОЕКЦИИ.
Плоское перепроецирование |   Не рекомендуется |   Рекомендуется, если автоматическая плоская не дает наилучших результатов | Используйте, если ни один из параметров глубины не дает нужных результатов    

### <a name="verifying-depth-is-set-correctly"></a>Проверка правильности задана глубина
            
Если в методе РЕПРОЕКЦИИ используется буфер глубины, важно убедиться, что содержимое буфера глубины представляет отображаемую сцену приложения.  Некоторые факторы могут вызвать проблемы. Например, если для отображения наложений пользовательского интерфейса используется другая камера, скорее всего, будет перезаписана вся информация о глубине из фактического представления.  Прозрачные объекты часто не задают глубину.  По умолчанию для отрисовки текста не задана глубина.  Если глубина не соответствует отображаемым голограммам, в отрисовке будут отображаться видимые сбои.
            
у HoloLens 2 есть визуализатор, который показывает, где глубина не задана и не устанавливается, что можно включить на портале устройств.  На вкладке   >  **нестабильная** визуализация представления установите флажок **Отображать отображаемую глубину в гарнитуре** .  Области, для которых правильно задана глубина, будут синими.  Отображаемые элементы, для которых не задана глубина глубины, отмечены красным цветом и должны быть исправлены.  

> [!NOTE]
> Визуализация глубины не будет отображаться в записи смешанной реальности.  Она видна только на устройстве.
            
Некоторые средства просмотра GPU позволяют визуализировать буфер глубины.  Разработчики приложений могут использовать эти средства, чтобы обеспечить правильную настройку глубины.  Обратитесь к документации по средствам приложения.

### <a name="using-planar-reprojection"></a>Использование плоской РЕПРОЕКЦИИ
> [!NOTE]
> Для настольных современных головных телефонов настройка плоскости стабилизации обычно является высокопроизводительной, так как она обеспечивает меньше визуального качества, чем предоставление в системе буфера глубины приложения для обеспечения РЕПРОЕКЦИИ на основе глубины в пикселях. если не выполняется в HoloLens, следует, как правило, избегать настройки плоскости стабилизации.

![Стабилизации плоскость для трехмерных объектов](images/stab-plane-500px.jpg)

Устройство будет автоматически пытаться выбрать эту плоскость, но приложение должно помочь, выбрав точку фокусировки в сцене. приложения Unity, выполняющиеся на HoloLens, должны выбрать наиболее подходящую точку на основе сцены и передать ее в [сетфокуспоинт ()](../unity/focus-point-in-unity.md). Пример настройки точки фокусировки в DirectX включен в шаблон куба по умолчанию.

Unity будет отправлять буфер глубины в Windows для включения репроекции на каждый пиксель при запуске приложения на иммерсивное головной гарнитуре, подключенной к настольному пк, что обеспечивает еще более высокое качество изображения без явной работы приложения. вы должны предоставить точку фокусировки только в том случае, если приложение выполняется на HoloLens или переопределение для каждого пикселя будет переопределено.


```cs
// SetFocusPoint informs the system about a specific point in your scene to
// prioritize for image stabilization. The focus point is set independently
// for each holographic camera.
// You should set the focus point near the content that the user is looking at.
// In this example, we put the focus point at the center of the sample hologram,
// since that is the only hologram available for the user to focus on.
// You can also set the relative velocity and facing of that content; the sample
// hologram is at a fixed point so we only need to indicate its position.
renderingParameters.SetFocusPoint(
    currentCoordinateSystem,
    spinningCubeRenderer.Position
    );
```

Размещение контрольной точки во многом зависит от того, на что смотрится голограмма. Приложение имеет вектор взгляда на ссылку, и конструктор приложений знает, какое содержимое он хочет отслеживать.

Самое важное, что разработчик может сделать, чтобы стабилизировать голограммы, — это визуализация в 60 кадров/с. Удаление ниже 60 кадров/с значительно снизит стабильность, чем стабилизации плоскость оптимизации.

**Рекомендации** Нет универсального способа настройки плоскости стабилизации, и она зависит от конкретного приложения. Наша основная рекомендация — эксперименты и Узнайте, что лучше подходит для вашего сценария. Однако попробуйте выстроить стабилизации плоскость с максимально возможной точностью содержимого, так как все содержимое этой плоскости полностью стабилизация.

Вот несколько примеров.
* Если у вас есть только плоское содержимое (приложение для чтения и воспроизведения видео), совместите плоскость стабилизации с плоскостью, в которой находится ваше содержимое.
* Если у вас есть три небольшие шарик, которые находятся в мире, сделайте стабилизации плоскость "вырезать", хотя центры всех шарик, которые в настоящее время находятся в представлении пользователя.
* Если содержимое сцены существенно отличается, лучше поработать с другими объектами.
* Не забудьте настроить стабилизации каждую рамку так, чтобы она совпадала с голограммой, которую пользователь просматривает

Что **следует избегать** Плоскость стабилизации — это отличный инструмент для достижения стабильных голограмм, но при его использовании может привести к нестабильной работе образа.
* Не срабатывают и не забывайте. Можно получить плоскость стабилизации, которая находится за пользователем или присоединена к объекту, который больше не находится в представлении пользователя. Убедитесь, что стабилизации плоскость "Обычная" установлен на противоположную камеру (например,-Camera. Forward).
* Не изменяйте стабилизации плоскость в обратном направлении между крайней скоростью
* Не оставляйте для плоскости стабилизации фиксированное расстояние или ориентацию.
* Не позволяйте стабилизации плоскость по пользователю
* не устанавливайте точку фокусировки при запуске на настольном пк, а не на HoloLens, а вместо этого используйте перестройку на основе глубины на уровне точек.

## <a name="color-separation"></a>Разделение цветов 

из-за особенностей отображения HoloLens может быть восприниматься артефакт, называемый «цветоделение». Он манифесты в виде изображения, отделенного отдельными базовыми цветами — красного, зеленого и синего. Артефакт может быть особенно видимым при отображении белых объектов, так как они имеют большой объем красного, зеленого и синего. Это наиболее произносится, когда пользователь визуально отслеживает голограмму, которая перемещается в holographic кадре с высокой скоростью. Другой способ, который может быть манифестом артефакта, — деформацию или деформировать объекты. Если объект имеет высокую контрастность и (или) чистые цвета, такие как красный, зеленый, синий, выделение цветом будет рассматриваться как деформацию различных частей объекта.

**Пример того, как пользователь поворачивает свою головку на сторону, может выглядеть так, как цветовая разделяться белым скругленным курсором с заголовком.**

![Пример того, как пользователь поворачивает свою головку на сторону, может выглядеть так, как цветовая разделяться белым скругленным курсором с заголовком.](images/colorseparationofroundwhitecursor-300px.png)

Несмотря на то, что трудно избежать разделения цветов, существует несколько способов их устранения.

**Цветоделение можно увидеть на:**
* Объекты, которые быстро перемещаются, включая объекты, заблокированные в голову, например [курсор](../../design/cursors.md).
* Объекты, которые значительно далеко от [плоскости стабилизации](hologram-stability.md#reprojection).

**Для ослабления эффекта разделения цветов:**
* Сделайте объект задержкой пользователя. Он должен выглядеть так, как если бы он был в некоторой инерции и был прикреплен к взгляду «по пружины». Такой подход замедлит работу курсора (уменьшая расстояние разделения) и помещает его за наиболее вероятную точку зрения пользователя. Пока он быстро перехватывается, когда пользователь останавливает сдвиг своего взгляда, он кажется естественным.
* Если вы хотите переместить голограмму, попробуйте уменьшить его скорость перемещения ниже 5 градусов в секунду, если вы предполагаете, что пользователь пройдет его глаза.
* Для курсора используйте *светлое* вместо *Geometry* . Источник виртуального освещения, присоединенный к взгляду, будет рассматриваться как интерактивный указатель, но не будет использовать цветоделение.
* Настройте плоскость стабилизации в соответствии с голограммами, на которых пользователь облаками.
* Сделайте объект красным, зеленым или синим.
* Переключиться на размытую версию содержимого. Например, знак «Скругленный белый курсор» может быть изменен на немного размытую линию, ориентированную на направление движения.

Как и раньше, отрисовка в 60 кадров/с и настройка плоскости стабилизации является наиболее важными методиками для повышения стабильности. При заметном разделении цветов сначала убедитесь, что частота кадров соответствует ожиданиям.

## <a name="see-also"></a>См. также раздел
* [Основные сведения о производительности смешанной реальности](understanding-performance-for-mixed-reality.md)
* [Цвет, свет и материалы](../../design/color-light-and-materials.md)
* [Инстинктивное взаимодействие](../../design/interaction-fundamentals.md)
* [МРТК голограмма стабилизации](/windows/mixed-reality/mrtk-unity/performance/hologram-stabilization)